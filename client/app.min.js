/**
 * @Author hitjoshi@deloitte.com
 */
(function() {

    angular.module('myApp', ['ui.router', 'ngFileUpload', '720kb.datepicker', 'angularMoment', 'filters']);

    angular
        .module('myApp')
        .config(['$stateProvider', '$urlRouterProvider', config])
        .run(['$rootScope', '$location', 'authentication', run]);

    var GETH_HOSTNAME = "127.0.0.1"; // put your IP address!
    // var APP_HOSTNAME = "127.0.0.1";

    var GETH_RPCPORT = 8545;

    // if we use ui.router we have to change $routeProvider to $stateProvider
    // $locationProvider is used to remove #/ that Angular adds to route
    function config($stateProvider, $urlRouterProvider) {

        var signUpState = {
            name: 'signup',
            url: '/signup',
            templateUrl: 'partials/signup.html',
            controller: 'signUpCtrl',
            controllerAs: 'vm'
        }

        var loginState = {
            name: 'login',
            url: '/login',
            templateUrl: 'partials/login.html',
            controller: 'loginCtrl',
            controllerAs: 'vm'
        }

        var logoutState = {
            name: 'logout',
            url: '/logout',
            templateUrl: 'partials/logout.html'
            // controller: 'logoutCtrl',
            // controllerAs: 'vm'
        }

        var ipfs = {
            name: 'ipfs',
            url: '/ipfs',
            templateUrl: 'partials/ipfs.html',
            controller: 'ipfsCtrl',
            controllerAs: 'vm'
        }

        var dashboard = {
            name: 'dashboard',
            url: '/dashboard',
            templateUrl: 'partials/dashboard.html',
            controller: 'dashboardCtrl',
            controllerAs: 'vm'
        }
        var notification = {
            name: 'notification',
            url: '/notification',
            templateUrl: 'partials/notification.html',
            controller: 'notificationCtrl',
            controllerAs: 'vm'
        }

        var home = {
            name: 'home',
            url: '/home',
            templateUrl: 'partials/home.html',
            controller: 'homeCtrl',
            controllerAs: 'vm'
        }


        var initiateLc = {
            name: 'initiateLc',
            url: '/createlc',
            templateUrl: 'partials/applicantForm.html',
            controller: 'applicantCtrl',
            controllerAs: 'vm'
        }
        // The changes for wire frames starts here
        var issueBankLndingPage = {
            name: 'issueBankLndingPage',
            url: '/issuebank/home/',
            params: {
                'actionItem': null,
            },
            templateUrl: 'partials/issueBankLndingPage.html',
            controller: 'issueBankCtrl',
            controllerAs: 'vm'
        }

        var advisingBankLndingPage = {
            name: 'advisingBankLndingPage',
            url: '/advBank',
            params: {
                'actionItem': null,
            },
            templateUrl: 'partials/advisingBankLndingPage.html',
            controller: 'advisingBankCtrl',
            controllerAs: 'vm'
        }

        var acceptLodgementPage = {
            name: 'acceptLodgementPage',
            url: '/acceptLodgement',
            params: {
                'actionItem': null,
            },
            templateUrl: 'partials/acceptLodgementPage.html',
            controller: 'acceptLodgementCtrl',
            controllerAs: 'vm'
        }

        var beneficiaryLndingPage = {
            name: 'beneficiaryLndingPage',
            url: '/beneficiary/home',
            params: {
                'actionItem': null,
            },
            templateUrl: 'partials/beneficiaryLandingPage.html',
            controller: 'beneficiaryCtrl',
            controllerAs: 'vm'
        }

        var presentingLandingPage = {
            name: 'presentingLandingPage',
            url: '/presenting/home',
            params: {
                'actionItem': null,
            },
            templateUrl: 'partials/presentingLandingPage.html',
            controller: 'presentingCtrl',
            controllerAs: 'vm'
        }


        // The changes for wire frames Ends here

        var issuingForm = {
            name: 'issuingForm',
            url: '/issuingForm',
            templateUrl: 'partials/issuingForm.html',
            controller: 'issueFormCtrl',
            controllerAs: 'vm'
        }
        // // url will be vm/orderDetails
        // // nested states
        // var orderDetails = {
        //     name: 'applicantForm.orderDetails',
        //     url: '/orderDetails',
        //     templateUrl: 'partials/applicantOrderDetails.html',
        // }
        // var details = {
        //     name: 'details',
        //     url: '/details/:itemId',
        //     templateUrl: 'partials/details.html',
        //     controller: 'detailsCtrl',
        //     controllerAs: 'vm'
        // }


        // var upload = {
        //     name: 'upload',
        //     url: '/upload',
        //     templateUrl: 'partials/fileupload.html',
        //     controller: 'fileCtrl',
        //     controllerAs: 'vm'
        // }

        var blockexplorer = {
            name: 'blockexplorer',
            url: '/blockexplorer',
            templateUrl: 'partials/blockmain.html',
            controller: 'mainDashCtrl',
            controllerAs: 'vm'
        }
        //
        var blockid = {
            name: 'blockid',
            url: '/block/:blockId',
            templateUrl: 'partials/blockInfos.html',
            controller: 'blockInfosCtrl',
            controllerAs: 'vm'
        }
        //
        var transactionid = {
            name: 'transactionid',
            url: '/tx/:transactionId',
            templateUrl: 'partials/transactionInfos.html',
            controller: 'transactionInfosCtrl',
            controllerAs: 'vm'
        }
        //
        var address = {
            name: 'address',
            url: '/address/:addressId',
            templateUrl: 'partials/addressInfos.html',
            controller: 'addressInfosCtrl',
            controllerAs: 'vm'
        }
        var chainapi = {
            name: 'chainapi',
            url: '/chain/api',
            templateUrl: 'partials/api.html',
            controller: 'chainInfosCtrl',
            controllerAs: 'vm'
        }
        var chain = {
            name: 'chain',
            url: '/chain/',
            templateUrl: 'partials/chainInfos.html',
            controller: 'chainInfosCtrl',
            controllerAs: 'vm'
        }


        //
        // var difficulty = {
        //     name: 'difficulty',
        //     url: '/chain/difficulty',
        //     templateUrl: 'partials/api/difficulty.html',
        //     controller: 'chainInfosCtrl',
        //     controllerAs: 'vm'
        // }



        $stateProvider
            .state(loginState)
            .state(signUpState)
            .state(ipfs)
            .state(home)
            .state(initiateLc)
            .state(issueBankLndingPage)
            .state(advisingBankLndingPage)
            .state(beneficiaryLndingPage)
            .state(presentingLandingPage)
            .state(issuingForm)
            // .state(details)
            .state(logoutState)
            .state(notification)
            .state(dashboard)
            .state(acceptLodgementPage)

            .state(blockexplorer)
            .state(blockid)
            .state(transactionid)
            .state(address)
            .state(chainapi)
            .state(chain);

        // default route
        $urlRouterProvider.otherwise('/login');
        // enable html5Mode to get rid of # appended in URL
        // $locationProvider.html5Mode(true);
    }

    function run($rootScope, $location, authentication) {

        var web3 = require('web3');
        var url = $location.absUrl().split('#!')[0];
        var protocol = url.split(':')[0];
        var ethDomain = url.split(':')[1];
        var ethPort = "8545";
        console.log(protocol + ":" + ethDomain + ":" + ethPort);
        if (ethDomain == "52.172.44.68") {
            // point to the server where ethereum is deployed
            ethDomain = "172.18.25.180";
        }
        var web3 = new Web3(new Web3.providers.HttpProvider(protocol + ":" + ethDomain + ":" + ethPort));
        $rootScope.web3 = web3;
        $rootScope.$on('$locationChangeStart', function(event, nextRoute, currentRoute) {
            var publicPages = ['/login', '/signup', '/logout'];
            var restrictedPage = publicPages.indexOf($location.path()) === -1;
            if (restrictedPage && !authentication.isLoggedIn()) {
                $location.path('/login');
            }
        });
    }

})();

(function() {
    "use strict";
    angular
        .module('myApp')
        .service('apiCall', apiCall);

    apiCall.$inject = ['$http', 'authentication', '$state'];

    function apiCall($http, authentication, $state) {
        var makeCall = function(url, httpMethod, data){
          console.log("inside apiCall service !!");
          var result = {
            status:"",
            data:""
          };
          if( httpMethod === "post" ){
            console.log("post: " + url);
            return $http.post(url,data,{
              headers: {
                  Authorization: 'Bearer ' + authentication.getToken()
              }
            }).then(
              function success(response){
                // console.log(response.data.message);
                result.status = "success";
                result.data = response.data.message;
                return result;
              },
              function error(response){
                var user = authentication.currentUser();
                if(user.role!=200) {
                  result.status = "Role Based Authentication Failed";
                  console.log("Wrong user role");
                  $state.go('home');
                }
                // console.log(response.data.message);
                result.status = "failure";
                result.data = response.data.message;
                return result;
              }
            );
          }
          else if( httpMethod === "get"){
            console.log("get: " + url);
            return $http.get(url,{
              headers: {
                  Authorization: 'Bearer ' + authentication.getToken()
              }
            }).then(
              function success(response){
                // console.log(response.data.message);
                result.status = "success";
                result.data = response.data.message;
                // console.log(result.data);
                return result;
              },
              function error(response){
                var user = authentication.currentUser();
                if(user.role!=200) {
                  result.status = "Role Based Authentication Failed";
                  console.log("Wrong user role");
                  $state.go('home');
                }
                // console.log(response.data.message);
                result.status = "failure";
                result.data = response.data.message;
                return result;
              }
            );
          }
          else{
            console.log("Not a supported httpMethod");
          }
        };
        var service = {
          makeCall: makeCall,
        };

        return service;
    }


})();

(function() {
    "use strict";
    angular
        .module('myApp')
        .service('authentication', authentication);

    authentication.$inject = ['$http', '$window'];

    function authentication($http, $window) {


        var saveToken = function(token) {
            $window.sessionStorage['mean-token'] = token;
        };

        var getToken = function() {
            return $window.sessionStorage['mean-token'];
        };

        var isLoggedIn = function() {
            var token = getToken();
            var payload;

            if (token) {
                payload = token.split('.')[1];
                payload = $window.atob(payload);
                payload = JSON.parse(payload);
                return payload.exp > Date.now() / 1000;
            } else {
                return false;
            }
        };

        var currentUserRole = function() {
            var user = this.currentUser();
            var role;
            if (user && user !== "") {
                role = user.role;
            }
            return role;
        };

        var currentUser = function() {
            if (isLoggedIn()) {
                var token = getToken();
                var payload = token.split('.')[1];
                payload = $window.atob(payload);
                payload = JSON.parse(payload);
                return {
                    email: payload.email,
                    name: payload.name,
                    role: payload.role,
                    userId: payload.userId
                };
            }
        };

        var register = function(user) {
            console.log(user);
            return $http.post('/user/register', user).then(
                function(response) {
                    console.log(response.data);
                    saveToken(response.data.token);
                    return response;
                },
                function(response) {
                    // if error
                    return response;
                });
        };

        var login = function(user) {
            return $http.post('/user/login', user).then(
                function(response) {
                    // Save token in local storage
                    saveToken(response.data.token);
                    return response;
                },
                function(response) {
                    // return error response
                    return response;

                });
        };



        var logout = function() {
            $window.sessionStorage.removeItem('mean-token');
        };
        var service = {
            currentUser: currentUser,
            saveToken: saveToken,
            getToken: getToken,
            isLoggedIn: isLoggedIn,
            register: register,
            login: login,
            role: currentUserRole,
            logout: logout
        };

        return service;

    }


})();



(function() {
    angular.module('filters', [])
        .filter('truncate', function() {
            return function(text, length, end) {
                if (isNaN(length))
                    length = 10;

                if (end === undefined)
                    end = "...";

                if (text.length <= length || text.length - end.length <= length) {
                    return text;
                } else {
                    return String(text).substring(0, length - end.length) + end;
                }
            };
        }).
    filter('diffFormat', function() {
        return function(diffi) {
            if (isNaN(diffi)) return diffi;
            var n = diffi / 1000000000000;
            return n.toFixed(3) + " T";
        };
    }).
    filter('stylize', function() {
        return function(style) {
            if (isNaN(style)) return style;
            var si = '<span class="btn btn-primary">' + style + '</span>';
            return si;
        };
    }).
    filter('stylize2', function() {
        return function(text) {
            if (isNaN(text)) return text;
            var si = '<i class="fa fa-exchange"></i> ' + text;
            return si;
        };
    }).
    filter('hashFormat', function() {
        return function(hashr) {
            if (isNaN(hashr)) return hashr;
            var n = hashr / 1000000000000;
            return n.toFixed(3) + " TH/s";
        };
    }).
    filter('gasFormat', function() {
        return function(txt) {
            if (isNaN(txt)) return txt;
            var b = new BigNumber(txt);
            return b.toFormat(0) + " m/s";
        };
    }).
    filter('BigNum', function() {
        return function(txt) {
            if (isNaN(txt)) return txt;
            var b = new BigNumber(txt);
            var w = web3.fromWei(b, "ether");
            return w.toFixed(6) + " ETH";
        };
    }).
    filter('sizeFormat', function() {
        return function(size) {
            if (isNaN(size)) return size;
            var s = size / 1000;
            return s.toFixed(3) + " kB";
        };
    });
})();

(function() {

  goBack.$inject = ["$window"];
  angular
      .module('myApp')
      .directive('goBack', goBack);

  function goBack( $window ) {
    return function($scope, $element){
      $element.on('click', function(){
        $window.history.back();
      })
  }
  }

})();

(function() {

    angular
        .module('myApp')
        .directive('limitToMaxMin', limitToMaxMin);

    function limitToMaxMin() {
        return {
            restrict: 'A',
            require: 'ngModel',
            scope:{
              ngModel: '='
            },
            link: function(scope, element, attributes) {
              // element.on("keydown keyup", function(e) {
              element.on("blur", function(e) {
                if (Number(element.val()) > Number(attributes.max) &&
                      e.keyCode != 46 // delete
                      &&
                      e.keyCode != 8 // backspace
                    ) {
                      e.preventDefault();
                      element.val(attributes.max);
                      scope.ngModel = Number(attributes.max);
                    }
                if (Number(element.val()) < Number(attributes.min) &&
                      e.keyCode != 46 // delete
                      &&
                      e.keyCode != 8 // backspace
                    ) {
                      e.preventDefault();
                      element.val(attributes.min);
                      scope.ngModel = Number(attributes.min);
                    }
              });
            }
        };
    }

})();

(function() {

    angular
        .module('myApp')
        .directive('navigation', navigation);

    function navigation() {
        return {
            restrict: 'EA',
            templateUrl: '../../partials/navigation.html',
            controller: 'navigationCtrl as navvm'
        };
    }
    
})();

(function() {

    printpage.$inject = ["$timeout"];
    angular
        .module('myApp')
        .directive('printpage', printpage);

    function printpage( $timeout ) {
        return {
            restrict: 'E',
            template: "<button class='btn btn-inverse btn-lg btn-login'>" +
            					  "Print" +
            					"</button>",
            link: function(scope, element, attributes) {
              element.on("click", function(e) {
                var expandButton = angular.element("#collapse-init");
                var expandText = expandButton.text();
                if( expandText.trim() === "Expand All" ){
                  expandButton.click();
                }
                $timeout( function(){ window.print() }, 2000);
              });
            }
        };
    }

})();

(function() {
    angular
        .module('myApp')
        .controller('acceptLodgementCtrl', acceptLodgementCtrl);

    acceptLodgementCtrl.$inject = ['$scope','$http','authentication','$rootScope','$window','$state','$stateParams'];

    function acceptLodgementCtrl($scope,$http,authentication, $rootScope,$window,$state,$stateParams) {
		console.log("inside acceptLodgementCtrl-1")
	  var vm = this;
       vm.init = function(){
	     $http.get('/acceptLodgement/lcDetails', {
			 headers: {
				 Authorization: 'Bearer ' + authentication.getToken()
			 }
		 }).then(function(response) {
			$scope.acptLdgmentLCList = response.data;
			console.log($scope.acptLdgmentLCList);
		 }, function(response) {
			   var user = authentication.currentUser();
			   if(user.role!=200) {
				   $scope.errorMsg = "Not the correct role";
				   $state.go('home');
			   }
			 })
       .then( function(){
         if( $stateParams.actionItem != "" && $stateParams.actionItem != null ){
           console.log("action item not null");
           console.log($stateParams.actionItem);

           console.log($scope.acptLdgmentLCList);
         var selectedLcNumber = $scope.acptLdgmentLCList.filter(function( dataObj ) {
                 return (dataObj.lcNumber == $stateParams.actionItem ) ;
               });
         $scope.acptLdgmentFormDetails = selectedLcNumber[0];
         vm.showAccordion = true;
         $stateParams.actionItem = "";
         }
       });
	   }

	  /* function to enable Accordian on selection of LC Number on the HTML page */
	  vm.fetchDetail = function(lcDetails){
      if( lcDetails != null && lcDetails != ""){
        vm.showAccordion = true;
        vm.submitMessage = "";
      }
	  }


	  /* Function to clear the fields on reset button */
	  vm.clear = function(){
			console.log("clear all fields inside acceptLodgementService-2");
			vm.submitMessage = "";
		   if( $scope.acptLdgmentFormDetails != "" && $scope.acptLdgmentFormDetails != undefined
          && $scope.acptLdgmentFormDetails != null ){
			  console.log("clearing all fields");
			  $scope.acptLdgmentFormDetails = "";
			  vm.showAccordion=false;
		  }

	  }

	  /* Function to Save the Advising bank screen details */
	  vm.submit = function(lcDetails){
		  console.log("inside acceptLodgementController->submit()");
		  console.log("contractID="+lcDetails._id);
		  var contractID = {'contractID': lcDetails._id};
		   $http.post('/acceptLodgement/acceptLC',contractID, {
                headers: {
                    Authorization: 'Bearer ' + authentication.getToken()
                }
            }).then(
                function(response) {
                  vm.init();
                  vm.clear();
                  vm.submitMessage="Lodgement Accepted : Block chain processing initiated";
                  vm.showAccordion = false;
                },
                function(response) {
                    console.log(response.data.message);
                });
		}

	  vm.setTab = function(index){
        if( index == $rootScope.tabIdentifier ){
          return "active";
        }
        else{
          return false;
        }
      }
	  vm.init();
    }
})();

(function() {
    angular
        .module('myApp')

        .controller('applicantCtrl', applicantCtrl);

    applicantCtrl.$inject = ['$scope', '$http', 'authentication', 'Upload', '$timeout', '$state'];


    function applicantCtrl($scope, $http, authentication, Upload, $timeout, $state) {
        console.log("inside applicantForm controller")
        var vm = this;
        // using below regex in ng-pattern
        $scope.onlyNumbers = /^[0-9]{1,7}$/;

        $http.get('/applicant/onload/', {
            headers: {
                Authorization: 'Bearer ' + authentication.getToken()
            }
        }).then(function(response) {
            $scope.appForm = {};
            $scope.today = new Date();
            var user = authentication.currentUser();
            var sellers = [];
            for (i = 0; i < response.data.length; i++) {
                if (response.data[i].role == 100 && user.userId == response.data[i]._id) {
                    var buyer = response.data[i];
                    console.log(buyer);
                    $scope.appForm.buyerId = buyer._id;
                    $scope.appForm.buyerName = buyer.name;
                    $scope.appForm.buyerAdd = buyer.address;
                    $scope.appForm.buyerAccNumber = buyer.accountDetail.accountNo;
                    //$scope.appForm.buyer=buyer;

                } else if (response.data[i].role == 400) {
                    var seller = {
                      sellerId:'',
                      name:'',
                      sellerAdd:'',
                      sellerAccNumber:''
                    };
                    seller.sellerId=response.data[i]._id;
                    seller.name=response.data[i].name;
                    seller.sellerAdd=response.data[i].address;
                    seller.sellerAccNumber=response.data[i].accNumber;
                    sellers.push(seller);
                } else if (response.data[i].role == 200) {
                    var issueBank = response.data[i];
                    $scope.appForm.bankId = issueBank._id;
                    $scope.appForm.issueBankName = issueBank.entity;
                    $scope.appForm.issueBankAddress = issueBank.address;
                    $scope.appForm.issueBankBranch = issueBank.branch;
                    $scope.appForm.issueBankAddress = issueBank.address;
                } else if (response.data[i].role == 300) {
                    var advBank = response.data[i];
                    $scope.appForm.advBankId = advBank._id;
                    $scope.appForm.advBankName = advBank.entity;
                    $scope.appForm.advBankBranch = advBank.branch;
                }
            }

            $scope.appForm.sellers = sellers;
            console.log($scope.appForm.sellers);
        }, function(response) {
            if (user.role != 100) {
                $scope.errorMsg = "Not the correct role";
                console.log("Wrong user role");
                $state.go('home');
            }
            console.log(response.status);
        });

        vm.clear = function(appForm) {
            console.log("Clear section ");
            appForm.poNumber = "";
            appForm.poItem = "";
            appForm.poValue = "";
            appForm.lcDuration = "";
            appForm.tolerancePercent = "";
            appForm.usancePeriod = "";
            appForm.initiatorIpfcDocHash = "";
            appForm.poInitDate = "";
            appForm.message = "";
            appForm.poQuantity = "";
            $scope.submitData = "";
            $scope.createLcRequestForm.poNumber.$setValidity("poUnique", true);
            $scope.createLcRequestForm.$setPristine();
        }

        $scope.uploadFiles = function(files) {
            console.log("Uploading ----------------");
            $scope.appForm.files = files;
            $scope.appForm.message = $scope.appForm.files[0].name + " file selected";
        };

        vm.submit = function(appForm) {
            console.log(appForm);
            var mybody = angular.element(document).find('body');
            mybody.addClass('waiting');
            console.log("This is for submit in controller" + appForm);
            console.log("poNumber=" + appForm.poNumber);
            console.log("Currency ===> " + appForm.poCurrency);
            console.log("Seller in controller ----------"+appForm.sellerId);
            console.log("This is for submit in controller    Files   " + appForm.files);
            var files = appForm.files;


            var fileName = files[0].name;
            console.log(" Controller naem       " + fileName);

            if (files && files.length) {
                Upload.upload({
                    url: '/applicant/upload',
                    data: {
                        files: files
                    }
                }).then(function(response) {
                    $timeout(function() {
                        $scope.result = response.data;
                        console.log("The response for upload");
                        console.log(response);
                        $scope.appForm.initiatorIpfcDocHash = response.data[0].hash;
                        $scope.appForm.initiaterFileName = fileName;
                        $scope.appForm.userDate = new Date();
                        $scope.appForm.poCurrency = "$";
                        $http.post('/applicant/submit/', appForm, {
                            headers: {
                                Authorization: 'Bearer ' + authentication.getToken()
                            }
                        }).then(function(response) {
                            console.log("RESPOSNSE________");
                            vm.clear($scope.appForm);
                            $scope.submitData = response.data;
                            mybody.removeClass('waiting');
                            console.log(response.data);

                        }, function(response) {
                            mybody.removeClass('waiting');
                            console.log(response.status);
                        });
                    });
                }, function(response) {

                    if (response.status > 0) {
                        $scope.errorMsg = response.status + ': ' + response.data;
                    }
                }, function(evt) {
                    $scope.progress =
                        Math.min(100, parseInt(100.0 * evt.loaded / evt.total));
                }).then(function() {
                    // console.log("THE LOCAL SAVE");
                    // Upload.upload({
                    //   url: '/applicant/uploadLocal',
                    //   data: {
                    //       files: files
                    //   }
                    // });

                });
            }
        };

        vm.populateBenefiary = function(seller) {
          console.log("in selection "+seller._id);

            $scope.appForm.sellerId = seller._id;
            $scope.appForm.sellerName = seller.name;
            $scope.appForm.sellerAdd = seller.sellerAdd;
            $scope.appForm.sellerAccNumber = seller.sellerAccNumber;
        };

        // Function to check if PO Number is unique for a buyerId
        vm.validatePoNumber = function(poNumber) {
            console.log("validating PO number on blur");
            console.log("ponumber is : " + poNumber);
            var buyerId = authentication.currentUser().userId;
            if (poNumber != undefined) {
                // encoding while sending as get query parameter
                poNumber = encodeURIComponent(poNumber);
                $http.get('/applicant/validatePoNumber/' + poNumber + '/' + buyerId, {
                    headers: {
                        Authorization: 'Bearer ' + authentication.getToken()
                    },
                }).then(function(response) {
                        // if poNumber is unique
                        console.log(response.data.message);
                        $scope.createLcRequestForm.poNumber.$setValidity("poUnique", true);
                    },
                    function(err) {
                        // if poNumber already exists in DB
                        console.log(err.data.message);
                        $scope.createLcRequestForm.poNumber.$setValidity("poUnique", false);
                    });
            }
        }

        vm.removeUniqueMsg = function() {
            $scope.createLcRequestForm.poNumber.$setValidity("poUnique", true);
        }




    }
})();

/**
  * @author sukohli@deloitte.com
  * /beneficiary/home -> controller
  * This controller handles Share Lodgement
*/
(function() {
    angular
        .module('myApp')
        .controller('beneficiaryCtrl', beneficiaryCtrl);

    beneficiaryCtrl.$inject = ['$state','apiCall','authentication', '$scope', '$http', 'Upload', '$timeout','$stateParams'];

    function beneficiaryCtrl($state, apiCall, authentication, $scope, $http, Upload, $timeout, $stateParams) {
        var vm = this;
        vm.showAccordion = false;
        // Prepopulate LC Number dropdown
        vm.init = function(){
          console.log("Prepopulate init function called !!");
          // get LC numbers from mongo
          $http.get('/beneficiary/getLcNumbers/', {
              headers: {
                  Authorization: 'Bearer ' + authentication.getToken()
              }
          })
          .then( function(response){
            console.log("Response Lc Numbers");            
            vm.lodgementDetails = response.data;
          },
          function(err){
            var user = authentication.currentUser();
     			   if(user.role!=400) {
     				   $scope.errorMsg = "Not the correct role";
     				   $state.go('home');
     			   }
          })
          .then( function(){
            if( $stateParams.actionItem != "" && $stateParams.actionItem != null ){
              console.log("action item not null");
              console.log($stateParams.actionItem);

              console.log(vm.lodgementDetails);
            var selectedLcNumber = vm.lodgementDetails.filter(function( dataObj ) {
                    return (dataObj.lcNumber == $stateParams.actionItem ) ;
                  });
            // console.log(selectedLcNumber[0]);
            vm.shareLodgement = selectedLcNumber[0];
            vm.showAccordion = true;
            $stateParams.actionItem = "";
            }
          });

          // get Presenting Bank Details
          $http.get('/beneficiary/getPresentingBank',{
            headers: {
                Authorization: 'Bearer ' + authentication.getToken()
            }
          })
          .then( function(response){
            console.log("Response Presenting Bank");
            console.log(response.data);
            vm.presentingBank = response.data[0];
          }, function(err){
            var user = authentication.currentUser();
     			   if(user.role!=400) {
     				   $scope.errorMsg = "Not the correct role";
     				   $state.go('home');
     			   }
          });
        }

        vm.clear = function(){
          vm.showAccordion = false;
          vm.shareLodgement = "";
          vm.invoiceFile="";
          vm.invoiceFileArray="";
          vm.lodgementFiles="";
          vm.submitMessage="";
          vm.createLodgementForm.$setPristine();
          vm.createLodgementForm.billNumber.$setValidity("billNumberUnique",true);
        }

        vm.fetchDetail = function(selectedLc){
          console.log(" fetch details function");
          console.log(selectedLc);
          vm.showAccordion = true;
        }

        // Function to check if Bill Number is unique for a beneficiary
        vm.validateBillNumber = function(billNumber){
          console.log("validating billNumber on blur");
          console.log("billNumber is : " + billNumber);
          // encoding while sending as get query parameter
          billNumber = encodeURIComponent(billNumber);
          console.log("Encoding billNumber is : " + billNumber);
          var sellerId = authentication.currentUser().userId;
          if( billNumber != undefined && billNumber != 'undefined'){
            $http.get('/beneficiary/validateBillNumber/' + billNumber + '/' + sellerId, {
                headers: {
                    Authorization: 'Bearer ' + authentication.getToken()
                },
            }).then(function(response) {
                      // if billNumber is unique
                      console.log(response.data.message);
            },
                function(err) {
                  // if billNumber already exists in DB
                  console.log(err.data.message);
                  vm.createLodgementForm.billNumber.$setValidity("billNumberUnique",false);
            });
          }
        }

        vm.removeUniqueMsg = function(){
          vm.createLodgementForm.billNumber.$setValidity("billNumberUnique",true);
        }

        vm.selectFiles = function(files) {
            console.log("Uploading ----------------");
            vm.lodgementFiles = files;
            console.log(vm.lodgementFiles);
        };

        vm.selectInvoice = function(file){
          // console.log(file);
          if( file.length > 1){
            // remove extra file
            console.log("Remove extra file");
            file.shift();
          }
          console.log("Uploading Invoice----------------");
          vm.invoiceFile = file[0];
          vm.invoiceFileArray = file;
          console.log(vm.invoiceFile);
        }

        vm.removeAttachement = function(index,typeOfFile){
          console.log("type of file is: " + typeOfFile);
          if( typeOfFile === "others"){
            console.log("sent index is : " + index);
            vm.lodgementFiles.splice(index, 1);
          }
          if( typeOfFile === "invoice"){
            console.log("sent index is : " + index);
            vm.invoiceFile="";
            vm.invoiceFileArray.splice(index, 1);
          }
        }

        vm.submit = function(){
          console.log("Submit function called!");
          var mybody = angular.element(document).find('body');
          mybody.addClass('waiting');
          console.log(vm.shareLodgement);
          var lodgementRequest = {
            "contractID": vm.shareLodgement._id,
            "billNumber": vm.shareLodgement.billNumber,
            "billQuantity": vm.shareLodgement.billQuantity,
            "billAmount": vm.shareLodgement.billAmount,
            "billLading":vm.shareLodgement.billLading,
            "presentingBankId":vm.presentingBank._id
          };
          console.log(lodgementRequest);
          // files is a new array, copy of lodgementFiles
          var files = vm.lodgementFiles.slice();
          var invoiceFile = vm.invoiceFile;
          console.log("lodgementFiles are: ");
          console.log(files);
          if (files && files.length && invoiceFile) {
              // disabling submit button
              vm.clear();
              vm.submitMessage  = "Lodgement Creation And File Upload In Progress, Please Wait.";
              // appends to start of array
              files.unshift(invoiceFile);
              console.log(files);
              Upload.upload({
                  url: '/beneficiary/upload',
                  data: {
                      files: files
                  }
              }).then(function(response) {
                  $timeout(function() {
                      console.log("The response for lodgementFiles upload");
                      console.log(response);
                      var lodgementDocuments = [];
                      for( var i=0; i<response.data.length; i++){
                        if( i == 0 ){
                          var tempDoc = {
                            "ipfsDocHash" : response.data[i].hash,
                            "fileName" : response.data[i].fileName,
                            "fileType" : "invoice"
                          }
                        }
                        else{
                          var tempDoc = {
                            "ipfsDocHash" : response.data[i].hash,
                            "fileName" : response.data[i].fileName,
                            "fileType" : "others"
                          }
                        }
                        lodgementDocuments.push(tempDoc);
                      }
                      console.log(lodgementDocuments);
                      lodgementRequest["lodgementDocuments"] = lodgementDocuments;
                      $http.post('/beneficiary/saveLodgementForm/', lodgementRequest, {
                          headers: {
                              Authorization: 'Bearer ' + authentication.getToken()
                          }
                      }).then(function(response) {
                          console.log("RESPONSE From save lodgementForm!");
                          // $scope.submitData = response.data;
                          console.log(response.data);
                          vm.init();
                          vm.clear();
                          mybody.removeClass('waiting');
                          vm.submitMessage = response.data.message;
                      }, function(err) {
				                  mybody.removeClass('waiting');
                          console.log(err.status);
                      });
                  });
              }, function(err) {

                  if (err.status > 0) {
                      $scope.errorMsg = err.status + ': ' + err.data;
                  }
              }, function(evt) {
                  $scope.progress =
                      Math.min(100, parseInt(100.0 * evt.loaded / evt.total));
              }).then(function(){
                console.log("THE LOCAL SAVE");
                // Upload.upload({
                //   url: '/beneficiary/uploadLocal',
                //   data: {
                //       files: files
                //   }
                // });
              });
          }
          else{
            console.log("Files Not Uploaded Properly");
            // disabling submit button
            vm.clear();
            vm.submitMessage  = "--- Files Not Uploaded Properly, Please Try Again ---";
          }
        }

        vm.init();
    };
})();

(function() {
    angular
        .module('myApp')

        .controller('addressInfosCtrl', addressInfosCtrl);


    addressInfosCtrl.$inject = ['$rootScope', '$scope', '$location', '$stateParams', '$q'];

    function addressInfosCtrl($rootScope, $scope, $location, $routeParams, $q) {
        var web3 = $rootScope.web3;
        $scope.init = function() {

            $scope.addressId = $routeParams.addressId;
            var addressId = $routeParams.addressId;

            if ($scope.addressId !== undefined) {
                getAddressBalance()
                    .then(function(result) {
                        $scope.balance = web3.fromWei(result).toNumber();
                    });
                getAddressTransactionCount()
                    .then(function(result) {
                        $scope.txCount = result;
                    });
                getCode()
                    .then(function(result) {
                        $scope.code = result;
                    });
                getTransactions()
                    .then(function(result) {
                        console.log("getTransactions is executed!")
                        console.log(result)
                        $scope.transactions = result;
                    });
                getETHUSD();
            } else {
                $location.path("/");
            }

            function getAddressBalance() {
                var deferred = $q.defer();
                web3.eth.getBalance($scope.addressId, function(error, result) {
                    if (!error) {
                        deferred.resolve(result);
                    } else {
                        deferred.reject(error);
                    }
                });
                return deferred.promise;
            }

            function getETHUSD() {
                $.getJSON("https://coinmarketcap-nexuist.rhcloud.com/api/eth/price", function(json) {
                    var price = json.usd;
                    var ethusd = price.toFixed(2);
                    var balanceusd = "$" + ethusd * $scope.balance;
                    $scope.balanceusd = balanceusd;
                    //console.log("Balance in USD " + $scope.balanceusd);
                });
            }

            function getAddressTransactionCount() {
                // var success=$.getScript('../../config.js');
                var deferred = $q.defer();
                web3.eth.getTransactionCount($scope.addressId, function(error, result) {
                    if (!error) {
                        deferred.resolve(result);
                    } else {
                        deferred.reject(error);
                    }
                });
                return deferred.promise;
            }

            function getCode() {
                var deferred = $q.defer();
                web3.eth.getCode($scope.addressId, function(error, result) {
                    if (!error) {
                        deferred.resolve(result);
                    } else {
                        deferred.reject(error);
                    }
                });
                return deferred.promise;
            }

            // TODO: not working yet:
            function getTransactions() {
                var deferred = $q.defer();

                /*

                // See https://github.com/ethereum/go-ethereum/issues/1897#issuecomment-166351797
                // plus the following posts
                // Giving up for now. Invested another 3 hours without results. Grrrr..

                // var options="address:"+$scope.addressId;
                // var options = {"address": "0xf2cc0eeaaaed313542cb262b0b8c3972425143f0"}; // $scope.addressId}; // , "topics": [null]
                // var options = 'pending'
                // console.log(options);

                var options = {fromBlock: 0, toBlock: 'latest', address: "0xf2cc0eeaaaed313542cb262b0b8c3972425143f0"};

                var myfilter = web3.eth.filter(options);

                // var myfilter= web3.eth.filter(options);
                console.log(myfilter);


                myfilter.get(function (error, log) {
                	  console.log("get error:", error);
                	  console.log("get log:", log);
                	});

                web3.eth.filter(options,
                		function(error, result){
                			if(!error){
                				console.log("no error");
                				deferred.resolve(result);
                				}
                			else{
                				console.log("error");
                				deferred.reject(error);
                				}
                			});

                */
                return deferred.promise;

            }
        };
        $scope.init();

        function hex2a(hexx) {
            var hex = hexx.toString(); //force conversion
            var str = '';
            for (var i = 0; i < hex.length; i += 2)
                str += String.fromCharCode(parseInt(hex.substr(i, 2), 16));
            return str;
        }
    };
})();

(function() {
    angular
        .module('myApp')

        .controller('blockInfosCtrl', blockInfosCtrl);


    blockInfosCtrl.$inject = ['$rootScope', '$scope', '$location', '$stateParams', '$q'];


    function blockInfosCtrl($rootScope, $scope, $location, $stateParams, $q) {
        var web3 = $rootScope.web3;
        var BigNumber = require('bignumber.js');
        $scope.init = function() {


            $scope.blockId = $stateParams.blockId;


            if ($scope.blockId !== undefined) {

                getBlockInfos()
                    .then(function(result) {
                        var number = web3.eth.blockNumber;

                        $scope.result = result;

                        $scope.numberOfUncles = result.uncles.length;

                        //if ($scope.numberOfUncles!=0) {
                        //	uncle1=result.uncles[0];
                        //	console.log(web3.eth.getUncle(uncle1));
                        //}

                        if (result.hash !== undefined) {
                            $scope.hash = result.hash;
                        } else {
                            $scope.hash = 'pending';
                        }
                        if (result.miner !== undefined) {
                            $scope.miner = result.miner;
                        } else {
                            $scope.miner = 'pending';
                        }
                        $scope.gasLimit = result.gasLimit;
                        $scope.gasUsed = result.gasUsed;
                        $scope.nonce = result.nonce;
                        var diff = ("" + result.difficulty).replace(/['"]+/g, '') / 1000000000000;
                        $scope.difficulty = diff.toFixed(3) + " T";
                        $scope.gasLimit = new BigNumber(result.gasLimit).toFormat(0) + " m/s"; // that's a string
                        $scope.gasUsed = new BigNumber(result.gasUsed).toFormat(0) + " m/s";
                        $scope.nonce = result.nonce;
                        $scope.number = result.number;
                        $scope.parentHash = result.parentHash;
                        $scope.uncledata = result.sha3Uncles;
                        $scope.rootHash = result.stateRoot;
                        $scope.blockNumber = result.number;
                        $scope.timestamp = new Date(result.timestamp * 1000).toUTCString();
                        $scope.extraData = result.extraData.slice(2);
                        $scope.dataFromHex = hex2a(result.extraData.slice(2));
                        $scope.size = result.size;
                        $scope.firstBlock = false;
                        $scope.lastBlock = false;
                        if ($scope.blockNumber !== undefined) {
                            $scope.conf = number - $scope.blockNumber + " Confirmations";
                            if (number === $scope.blockNumber) {
                                $scope.conf = 'Unconfirmed';
                                $scope.lastBlock = true;
                            }
                            if ($scope.blockNumber === 0) {
                                $scope.firstBlock = true;
                            }
                        }

                        if ($scope.blockNumber !== undefined) {
                            var info = web3.eth.getBlock($scope.blockNumber);
                            if (info !== undefined) {
                                var newDate = new Date();
                                newDate.setTime(info.timestamp * 1000);
                                $scope.time = newDate.toUTCString();
                            }
                        }
                    });

            } else {
                $location.path("/");
            }


            function getBlockInfos() {
                var deferred = $q.defer();

                web3.eth.getBlock($scope.blockId, function(error, result) {
                    if (!error) {
                        deferred.resolve(result);
                    } else {
                        deferred.reject(error);
                    }
                });
                return deferred.promise;

            }


        };
        $scope.init();

        // parse transactions
        $scope.transactions = []

        web3.eth.getBlockTransactionCount($scope.blockId, function(error, result) {
            var txCount = result;
            $scope.numberOfTransactions = txCount;
            for (var blockIdx = 0; blockIdx < txCount; blockIdx++) {
                web3.eth.getTransactionFromBlock($scope.blockId, blockIdx, function(error, result) {
                    // console.log("Result: ", result);
                    web3.eth.getTransactionReceipt(result.hash, function(error, receipt) {
                        var transaction = {
                            id: receipt.transactionHash,
                            hash: receipt.transactionHash,
                            from: receipt.from,
                            to: receipt.to,
                            gas: receipt.gasUsed,
                            input: result.input.slice(2),
                            value: web3.fromWei(result.value, "ether"),
                            contractAddress: receipt.contractAddress
                        }
                        $scope.$apply(
                            $scope.transactions.push(transaction)
                        );
                    });
                })
            }
        });

        function hex2a(hexx) {
            var hex = hexx.toString(); //force conversion
            var str = '';
            for (var i = 0; i < hex.length; i += 2)
                str += String.fromCharCode(parseInt(hex.substr(i, 2), 16));

            return str;
        }
    }
})();

(function() {
    angular
        .module('myApp')

        .controller('chainInfosCtrl', chainInfosCtrl);

    chainInfosCtrl.$inject = ['$rootScope', '$scope', '$location', '$routeParams', '$q'];

    function chainInfosCtrl($rootScope, $scope, $location, $routeParams, $q) {
        var web3 = $rootScope.web3;
        var BigNumber = require('bignumber.js');
        $scope.init = function() {
            getChainInfos()
                .then(function(result) {

                    $scope.result = result; // just a dummy value, but following Whit's example.

                    $scope.blockNum = web3.eth.blockNumber; // now that was easy

                    if ($scope.blockNum !== undefined) {

                        // TODO: put the 2 web3.eth.getBlock into the async function below
                        //       easiest to first do with fastInfosCtrl
                        var blockNewest = web3.eth.getBlock($scope.blockNum);

                        if (blockNewest !== undefined) {

                            // difficulty
                            $scope.difficulty = blockNewest.difficulty;
                            $scope.difficultyToExponential = blockNewest.difficulty.toExponential(3);

                            $scope.totalDifficulty = blockNewest.totalDifficulty;
                            $scope.totalDifficultyToExponential = blockNewest.totalDifficulty.toExponential(3);

                            $scope.totalDifficultyDividedByDifficulty = $scope.totalDifficulty.dividedBy($scope.difficulty);
                            $scope.totalDifficultyDividedByDifficulty_formatted = $scope.totalDifficultyDividedByDifficulty.toFormat(1);

                            $scope.AltsheetsCoefficient = $scope.totalDifficultyDividedByDifficulty.dividedBy($scope.blockNum);
                            $scope.AltsheetsCoefficient_formatted = $scope.AltsheetsCoefficient.toFormat(4);

                            // large numbers still printed nicely:
                            $scope.difficulty_formatted = $scope.difficulty.toFormat(0);
                            $scope.totalDifficulty_formatted = $scope.totalDifficulty.toFormat(0);

                            // Gas Limit
                            $scope.gasLimit = new BigNumber(blockNewest.gasLimit).toFormat(0) + " m/s";

                            // Time
                            var newDate = new Date();
                            newDate.setTime(blockNewest.timestamp * 1000);
                            $scope.time = newDate.toUTCString();

                            $scope.secondsSinceBlock1 = blockNewest.timestamp - 1438226773;
                            $scope.daysSinceBlock1 = ($scope.secondsSinceBlock1 / 86400).toFixed(2);

                            // Average Block Times:
                            // TODO: make fully async, put below into 'fastInfosCtrl'

                            var blockBefore = web3.eth.getBlock($scope.blockNum - 1);
                            if (blockBefore !== undefined) {
                                $scope.blocktime = blockNewest.timestamp - blockBefore.timestamp;
                            }
                            $scope.range1 = 100;
                            range = $scope.range1;
                            var blockPast = web3.eth.getBlock(Math.max($scope.blockNum - range, 0));
                            if (blockBefore !== undefined) {
                                $scope.blocktimeAverage1 = ((blockNewest.timestamp - blockPast.timestamp) / range).toFixed(2);
                            }
                            $scope.range2 = 1000;
                            range = $scope.range2;
                            var blockPast = web3.eth.getBlock(Math.max($scope.blockNum - range, 0));
                            if (blockBefore !== undefined) {
                                $scope.blocktimeAverage2 = ((blockNewest.timestamp - blockPast.timestamp) / range).toFixed(2);
                            }
                            $scope.range3 = 10000;
                            range = $scope.range3;
                            var blockPast = web3.eth.getBlock(Math.max($scope.blockNum - range, 0));
                            if (blockBefore !== undefined) {
                                $scope.blocktimeAverage3 = ((blockNewest.timestamp - blockPast.timestamp) / range).toFixed(2);
                            }
                            $scope.range4 = 100000;
                            range = $scope.range4;
                            var blockPast = web3.eth.getBlock(Math.max($scope.blockNum - range, 0));
                            if (blockBefore !== undefined) {
                                $scope.blocktimeAverage4 = ((blockNewest.timestamp - blockPast.timestamp) / range).toFixed(2);
                            }

                            range = $scope.blockNum;
                            var blockPast = web3.eth.getBlock(1);
                            if (blockBefore !== undefined) {
                                $scope.blocktimeAverageAll = ((blockNewest.timestamp - blockPast.timestamp) / range).toFixed(2);
                            }


                            //fastAnswers($scope);
                            //$scope=BlockExplorerConstants($scope);

                        }
                    }

                    // Block Explorer Info

                    $scope.isConnected = web3.isConnected();
                    //$scope.peerCount = web3.net.peerCount;
                    $scope.versionApi = web3.version.api;
                    $scope.versionClient = web3.version.client;
                    $scope.versionNetwork = web3.version.network;
                    $scope.versionCurrency = web3.version.ethereum; // TODO: change that to currencyname?

                    // ready for the future:
                    try {
                        $scope.versionWhisper = web3.version.whisper;
                    } catch (err) {
                        $scope.versionWhisper = err.message;
                    }

                });

            function getChainInfos() {
                var deferred = $q.defer();
                deferred.resolve(0); // dummy value 0, for now. // see blockInfosController.js
                return deferred.promise;
            }
        };
        $scope.init();
        console.log($scope.result);

    };
})();

(function() {
    angular
        .module('myApp')

        .controller('mainDashCtrl', mainDashCtrl);


    mainDashCtrl.$inject = ['$rootScope', '$scope', '$location', '$timeout'];


    function mainDashCtrl($rootScope, $scope, $location, $timeout) {
        var web3 = $rootScope.web3;
        var BigNumber = require('bignumber.js');
        // Display & update block list
        // getETHRates();
        updateBlockList();
        updateTXList();
        updateStats();
        // getHashrate();

        web3.eth.filter("latest").watch(function(error, result) {
            if (error) {
                console.log(error);
            } else {
                updateBlockList();
                updateTXList();
                updateStats();
                $scope.$apply();
            }
        });

        $scope.processRequest = function() {
            var requestStr = $scope.ethRequest;


            if (requestStr !== undefined) {

                // maybe we can create a service to do the reg ex test, so we can use it in every controller ?

                var regexpTx = /[0-9a-zA-Z]{64}?/;
                //var regexpAddr =  /[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}/; // TODO ADDR REGEX or use isAddress(hexString) API ?
                var regexpAddr = /^(0x)?[0-9a-f]{40}$/; //New ETH Regular Expression for Addresses
                var regexpBlock = /[0-9]{1,7}?/;

                var result = regexpTx.test(requestStr);
                if (result === true) {
                    goToTxInfos(requestStr)
                } else {
                    result = regexpAddr.test(requestStr.toLowerCase());
                    if (result === true) {
                        goToAddrInfos(requestStr.toLowerCase())
                    } else {
                        result = regexpBlock.test(requestStr);
                        if (result === true) {
                            goToBlockInfos(requestStr)
                        } else {
                            console.log("nope");
                            return null;
                        }
                    }
                }
            } else {
                return null;
            }
        };


        function goToBlockInfos(requestStr) {
            $location.path('/block/' + requestStr);
        }

        function goToAddrInfos(requestStr) {
            $location.path('/address/' + requestStr.toLowerCase());
        }

        function goToTxInfos(requestStr) {
            $location.path('/tx/' + requestStr);
        }

        function updateStats() {
            $scope.blockNum = web3.eth.blockNumber; // now that was easy

            if ($scope.blockNum !== undefined) {

                // TODO: put the 2 web3.eth.getBlock into the async function below
                //       easiest to first do with fastInfosCtrl
                var blockNewest = web3.eth.getBlock($scope.blockNum);

                if (blockNewest !== undefined) {

                    // difficulty
                    $scope.difficulty = blockNewest.difficulty;
                    $scope.difficultyToExponential = blockNewest.difficulty.toExponential(3);

                    $scope.totalDifficulty = blockNewest.totalDifficulty;
                    $scope.totalDifficultyToExponential = blockNewest.totalDifficulty.toExponential(3);

                    $scope.totalDifficultyDividedByDifficulty = $scope.totalDifficulty.dividedBy($scope.difficulty);
                    $scope.totalDifficultyDividedByDifficulty_formatted = $scope.totalDifficultyDividedByDifficulty.toFormat(1);

                    $scope.AltsheetsCoefficient = $scope.totalDifficultyDividedByDifficulty.dividedBy($scope.blockNum);
                    $scope.AltsheetsCoefficient_formatted = $scope.AltsheetsCoefficient.toFormat(4);

                    // large numbers still printed nicely:
                    $scope.difficulty_formatted = $scope.difficulty.toFormat(0);
                    $scope.totalDifficulty_formatted = $scope.totalDifficulty.toFormat(0);

                    // Gas Limit
                    $scope.gasLimit = new BigNumber(blockNewest.gasLimit).toFormat(0) + " m/s";


                    // Adding new difficulty





                    // Time
                    var newDate = new Date();
                    newDate.setTime(blockNewest.timestamp * 1000);
                    $scope.time = newDate.toUTCString();

                    $scope.secondsSinceBlock1 = blockNewest.timestamp - 1438226773;
                    $scope.daysSinceBlock1 = ($scope.secondsSinceBlock1 / 86400).toFixed(2);

                    // Average Block Times:
                    // TODO: make fully async, put below into 'fastInfosCtrl'

                    var blockBefore = web3.eth.getBlock($scope.blockNum - 1);
                    if (blockBefore !== undefined) {
                        $scope.blocktime = blockNewest.timestamp - blockBefore.timestamp;
                    }
                    $scope.range1 = 100;
                    range = $scope.range1;
                    var blockPast = web3.eth.getBlock(Math.max($scope.blockNum - range, 0));
                    if (blockBefore !== undefined) {
                        $scope.blocktimeAverage1 = ((blockNewest.timestamp - blockPast.timestamp) / range).toFixed(2);
                    }
                    $scope.range2 = 1000;
                    range = $scope.range2;
                    var blockPast = web3.eth.getBlock(Math.max($scope.blockNum - range, 0));
                    if (blockBefore !== undefined) {
                        $scope.blocktimeAverage2 = ((blockNewest.timestamp - blockPast.timestamp) / range).toFixed(2);
                    }
                    $scope.range3 = 10000;
                    range = $scope.range3;
                    var blockPast = web3.eth.getBlock(Math.max($scope.blockNum - range, 0));
                    if (blockBefore !== undefined) {
                        $scope.blocktimeAverage3 = ((blockNewest.timestamp - blockPast.timestamp) / range).toFixed(2);
                    }
                    $scope.range4 = 100000;
                    range = $scope.range4;
                    var blockPast = web3.eth.getBlock(Math.max($scope.blockNum - range, 0));
                    if (blockBefore !== undefined) {
                        $scope.blocktimeAverage4 = ((blockNewest.timestamp - blockPast.timestamp) / range).toFixed(2);
                    }

                    range = $scope.blockNum;
                    var blockPast = web3.eth.getBlock(1);
                    if (blockBefore !== undefined) {
                        $scope.blocktimeAverageAll = ((blockNewest.timestamp - blockPast.timestamp) / range).toFixed(2);
                    }

                    //fastAnswers($scope);
                    //$scope=BlockExplorerConstants($scope);

                }
            }
            // Block Explorer Info
            $scope.isConnected = web3.isConnected();
            //$scope.peerCount = web3.net.peerCount;
            $scope.versionApi = web3.version.api;
            $scope.versionClient = web3.version.client;
            //$scope.versionNetwork = web3.version.network;
            $scope.versionCurrency = web3.version.ethereum; // TODO: change that to currencyname?

            // ready for the future:
            try {
                $scope.versionWhisper = web3.version.whisper;
            } catch (err) {
                $scope.versionWhisper = err.message;
            }
        }


        function updateTXList() {
            var currentTXnumber = web3.eth.blockNumber;
            $scope.txNumber = currentTXnumber;
            $scope.recenttransactions = [];
            for (var i = 0; i < 10 && currentTXnumber - i >= 0; i++) {
                if (web3.eth.getTransactionFromBlock(currentTXnumber - i) != null) {
                    $scope.recenttransactions.push(web3.eth.getTransactionFromBlock(currentTXnumber - i));
                }
            }
        }

        function updateBlockList() {
            var currentBlockNumber = web3.eth.blockNumber;
            $scope.blockNumber = currentBlockNumber;
            $scope.blocks = [];
            for (var i = 0; i < 10 && currentBlockNumber - i >= 0; i++) {
                $scope.blocks.push(web3.eth.getBlock(currentBlockNumber - i));
            }
        }

    }
})();

(function() {
    angular
        .module('myApp')

        .controller('transactionInfosCtrl', transactionInfosCtrl);

    transactionInfosCtrl.$inject = ['$rootScope', '$scope', '$location', '$stateParams', '$q'];

    function transactionInfosCtrl($rootScope, $scope, $location, $routeParams, $q) {
        var web3 = $rootScope.web3;
        $scope.init = function() {


            $scope.txId = $routeParams.transactionId;




            if ($scope.txId !== undefined) { // add a test to check if it match tx paterns to avoid useless API call, clients are not obliged to come from the search form...

                getTransactionInfos()
                    .then(function(result) {
                        //TODO Refactor this logic, asynchron calls + services....
                        var number = web3.eth.blockNumber;

                        $scope.result = result;

                        if (result.blockHash !== undefined) {
                            $scope.blockHash = result.blockHash;
                        } else {
                            $scope.blockHash = 'pending';
                        }
                        if (result.blockNumber !== undefined) {
                            $scope.blockNumber = result.blockNumber;
                        } else {
                            $scope.blockNumber = 'pending';
                        }
                        $scope.from = result.from;
                        $scope.gas = result.gas;
                        //$scope.gasPrice = result.gasPrice.c[0] + " WEI";
                        $scope.gasPrice = web3.fromWei(result.gasPrice, "ether").toFormat(10) + " ETH";
                        $scope.hash = result.hash;
                        $scope.input = result.input; // that's a string
                        $scope.nonce = result.nonce;
                        $scope.to = result.to;
                        $scope.transactionIndex = result.transactionIndex;
                        //$scope.ethValue = web3.fromWei(result.value[0], "ether"); Newer method but has ""
                        $scope.ethValue = result.value.c[0] / 10000;
                        $scope.txprice = web3.fromWei(result.gas * result.gasPrice, "ether") + " ETH";
                        if ($scope.blockNumber !== undefined) {
                            $scope.conf = number - $scope.blockNumber;
                            if ($scope.conf === 0) {
                                $scope.conf = 'unconfirmed'; //TODO change color button when unconfirmed... ng-if or ng-class
                            }
                        }
                        //TODO Refactor this logic, asynchron calls + services....
                        if ($scope.blockNumber !== undefined) {
                            var info = web3.eth.getBlock($scope.blockNumber);
                            if (info !== undefined) {
                                $scope.time = info.timestamp;
                            }
                        }

                    });

            } else {
                $location.path("/"); // add a trigger to display an error message so user knows he messed up with the TX number
            }


            function getTransactionInfos() {
                var deferred = $q.defer();

                web3.eth.getTransaction($scope.txId, function(error, result) {
                    if (!error) {
                        deferred.resolve(result);
                    } else {
                        deferred.reject(error);
                    }
                });
                return deferred.promise;

            }



        };
        $scope.init();
        console.log($scope.result);

    };
})();

(function() {
    angular
        .module('myApp')
        .controller('dashboardCtrl', dashboardCtrl);

    dashboardCtrl.$inject = ['$scope', '$http', 'authentication'];

    function dashboardCtrl($scope, $http, authentication) {
        console.log("inside dashboardCtrl ");
        var vm = this;
        vm.showAccordion = false;
        vm.lcDetailsEnabled = true;
        $scope.today = new Date();


        vm.showRadioBtnDetail = function(formobj, slctdRadioBtn) {
            console.log("slctdRadioBtn=" + slctdRadioBtn);
            formobj.lcSelected = "";
            vm.lcDetailsEnabled = true;
            vm.showAccordion = false;
            console.log("dashboardForm.lcSelected==" + formobj.lcSelected);
            if (slctdRadioBtn == 'contractDate') {
                if (formobj.startDate != undefined && formobj.endDate != undefined) {
                    console.log("from date" + formobj.startDate);
                    console.log("from date" + formobj.endDate);

                    $http.get('/dashboard/fetchPO/' + formobj.startDate + '/' + formobj.endDate, {
                        headers: {
                            Authorization: 'Bearer ' + authentication.getToken()
                        }
                    }).then(function(response) {
                        console.log("dashboard controller-if");
                        $scope.dashboards = response.data;
                        console.log("dashboard controller-if-1" + response.data);
                    }, function(response) {
                        console.log(response.status);
                    });
                }
            } else if (slctdRadioBtn == 'poNumber' || slctdRadioBtn == 'lcNumber') {
                formobj.startDate = "";
                formobj.endDate = "";
                // if selected radio type is not date, its either PO or LC Number
                $http.get('/dashboard/LCDetails', {
                    headers: {
                        Authorization: 'Bearer ' + authentication.getToken()
                    }
                }).then(function(response) {
                    console.log("dashboard controller-else");
                    $scope.dashboards = response.data;
                    console.log(response.data);
                }, function(response) {
                    console.log(response.status);
                });
            }


        }

        vm.toTimestamp = function(timeObj) {
            return new Date(timeObj).getTime();
        }

        vm.showLCDetail = function(lcDetails) {
            console.log("lcNumber is" + lcDetails.lcNumber);
            vm.showAccordion = true;
            vm.lcDetailsEnabled = false;
        };

        $scope.range = function(min, max, step) {
            console.log("max=" + max);
            step = step || 1;
            var input = [];
            for (var i = min; i <= max; i += step) {
                input.push(i);
            }
            return input;
        };
    }



})();

// (function() {
//
//     angular
//         .module('myApp')
//         .controller('detailsCtrl', detailsCtrl);
//
//     detailsCtrl.$inject = ['$scope', '$http', '$stateParams', 'authentication'];
//
//
//     function detailsCtrl($scope, $http, $stateParams, authentication) {
//         $http.get('/artists/list', {
//             headers: {
//                 Authorization: 'Bearer ' + authentication.getToken()
//             }
//         }).then(function(response) {
//             $scope.artists = response.data;
//             $scope.whichItem = $stateParams.itemId;
//             console.log($scope.whichItem);
//
//             if ($stateParams.itemId > 0) {
//                 $scope.prevItem = Number($stateParams.itemId) - 1;
//             } else {
//                 $scope.prevItem = $scope.artists.length - 1;
//             }
//
//             if ($stateParams.itemId < $scope.artists.length - 1) {
//                 $scope.nextItem = Number($stateParams.itemId) + 1;
//             } else {
//                 $scope.nextItem = 0;
//             }
//         }, function(response) {
//
//             console.log(response.status);
//         });
//
//     }
// })();

// // //inject angular file upload directives and services.
// // var app = angular.module('fileUpload', ['ngFileUpload']);
//
// (function() {
//
//     angular
//         .module('myApp')
//         .controller('fileCtrl', fileCtrl);
//
//     fileCtrl.$inject = ['$scope', 'Upload', '$timeout'];
//
//     function fileCtrl($scope, Upload, $timeout) {
//         $scope.uploadFiles = function(files) {
//             $scope.files = files;
//             if (files && files.length) {
//                 Upload.upload({
//                     url: '/file/upload',
//                     data: {
//                         files: files
//                     }
//                 }).then(function(response) {
//                     $timeout(function() {
//                         $scope.result = response.data;
//                     });
//                 }, function(response) {
//                     if (response.status > 0) {
//                         $scope.errorMsg = response.status + ': ' + response.data;
//                     }
//                 }, function(evt) {
//                     $scope.progress =
//                         Math.min(100, parseInt(100.0 * evt.loaded / evt.total));
//                 });
//             }
//         };
//     }
// })();


angular.module("myApp").controller("FooterController", ["$scope", function ($scope) {
 
    $scope.submitFeedback = function(action) {
       return;
    }
 
}]);
(function() {
    angular
        .module('myApp')
        .controller('homeCtrl', homeCtrl);

    homeCtrl.$inject = ['$scope', '$http', '$state', 'authentication'];

    function homeCtrl($scope, $http, $state, authentication) {
        var vm = this;

        vm.init = function() {
            $http.get('/home/details/', {
                headers: {
                    Authorization: 'Bearer ' + authentication.getToken()
                }
            }).then(function(response) {
                    console.log("HOME");
                    var userInfo = authentication.currentUser();
                    var homePageData = response.data;
                    var issueBnk;
                    var reUseData;
                    var homePage ={
                      reUseData:"",
                      issueBnk:"",
                      tableHeading1:"",
                      tableHeading2:"",
                      state:"",
                      state1:"",
                      isAppForm:""
                    };

                    if (userInfo.role == 200) {
                        issueBnk = homePageData.filter(function(dataObj) {
                            return (dataObj.lcValue == '100');
                        });
                        reUseData = homePageData.filter(function(dataObj) {
                            return (dataObj.lcValue == '500');
                        });
                        homePage.tableHeading1 = "Issue LC";
                        homePage.tableHeading2 = "Lodge documents";

                        homePage.issueBnk = issueBnk;
                        homePage.reUseData = reUseData;

                        homePage.state1="issueBankLndingPage";
                        homePage.state="acceptLodgementPage";
                    } else if (userInfo.role == 300) {
                          homePage.tableHeading2 = "Accept LC";
                          homePage.state="advisingBankLndingPage";
                          homePage.reUseData= homePageData;
                    } else if (userInfo.role == 400) {
                        homePage.tableHeading2 = "Upload Documents";
                        homePage.state="beneficiaryLndingPage";
                        homePage.reUseData= homePageData;
                    } else if (userInfo.role == 500) {
                        homePage.tableHeading2 = "Lodge Documents";
                        homePage.reUseData= homePageData;
                        homePage.state="presentingLandingPage";
                    }
                    else if (userInfo.role == 100) {
                      homePage.isAppForm = true;
                    }


                    vm.homePageData = homePage;
                    console.log(vm.homePageData);
                },
                function(err) {


                });
        }
        vm.init();

    }
})();

// (function() {
//
//     angular
//         .module('myApp')
//         .controller('ipfsCtrl', ipfsCtrl)
//         .directive('ngFiles', ['$parse', function($parse) {
//
//             function fn_link(scope, element, attrs) {
//                 var onChange = $parse(attrs.ngFiles);
//                 element.on('change', function(event) {
//                     onChange(scope, {
//                         $files: event.target.files
//                     });
//                 });
//             };
//
//             return {
//                 link: fn_link
//             }
//         }])
//
//
//     ipfsCtrl.$inject = ['$scope', '$http', '$state'];
//
//     function ipfsCtrl($scope, $http) {
//
//         var formdata = new FormData();
//         $scope.getTheFiles = function($files) {
//             angular.forEach($files, function(value, key) {
//                 formdata.append(key, value);
//             });
//         };
//         $scope.uploadFiles = function() {
//             var request = {
//                 method: 'POST',
//                 url: 'http://127.0.0.1:5001/api/v0/add',
//                 data: formdata,
//                 headers: {
//                     'Content-Type': undefined
//                 }
//             };
//
//             // SEND THE FILES.
//             $http(request)
//                 .then(function(response) {
//                         $scope.message = response.data.Hash;
//                     },
//                     function(response) {
//                         console.log('Failed');
//                         $scope.message = response.error;
//                     }
//                 );
//
//         }
//
//         $scope.viewIPFS = function() {
//             var fileHash = $scope.file.hash;
//             // /$scope.ipfsUrl = 'http://127.0.0.1:5001/api/v0/cat?arg=' + fileHash;
//             $scope.ipfsUrl = 'http://ipfs.io/ipfs/' + fileHash;
//         }
//     }
// })();
//
//
// var ipfs = window.IpfsApi('localhost', '5001');

/**
 * @author sukohli@deloitte.com
 * /issueBank/home -> controller
 * This controller handles Issue LC, prepopulates, uploads
 * file to ipfs and submits form
 */
(function() {
    angular
        .module('myApp')
        .controller('issueBankCtrl', issueBankCtrl);

    issueBankCtrl.$inject = ['$http', '$scope', '$rootScope', 'apiCall', 'authentication', '$stateParams'];

    function issueBankCtrl($http, $scope, $rootScope, apiCall, authentication, $stateParams) {
        var vm = this;


        // using below regex in ng-pattern
        $scope.onlyNumbers = /^[0-9]{1,7}$/;

        vm.lcDetails = {
            lcFee: "",
            lcNumber: "",
            lcValue: "",
            lcTerms: "",
            message: "",
            showAccordion: false
        };

        console.log("Issue Bank controller !!");

        vm.clear = function() {
            vm.lcDetails.lcNumber = "";
            vm.lcDetails.lcValue = "";
            vm.lcDetails.lcTerms = "";
            vm.lcDetails.message = "";
            $scope.issueLcForm = "";
            vm.lcDetails.lcFee = "";
            vm.lcDetails.lcDocsRequired = "";
            vm.lcDetails.showAccordion = false;
            vm.acceptLcForm.lcNumber.$setValidity('lcUnique', true);
            vm.acceptLcForm.$setPristine();
        }

        vm.submit = function() {
            console.log("Submit function called!");
            var mybody = angular.element(document).find('body');
            mybody.addClass('waiting');
            var lcRequest = {
                "contractID": $scope.issueLcForm._id,
                "lcNumber": vm.lcDetails.lcNumber,
                "lcValue": vm.lcDetails.lcValue,
                "lcTerms": vm.lcDetails.lcTerms,
                "lcFee": vm.lcDetails.lcFee,
                "lcDocsRequired": vm.lcDetails.lcDocsRequired,
                "advisingBankId":vm.lcDetails.advisingBankId
            };
            // disabling submit button
            vm.clear();
            vm.lcDetails.message = "--- Issue Lc In Progress, Please Wait ---";
            apiCall
                .makeCall("/lcRequest/saveLcForm", "post", lcRequest)
                .then(
                    function(response) {
                        // console.log(response.status);
                        // console.log(response.data);
                        console.log("calling init again to update PO Number list");
                        vm.init();
                        vm.clear();
                        mybody.removeClass('waiting');
                        vm.lcDetails.message = response.data;
                    }
                )
        }

        vm.fileView = function(issueLcForm) {
            var fileName = issueLcForm.initiaterFileName;
            window.open("/static/uploadedFiles/" + fileName, "_blank");
        }
        vm.changeLcFee = function(lcValue) {
            // value="{{ ((vm.lcDetails.lcValue * (issueLcForm.lcDuration+issueLcForm.usancePeriod) * 0.75)/365) | number:3}}"
            var RatePercent = 0.0075;
            console.log(lcValue);
            if (lcValue != null && lcValue != "" && lcValue != undefined) {
                console.log("LC duration" + $scope.issueLcForm.lcDuration);
                console.log("Usance Period" + $scope.issueLcForm.usancePeriod);
                console.log("LC Value" + lcValue);
                // var lcFee = (lcValue * ($scope.issueLcForm.lcDuration+$scope.issueLcForm.usancePeriod) * RatePercent) / 365;
                /*var lcFee = (lcValue (1+($scope.issueLcForm.tolerancePercent/100)*RatePercent) * Math.round(($scope.issueLcForm.lcDuration + $scope.issueLcForm.usancePeriod +1 )/30)/12 * (1+.14+.005+.005);
                 */
                console.log("LC Fees" + lcFee);
                vm.lcDetails.lcFee = lcFee.toFixed(2);
            }
        }
        vm.prepopulateLCDetails = function(lcDetails) {
            console.log(lcDetails);
            vm.lcDetails.showAccordion = true;
            var RatePercent = 0.0075;
            if ($scope.issueLcForm != "" && $scope.issueLcForm != undefined &&
                $scope.issueLcForm != null) {
                /*vm.lcDetails.lcFee = ((lcDetails.poValue *
									($scope.issueLcForm.lcDuration+$scope.issueLcForm.usancePeriod) *
									RatePercent) / 365);
									*/


                var lcFee_1 = lcDetails.poValue * (1 + ($scope.issueLcForm.tolerancePercent / 100)) * RatePercent;
                var lcFee_2 = Math.ceil(($scope.issueLcForm.lcDuration + $scope.issueLcForm.usancePeriod + 1) / 30);
                vm.lcDetails.lcFee = (lcFee_1 * lcFee_2) / 12 * (1 + .14 + .005 + .005);

                console.log("========LC FEE =====" + vm.lcDetails.lcFee);
                // 1 LC creation Fee = [(LC Duration + Usance Period) x Rate%]/365
            }
            vm.lcDetails.lcValue = lcDetails.poValue;
        }
        // Prepopulate PO Number
        vm.init = function() {
            console.log("Prepopulate init function called !!");
            // get PO number from mongo
            apiCall
                .makeCall("lcRequest/getPoNumbers", "get")
                .then(
                    function(response) {
                        console.log(response.status);
                        // console.log(response.data);
                        $scope.lcRequestDetails = response.data;
                    }
                ).then(function() {
                        apiCall.makeCall("lcRequest/fetchAdvBank", "get")
                        .then(function(response) {
                            $scope.advBanks = response.data;
                        })
                    }
                )
                .then( function(){
                  if( $stateParams.actionItem != "" && $stateParams.actionItem != null ){
                    console.log("action item not null");
                    console.log($stateParams.actionItem);
                    // console.log($scope.lcRequestDetails[1].poNumber);

                  var selectedPoNumber = $scope.lcRequestDetails.filter(function( dataObj ) {
                          return (dataObj.poNumber == $stateParams.actionItem ) ;
                        });
                  $scope.issueLcForm = selectedPoNumber[0];
                  // to populate lc fee and amount
                  vm.prepopulateLCDetails($scope.issueLcForm);
                  $stateParams.actionItem = "";
                  }
                });
        }

        // select active bootstrap tab
        vm.setTab = function(index) {
            if (index == $rootScope.tabIdentifier) {
                return "active";
            } else {
                return false;
            }
        }

        // calling on load of page
        vm.init();

        // Function to check if LC/Documentary Credit Number is unique for a issueBank
        vm.validateLcNumber = function(lcNumber) {
            console.log("validating lcNumber on blur");
            console.log("lcNumber is : " + lcNumber);
            // encoding while sending as get query parameter
            lcNumber = encodeURIComponent(lcNumber);
            console.log("Encoding lcNumber is : " + lcNumber);
            var issuingBankId = authentication.currentUser().userId;
            if (lcNumber != undefined && lcNumber != "" && lcNumber != null) {
                $http.get('/lcRequest/validateLcNumber/' + lcNumber + '/' + issuingBankId, {
                    headers: {
                        Authorization: 'Bearer ' + authentication.getToken()
                    },
                }).then(function(response) {
                        // if poNumber is unique
                        console.log(response.data.message);
                        // $scope.createLcRequestForm.poNumber.$setValidity("poUnique",true);
                    },
                    function(err) {
                        // if poNumber already exists in DB
                        console.log(err.data.message);
                        vm.acceptLcForm.lcNumber.$setValidity("lcUnique", false);
                        // $scope.createLcRequestForm.poNumber.$setValidity("poUnique",false);
                    });
            }
        }

        vm.removeUniqueMsg = function() {
            vm.acceptLcForm.lcNumber.$setValidity("lcUnique", true);
            // $scope.createLcRequestForm.poNumber.$setValidity("poUnique",true);
        }

        vm.populateAdvising = function(advBank) {
            $scope.issueLcForm.advisingBankId.branch=advBank.branch;
            $scope.issueLcForm.advisingBankId.address=advBank.address;
            vm.lcDetails.advisingBankId=advBank._id;
        };
    }
})();

// (function() {
//
//     angular
//         .module('myApp')
//         .controller('listCtrl', listCtrl);
//
//     listCtrl.$inject = ['$scope', '$http', '$state', 'authentication'];
//
//     function listCtrl($scope, $http, $state, authentication) {
//
//         $http.get('/artists/list', {
//             headers: {
//                 Authorization: 'Bearer ' + authentication.getToken()
//             }
//         }).then(
//             function(response) {
//                 // $scope.status = response.status;
//
//                 $scope.artists = response.data;
//                 $scope.artistOrder = 'reknown';
//             },
//             function(response) {
//                 console.log(response.status);
//                 console.log(response.error);
//                 console.log(response.data);
//                 $scope.data = response.data || 'Request failed';
//                 $scope.status = response.status;
//             });
//
//
//
//     }
// })();

(function() {
    angular
        .module('myApp')
        .controller('loginCtrl', loginCtrl);

    loginCtrl.$inject = ['$state', 'authentication'];

    function loginCtrl($state, authentication) {
        var vm = this;

        if (authentication.isLoggedIn()) {
            console.log(authentication.getToken());
            $state.go('home');
        }

        vm.credentials = {
            email: "",
            password: ""
        };

        vm.errorMsg = {
            message: ""
        };


        vm.login = function() {
            authentication
                .login(vm.credentials)
                .then(function(response) {
                    if (response.status !== 200) {
                        vm.errorMsg.message = response.data.message;
                        $state.go('login');
                    } else {
                        $state.go('home');
                    }

                }, function(response) {
                    // in case Angular service failed
                });
        };
    };

})();

(function() {

    angular
        .module('myApp')
        .controller('navigationCtrl', navigationCtrl);

    //TODO - remove HTTP after test , we should not make Service calls from here
    navigationCtrl.$inject = ['$location', 'authentication', '$state', '$http',
    '$rootScope'];

    function navigationCtrl($location, authentication, $state, $http,
      $rootScope) {
        var vm = this;

        vm.isLoggedIn = authentication.isLoggedIn();

        vm.currentUser = authentication.currentUser();

        vm.role = authentication.role();
        console.log("Current User Roles: => ");
        console.log(vm.role);

        vm.ifRoleExists = function(role){
          var result = vm.role.indexOf(role);
          if( result == -1 ){
            return false;
          }
          return true;
        }


        vm.logout = function() {
            authentication
                .logout();
            // $state.go('logout');
        };

        vm.inState = function(state) {
            return $state.is(state);
        }

        vm.deployContract = function() {
            $http.get('/eth/socket', {
                headers: {
                    Authorization: 'Bearer ' + authentication.getToken()
                }
            }).then(
                function(response) {
                    console.log(response);

                },
                function(response) {
                    console.log(response.data.message);
                });

        }

        vm.setTabIdentifier = function(id){
          // console.log("reached tab identifier !!");
          // console.log(id);
          $rootScope.tabIdentifier = id;
          // console.log($rootScope.tabIdentifier);
        }
    }

})();

(function() {
    angular
        .module('myApp')
        .controller('issueFormCtrl', issueFormCtrl);

    issueFormCtrl.$inject = ['$scope','$http','authentication'];

    function issueFormCtrl($scope,$http,authentication) {
      console.log("inside IssueForm controller@@@@@@@@@");
      var vm=this;
      $http.get('/issuingForm/issue', {
                 headers: {
                     Authorization: 'Bearer ' + authentication.getToken()
                 }
             }).then(function(response) {

                 $scope.poList = response.data;

                 console.log(response.data);


             }, function(response) {

                 console.log(response.status);
             });


             vm.fetchDetail = function(id) {
                var po = id.po;
               $http.get('/issuingForm/fetchdetail/'+po, {
                          headers: {
                              Authorization: 'Bearer ' + authentication.getToken()
                          }
                      }).then(function(response) {
                          $scope.poDetail= response.data;
                          console.log(response.data);
                      }, function(response) {
                          console.log(response.status);
                      });


             };

             vm.submit = function(id) {
               console.log("The submit call to service");
               var po = {'po': id.po};
                 $http.post('/issuingForm/submit/',po, {
                            headers: {
                                Authorization: 'Bearer ' + authentication.getToken()
                            }
                        }).then(function(response) {
                          console.log(response);
                            // $scope.messsage= "Workflow changes done";
                        }, function(response) {
                            console.log(response);
                        });


             };

        }
    })();

(function() {
    angular
        .module('myApp')
        .controller('notificationCtrl', notificationCtrl);

    notificationCtrl.$inject = ['$scope', '$http', 'authentication', '$timeout', '$state'];

    function notificationCtrl($scope, $http, authentication, $timeout, $state) {
        var vm = this;
        vm.showAccordion = false;
        vm.lcDetailsEnabled = true;
        // ENUM
        $scope.notificatoinText = [{
                99: "Stage 'Initiate LC Request'[PO# {0}]: Request initiated by {1}. File - {3} uploaded successfully. Block chain processing commenced."
            },
            {
                100: "Stage 'Initiate LC Request'[PO# {0}]: Block chain processing completed. Documents forwarded to issuing bank. Request Initiation complete. "
            },
            {
                199: "Stage 'Issuing bank verification'[LC# {2}]: Documents reviewed and verified. Block chain processing commenced. "
            },
            {
                200: "Stage 'Issuing bank verification'[LC# {2}]: Block chain processing completed. Documents forwarded to Advising bank. Issuing bank verification stage complete."
            },
            {
                299: "Stage 'Advising bank verification'[LC# {2}]: Documents reviewed and verified. Block chain processing commenced. "
            },
            {
                300: "Stage 'Advising bank verification'[LC# {2}]: Block chain processing completed. Documents forwarded to beneficiary. Advising bank verification stage complete."
            },
            {
                399: "Stage 'Beneficiary proof submission'[LC# {2}]: LC documents reviewed by beneficiary. Bill and Proof documents uploaded successfully.  Block chain processing commenced."
            },
            {
                400: "Stage 'Beneficiary proof submission' [LC# {2}]: Block chain processing completed. Bill and Proof documents forwarded to Presenting bank. Beneficiary proof submission stage complete."
            },
            {
                499: "Stage 'Presenting bank verification'[LC# {2}]: Bill and Proof documents reviewed and verified. Block chain processing commenced."
            },
            {
                500: "Stage 'Presenting bank verification'[LC# {2}]: Block chain processing completed. Bill and Proof documents forwarded to Issuing bank. Presenting bank verification stage complete."
            },
            {
                599: "Stage 'Issuing bank Lodgement'[LC# {2}]: Bill and Proof documents reviewed and verified. LC amount released to Presenting bank. Block chain processing commenced. "
            },
            {
                600: "Stage 'Issuing bank Lodgement'[LC# {2}]: Block chain processing completed. Bill and Proof documents lodged. LC amount transferred. Issuing bank Lodgement stage complete."
            }
        ];



        $scope.reload = function() {
            $http.get('/notification/LCDetails', {
                headers: {
                    Authorization: 'Bearer ' + authentication.getToken()
                }
            }).then(function(response) {
                // console.log("notification controller");
                vm.notifications = response.data;

                vm.workFlowsSeg = [];
                var poNumbers = [];
                var workFlows = [];
                var workFlowsSeg = [];
                var myMap = new Map();
                var first = 1;
                var value = -1;
                // console.log(response.data);
                angular.forEach(response.data, function(item) {
                    angular.forEach(item.workflows, function(workflow) {

                        // console.log(workflow);

                        var dateToSet = new Date(workflow.createdDateUTC);
                        var timeToSet = dateToSet.getTime(); // + dateToSet.getTimezoneOffset()*60*1000;
                        if (typeof myMap.get(timeToSet) !== 'undefined') {

                            var timeSegregation = myMap.get(timeToSet);
                            var timeSegregation1 = [];
                            timeSegregation1.transactionDT = workflow.createdDateUTC;
                            timeSegregation1.fileName = item.initiaterFileName;
                            timeSegregation1.stage = workflow.stage;
                            timeSegregation1.poNumbers = item.poNumber;
                            timeSegregation1.lcNumber = item.lcNumber;
                            timeSegregation1.buyerName = item.buyerId.name;
                            timeSegregation1.timeStamp = workflow.createdDateUTC;
                            timeSegregation1.offSet = timeToSet;
                            timeSegregation1.transactionHash = workflow.transactionHash;
                            timeSegregation.push(timeSegregation1);
                            myMap.set(timeToSet, timeSegregation);
                        } else {
                            var timeSegregation = [];
                            timeSegregation.transactionDT = workflow.createdDateUTC;
                            timeSegregation.fileName = item.initiaterFileName;
                            timeSegregation.stage = workflow.stage;
                            timeSegregation.poNumbers = item.poNumber;
                            timeSegregation.lcNumber = item.lcNumber;
                            timeSegregation.buyerName = item.buyerId.name;
                            timeSegregation.timeStamp = workflow.createdDateUTC;
                            timeSegregation.offSet = timeToSet;
                            timeSegregation.transactionHash = workflow.transactionHash;
                            myMap.set(timeToSet, timeSegregation);
                        }

                        // Self code for Creating Array

                        /*  var dateToSet1 = new Date(workflow.createdDateUTC);
                  var timeToSet1 = dateToSet1.getTime() ; //+ dateToSet1.getTimezoneOffset()*60*1000;
                  var tymStamp = timeToSet1;

                    value = -1;
                    if (first == 1) {
                        first = 2;
                        console.log("first time ");
                        var sameTime = [];
                        var dateToSet2 = new Date(workflow.createdDateUTC);
                        var timeToSet2 = dateToSet2.getTime() ;//+ dateToSet2.getTimezoneOffset()*60*1000;

                        sameTime.poNumber = item.poNumber;
                        sameTime.stage = workflow.stage;
                        sameTime.timeStamp = workflow.createdDateUTC;
                        sameTime.offSet = timeToSet2;
                        sameTime.fileName= item.initiaterFileName;
						sameTime.lcNumber= item.lcNumber;
						sameTime.buyerName= item.buyerId.name;
                        poNumbers.push(sameTime);
                        poNumbers.timeStamp = timeToSet2;
                      //  poNumbers.timeStamp = workflow.createdDateUTC;
                        workFlowsSeg.poNumbers = poNumbers;
                    } else {
                        console.log("The second time and on ");
                        angular.forEach(workFlowsSeg.poNumbers, function(poNumber) {

                          var dateToSet4 = new Date(poNumber.timeStamp);
                          var storedTym = dateToSet4.getTime() ;//+ dateToSet4.getTimezoneOffset()*60*1000;

                          //  var storedTym = poNumber.timeStamp;
                            if (storedTym == tymStamp) {
                                value = 1;
                                var sameTime = [];
                                sameTime.poNumber = item.poNumber;
                                sameTime.stage = workflow.stage;
                                sameTime.timeStamp = workflow.createdDateUTC;
                                sameTime.fileName= item.initiaterFileName;
                                sameTime.offSet = storedTym;
								sameTime.lcNumber= item.lcNumber;
								sameTime.buyerName= item.buyerId.name;
                                poNumber.push(sameTime);
                            }
                        });
                        if (value == -1) {
                            var sameTime = [];
                            var dateToSet = new Date(workflow.createdDateUTC);
                            var timeToSet = dateToSet.getTime() ;//+ dateToSet.getTimezoneOffset()*60*1000;
							sameTime.poNumber = item.poNumber;
                            sameTime.stage = workflow.stage;
                            sameTime.timeStamp = workflow.createdDateUTC;
                            sameTime.fileName= item.initiaterFileName;
							sameTime.lcNumber= item.lcNumber;
							sameTime.buyerName= item.buyerId.name;
                            sameTime.offSet = timeToSet;
                            poNumbers.push(sameTime);
							poNumbers.timeStamp = timeToSet;
                            //poNumbers.timeStamp = workflow.createdDateUTC;
                            workFlowsSeg.poNumbers = poNumbers;
                        }
                    }
					*/
                    });
                });
                /*
            $scope.notificationEntries = workFlowsSeg.poNumbers.sort(function (a, b) {
				  return b.offSet - a.offSet;
			});
			*/
                // console.log(myMap);
                var mapDesc = new Map([...myMap.entries()].sort().reverse());
                // console.log("Sorrted ------");
                $scope.notificationEntries = Array.from(mapDesc);
                console.log($scope.notificationEntries);
            }, function(response) {
                // console.log(response.status);
            });
            // end http get
            timeoutId = $timeout(function() {
                $scope.reload();
            }, 5000)
        };
        $scope.reload();

        $scope.$on("$destroy", function(event) {
            $timeout.cancel(timeoutId);
        });

        vm.toTimestamp = function(timeObj) {
            return new Date(timeObj).getTime();
        }

        vm.showLCDetail = function(lcDetails) {
            // console.log("lcNumber is" + lcDetails.lcNumber);
            vm.showAccordion = true;
            vm.lcDetailsEnabled = false;
        }

        $scope.range = function(min, max, step) {
            // console.log("max=" + max);
            step = step || 1;
            var input = [];
            for (var i = min; i <= max; i += step) {
                input.push(i);
            }
            return input;
        }
    }



})();

// (function() {
//     angular
//         .module('myApp')
//         .controller('logoutCtrl', logoutCtrl);
//
//     logoutCtrl.$inject = ['$state', 'authentication'];
//
//     function logoutCtrl($state, authentication) {
//         var vm = this;
//
//
//
//     }
// })();

(function() {
    angular
        .module('myApp')
        .controller('presentingCtrl', presentingCtrl);

    presentingCtrl.$inject = ['$scope','$http','authentication','$rootScope','$window','$state','$stateParams'];

    function presentingCtrl($scope,$http,authentication, $rootScope,$window,$state,$stateParams) {
		console.log("inside presentingCtrl-1111")
	  var vm = this;
       vm.init = function(){
	     $http.get('/presenting/lcDetails/', {
			 headers: {
				 Authorization: 'Bearer ' + authentication.getToken()
			 }
		 }).then(function(response) {
			$scope.acptLdgmentLCList = response.data;
			console.log($scope.acptLdgmentLCList);
		 }, function(response) {
			   var user = authentication.currentUser();
			   if(user.role!=500) {
				   $scope.errorMsg = "Not the correct role required";
				   $state.go('home');
			   }
			 })
       .then( function(){
         if( $stateParams.actionItem != "" && $stateParams.actionItem != null ){
           console.log("action item not null");
           console.log($stateParams.actionItem);

           console.log($scope.acptLdgmentLCList);
         var selectedLcNumber = $scope.acptLdgmentLCList.filter(function( dataObj ) {
                 return (dataObj.lcNumber == $stateParams.actionItem ) ;
               });
         $scope.acptLdgmentFormDetails = selectedLcNumber[0];
         vm.showAccordion = true;
         $stateParams.actionItem = "";
         }
       });
	   }

	  /* function to enable Accordian on selection of LC Number on the HTML page */
	  vm.fetchDetail = function(lcDetails){
      if( lcDetails != null && lcDetails != ""){
        vm.showAccordion = true;
      }
	  }


	  /* Function to clear the fields on reset button */
	  vm.clear = function(){
			console.log("clear all fields inside acceptLodgementService-2");
		   if( $scope.acptLdgmentFormDetails != "" && $scope.acptLdgmentFormDetails != undefined
          && $scope.acptLdgmentFormDetails != null ){
			  console.log("clearing all fields");
			  $scope.acptLdgmentFormDetails = "";
			  vm.showAccordion=false;
        $scope.displayMessage="";
		  }

	  }

	  /* Function to Save the Advising bank screen details */
	  vm.submit = function(lcDetails){
		  console.log("inside acceptLodgementController->submit()");
		  console.log("contractID="+lcDetails._id);
		  var contractID = {'contractID': lcDetails._id};
		   $http.post('/presenting/acceptLC',contractID, {
                headers: {
                    Authorization: 'Bearer ' + authentication.getToken()
                }
            }).then(
                function(response) {
      			      vm.init();
  			          $scope.displayMessage="Documents Verified and Submitted For Blockchain Processing";
            			vm.showAccordion = false;
                },
                function(response) {
                    console.log(response.data.message);
                });
		}

	  vm.setTab = function(index){
        if( index == $rootScope.tabIdentifier ){
          return "active";
        }
        else{
          return false;
        }
      }
	  vm.init();
    }
})();

angular.module("myApp").directive("footer", function() {
  return {
    restrict: 'A',
    templateUrl: 'partials/footer.html',
    scope: true,
    transclude : false,
    controller: 'FooterController'
  };
});
(function() {
    angular
        .module('myApp')
        .controller('signUpCtrl', signUpCtrl);

    signUpCtrl.$inject = ['$state', 'authentication'];

    function signUpCtrl($state, authentication) {
        var vm = this;
        vm.credentials = {
            name: "",
            email: "",
            password: "",
            address: "",
            role: ""
        };
        vm.errorMsg = {
            message: ""
        };
        vm.submit = function() {
            authentication
                .register(vm.credentials)
                .then(function(response) {
                    if (response.status !== 200) {
                        vm.errorMsg.message = response.data.message;
                        $state.go('signup');
                    } else {
                        $state.go('home');
                    }
                }, function(response) {
                    console.log("In Error of the Angular Service Call");
                });
        };

        vm.clear = function() {
            vm.credentials = {
                name: "",
                email: "",
                password: "",
                role: "",
                address: ""
            };

        }

    }

})();

(function() {
    angular
        .module('myApp')
        .controller('advisingBankCtrl', advisingBankCtrl);

    advisingBankCtrl.$inject = ['$scope','$http','authentication','$rootScope','$window','$state','$stateParams'];

    function advisingBankCtrl($scope,$http,authentication, $rootScope,$window,$state,$stateParams) {
	  var vm = this;
       vm.init = function(){
	     $http.get('/advBank/lcDetails', {
			 headers: {
				 Authorization: 'Bearer ' + authentication.getToken()
			 }
		 }).then(function(response) {
	        $scope.advBankLCList = response.data;
		 }, function(response) {
			   var user = authentication.currentUser();
			   if(user.role!=300) {
				   $scope.errorMsg = "Not the correct role";
				   $state.go('home');
			   }
			 })
       .then( function(){
         if( $stateParams.actionItem != "" && $stateParams.actionItem != null ){
           console.log("action item not null");
           console.log($stateParams.actionItem);

           console.log($scope.advBankLCList);
         var selectedLcNumber = $scope.advBankLCList.filter(function( dataObj ) {
                 return (dataObj.lcNumber == $stateParams.actionItem ) ;
               });
         console.log(selectedLcNumber[0]);
         $scope.advBankFormDetails = selectedLcNumber[0];
         vm.showAccordion = true;
         $stateParams.actionItem = "";
         }
       });
	   }

	  vm.fetchDetail = function(lcDetails){
      if( lcDetails != null && lcDetails != ""){
        vm.showAccordion = true;
      }
	  }

	  /* Function to display the PDF file from IPFS */
	  /*
	  vm.displayPDF = function(lcDetails){
		var fileName = lcDetails.initiaterFileName;
		window.open("/static/uploadedFiles/"+fileName,"_blank");
	  }
	  */

	  /* Function to clear the fields on reset button */
	  vm.clear = function(){
		   if( $scope.advBankFormDetails != "" && $scope.advBankFormDetails != undefined
          && $scope.advBankFormDetails != null ){
			  $scope.advBankFormDetails = "";
		  }
      vm.showAccordion = false;
      $scope.displayMessage = "";
	  }

	  /* Function to Save the Advising bank screen details */
	  vm.submit = function(lcDetails){
		  var contractID = {'contractID': lcDetails._id};
		   $http.post('/advBank/lcAccept',contractID, {
                headers: {
                    Authorization: 'Bearer ' + authentication.getToken()
                }
            }).then(
                function(response) {
      			       vm.init();
                   vm.showAccordion = false;
                   $scope.displayMessage="LC Accepted : Block chain processing initiated";
                },
                function(response) {
                    console.log(response.data.message);
                });
		}
      vm.setTab = function(index){
        if( index == $rootScope.tabIdentifier ){
          return "active";
        }
        else{
          return false;
        }
      }
	  vm.init();
    }
})();

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInNlcnZpY2VzL2FwaUNhbGwuc2VydmljZS5qcyIsInNlcnZpY2VzL2F1dGhlbnRpY2F0aW9uLnNlcnZpY2UuanMiLCJkaXJlY3RpdmVzL2Zvcm1hdHRlci9mb3JtYXQuanMiLCJkaXJlY3RpdmVzL2dvQmFjay9nb0JhY2suZGlyZWN0aXZlLmpzIiwiZGlyZWN0aXZlcy9saW1pdFRvTWF4TWluL2xpbWl0VG9NYXhNaW4uZGlyZWN0aXZlLmpzIiwiZGlyZWN0aXZlcy9uYXZpZ2F0aW9uL25hdmlnYXRpb24uZGlyZWN0aXZlLmpzIiwiZGlyZWN0aXZlcy9wcmludHBhZ2UvcHJpbnRwYWdlLmRpcmVjdGl2ZS5qcyIsImNvbnRyb2xsZXJzL2FjY2VwdExvZGdlbWVudC9hY2NlcHRMb2RnZW1lbnQuY29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL2FwcGxpY2FudEZvcm0vYXBwbGljYW50Rm9ybS5jb250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvYmVuZWZpY2lhcnkvYmVuZWZpY2lhcnkuY29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL2Jsb2NrY2hhaW5EYXNoYm9hcmQvYWRkcmVzc0luZm9zQ3RybC5qcyIsImNvbnRyb2xsZXJzL2Jsb2NrY2hhaW5EYXNoYm9hcmQvYmxvY2tJbmZvc0N0cmwuanMiLCJjb250cm9sbGVycy9ibG9ja2NoYWluRGFzaGJvYXJkL2NoYWluSW5mb3NDb250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvYmxvY2tjaGFpbkRhc2hib2FyZC9tYWluRGFzaEN0cmwuanMiLCJjb250cm9sbGVycy9ibG9ja2NoYWluRGFzaGJvYXJkL3RyYW5zYWN0aW9uSW5mb3NDdHJsLmpzIiwiY29udHJvbGxlcnMvZGFzaGJvYXJkL2Rhc2hib2FyZC5jb250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvZm9vdGVyL2Zvb3Rlci5jb250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvaG9tZS9ob21lLmNvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9pc3N1ZUJhbmsvaXNzdWVCYW5rLmNvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9sb2dpbi9sb2dpbi5jb250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvbmF2aWdhdGlvbi9uYXZpZ2F0aW9uLmNvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9pc3N1aW5nRm9ybS9pc3N1aW5nRm9ybS5jb250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvbm90aWZpY2F0aW9uL25vdGlmaWNhdGlvbi5jb250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvcHJlc2VudGVyL3ByZXNlbnRpbmdCYW5rLmNvbnRyb2xsZXIuanMiLCJkaXJlY3RpdmVzL2Zvb3Rlci9mb290ZXIuZGlyZWN0aXZlLmpzIiwiY29udHJvbGxlcnMvc2lnbnVwL3NpZ251cC5jb250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvYWR2aXNpbmdCYW5rL2FkdmlzaW5nQmFuay5jb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUFHQSxDQUFBLFdBQUE7O0lBRUEsUUFBQSxPQUFBLFNBQUEsQ0FBQSxhQUFBLGdCQUFBLG9CQUFBLGlCQUFBOztJQUVBO1NBQ0EsT0FBQTtTQUNBLE9BQUEsQ0FBQSxrQkFBQSxzQkFBQTtTQUNBLElBQUEsQ0FBQSxjQUFBLGFBQUEsa0JBQUE7O0lBRUEsSUFBQSxnQkFBQTs7O0lBR0EsSUFBQSxlQUFBOzs7O0lBSUEsU0FBQSxPQUFBLGdCQUFBLG9CQUFBOztRQUVBLElBQUEsY0FBQTtZQUNBLE1BQUE7WUFDQSxLQUFBO1lBQ0EsYUFBQTtZQUNBLFlBQUE7WUFDQSxjQUFBOzs7UUFHQSxJQUFBLGFBQUE7WUFDQSxNQUFBO1lBQ0EsS0FBQTtZQUNBLGFBQUE7WUFDQSxZQUFBO1lBQ0EsY0FBQTs7O1FBR0EsSUFBQSxjQUFBO1lBQ0EsTUFBQTtZQUNBLEtBQUE7WUFDQSxhQUFBOzs7OztRQUtBLElBQUEsT0FBQTtZQUNBLE1BQUE7WUFDQSxLQUFBO1lBQ0EsYUFBQTtZQUNBLFlBQUE7WUFDQSxjQUFBOzs7UUFHQSxJQUFBLFlBQUE7WUFDQSxNQUFBO1lBQ0EsS0FBQTtZQUNBLGFBQUE7WUFDQSxZQUFBO1lBQ0EsY0FBQTs7UUFFQSxJQUFBLGVBQUE7WUFDQSxNQUFBO1lBQ0EsS0FBQTtZQUNBLGFBQUE7WUFDQSxZQUFBO1lBQ0EsY0FBQTs7O1FBR0EsSUFBQSxPQUFBO1lBQ0EsTUFBQTtZQUNBLEtBQUE7WUFDQSxhQUFBO1lBQ0EsWUFBQTtZQUNBLGNBQUE7Ozs7UUFJQSxJQUFBLGFBQUE7WUFDQSxNQUFBO1lBQ0EsS0FBQTtZQUNBLGFBQUE7WUFDQSxZQUFBO1lBQ0EsY0FBQTs7O1FBR0EsSUFBQSxzQkFBQTtZQUNBLE1BQUE7WUFDQSxLQUFBO1lBQ0EsUUFBQTtnQkFDQSxjQUFBOztZQUVBLGFBQUE7WUFDQSxZQUFBO1lBQ0EsY0FBQTs7O1FBR0EsSUFBQSx5QkFBQTtZQUNBLE1BQUE7WUFDQSxLQUFBO1lBQ0EsUUFBQTtnQkFDQSxjQUFBOztZQUVBLGFBQUE7WUFDQSxZQUFBO1lBQ0EsY0FBQTs7O1FBR0EsSUFBQSxzQkFBQTtZQUNBLE1BQUE7WUFDQSxLQUFBO1lBQ0EsUUFBQTtnQkFDQSxjQUFBOztZQUVBLGFBQUE7WUFDQSxZQUFBO1lBQ0EsY0FBQTs7O1FBR0EsSUFBQSx3QkFBQTtZQUNBLE1BQUE7WUFDQSxLQUFBO1lBQ0EsUUFBQTtnQkFDQSxjQUFBOztZQUVBLGFBQUE7WUFDQSxZQUFBO1lBQ0EsY0FBQTs7O1FBR0EsSUFBQSx3QkFBQTtZQUNBLE1BQUE7WUFDQSxLQUFBO1lBQ0EsUUFBQTtnQkFDQSxjQUFBOztZQUVBLGFBQUE7WUFDQSxZQUFBO1lBQ0EsY0FBQTs7Ozs7O1FBTUEsSUFBQSxjQUFBO1lBQ0EsTUFBQTtZQUNBLEtBQUE7WUFDQSxhQUFBO1lBQ0EsWUFBQTtZQUNBLGNBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O1FBMEJBLElBQUEsZ0JBQUE7WUFDQSxNQUFBO1lBQ0EsS0FBQTtZQUNBLGFBQUE7WUFDQSxZQUFBO1lBQ0EsY0FBQTs7O1FBR0EsSUFBQSxVQUFBO1lBQ0EsTUFBQTtZQUNBLEtBQUE7WUFDQSxhQUFBO1lBQ0EsWUFBQTtZQUNBLGNBQUE7OztRQUdBLElBQUEsZ0JBQUE7WUFDQSxNQUFBO1lBQ0EsS0FBQTtZQUNBLGFBQUE7WUFDQSxZQUFBO1lBQ0EsY0FBQTs7O1FBR0EsSUFBQSxVQUFBO1lBQ0EsTUFBQTtZQUNBLEtBQUE7WUFDQSxhQUFBO1lBQ0EsWUFBQTtZQUNBLGNBQUE7O1FBRUEsSUFBQSxXQUFBO1lBQ0EsTUFBQTtZQUNBLEtBQUE7WUFDQSxhQUFBO1lBQ0EsWUFBQTtZQUNBLGNBQUE7O1FBRUEsSUFBQSxRQUFBO1lBQ0EsTUFBQTtZQUNBLEtBQUE7WUFDQSxhQUFBO1lBQ0EsWUFBQTtZQUNBLGNBQUE7Ozs7Ozs7Ozs7Ozs7OztRQWVBO2FBQ0EsTUFBQTthQUNBLE1BQUE7YUFDQSxNQUFBO2FBQ0EsTUFBQTthQUNBLE1BQUE7YUFDQSxNQUFBO2FBQ0EsTUFBQTthQUNBLE1BQUE7YUFDQSxNQUFBO2FBQ0EsTUFBQTs7YUFFQSxNQUFBO2FBQ0EsTUFBQTthQUNBLE1BQUE7YUFDQSxNQUFBOzthQUVBLE1BQUE7YUFDQSxNQUFBO2FBQ0EsTUFBQTthQUNBLE1BQUE7YUFDQSxNQUFBO2FBQ0EsTUFBQTs7O1FBR0EsbUJBQUEsVUFBQTs7Ozs7SUFLQSxTQUFBLElBQUEsWUFBQSxXQUFBLGdCQUFBOztRQUVBLElBQUEsT0FBQSxRQUFBO1FBQ0EsSUFBQSxNQUFBLFVBQUEsU0FBQSxNQUFBLE1BQUE7UUFDQSxJQUFBLFdBQUEsSUFBQSxNQUFBLEtBQUE7UUFDQSxJQUFBLFlBQUEsSUFBQSxNQUFBLEtBQUE7UUFDQSxJQUFBLFVBQUE7UUFDQSxRQUFBLElBQUEsV0FBQSxNQUFBLFlBQUEsTUFBQTtRQUNBLElBQUEsYUFBQSxnQkFBQTs7WUFFQSxZQUFBOztRQUVBLElBQUEsT0FBQSxJQUFBLEtBQUEsSUFBQSxLQUFBLFVBQUEsYUFBQSxXQUFBLE1BQUEsWUFBQSxNQUFBO1FBQ0EsV0FBQSxPQUFBO1FBQ0EsV0FBQSxJQUFBLHdCQUFBLFNBQUEsT0FBQSxXQUFBLGNBQUE7WUFDQSxJQUFBLGNBQUEsQ0FBQSxVQUFBLFdBQUE7WUFDQSxJQUFBLGlCQUFBLFlBQUEsUUFBQSxVQUFBLFlBQUEsQ0FBQTtZQUNBLElBQUEsa0JBQUEsQ0FBQSxlQUFBLGNBQUE7Z0JBQ0EsVUFBQSxLQUFBOzs7Ozs7O0FDeFJBLENBQUEsV0FBQTtJQUNBO0lBQ0E7U0FDQSxPQUFBO1NBQ0EsUUFBQSxXQUFBOztJQUVBLFFBQUEsVUFBQSxDQUFBLFNBQUEsa0JBQUE7O0lBRUEsU0FBQSxRQUFBLE9BQUEsZ0JBQUEsUUFBQTtRQUNBLElBQUEsV0FBQSxTQUFBLEtBQUEsWUFBQSxLQUFBO1VBQ0EsUUFBQSxJQUFBO1VBQ0EsSUFBQSxTQUFBO1lBQ0EsT0FBQTtZQUNBLEtBQUE7O1VBRUEsSUFBQSxlQUFBLFFBQUE7WUFDQSxRQUFBLElBQUEsV0FBQTtZQUNBLE9BQUEsTUFBQSxLQUFBLElBQUEsS0FBQTtjQUNBLFNBQUE7a0JBQ0EsZUFBQSxZQUFBLGVBQUE7O2VBRUE7Y0FDQSxTQUFBLFFBQUEsU0FBQTs7Z0JBRUEsT0FBQSxTQUFBO2dCQUNBLE9BQUEsT0FBQSxTQUFBLEtBQUE7Z0JBQ0EsT0FBQTs7Y0FFQSxTQUFBLE1BQUEsU0FBQTtnQkFDQSxJQUFBLE9BQUEsZUFBQTtnQkFDQSxHQUFBLEtBQUEsTUFBQSxLQUFBO2tCQUNBLE9BQUEsU0FBQTtrQkFDQSxRQUFBLElBQUE7a0JBQ0EsT0FBQSxHQUFBOzs7Z0JBR0EsT0FBQSxTQUFBO2dCQUNBLE9BQUEsT0FBQSxTQUFBLEtBQUE7Z0JBQ0EsT0FBQTs7OztlQUlBLElBQUEsZUFBQSxNQUFBO1lBQ0EsUUFBQSxJQUFBLFVBQUE7WUFDQSxPQUFBLE1BQUEsSUFBQSxJQUFBO2NBQ0EsU0FBQTtrQkFDQSxlQUFBLFlBQUEsZUFBQTs7ZUFFQTtjQUNBLFNBQUEsUUFBQSxTQUFBOztnQkFFQSxPQUFBLFNBQUE7Z0JBQ0EsT0FBQSxPQUFBLFNBQUEsS0FBQTs7Z0JBRUEsT0FBQTs7Y0FFQSxTQUFBLE1BQUEsU0FBQTtnQkFDQSxJQUFBLE9BQUEsZUFBQTtnQkFDQSxHQUFBLEtBQUEsTUFBQSxLQUFBO2tCQUNBLE9BQUEsU0FBQTtrQkFDQSxRQUFBLElBQUE7a0JBQ0EsT0FBQSxHQUFBOzs7Z0JBR0EsT0FBQSxTQUFBO2dCQUNBLE9BQUEsT0FBQSxTQUFBLEtBQUE7Z0JBQ0EsT0FBQTs7OztjQUlBO1lBQ0EsUUFBQSxJQUFBOzs7UUFHQSxJQUFBLFVBQUE7VUFDQSxVQUFBOzs7UUFHQSxPQUFBOzs7Ozs7QUM5RUEsQ0FBQSxXQUFBO0lBQ0E7SUFDQTtTQUNBLE9BQUE7U0FDQSxRQUFBLGtCQUFBOztJQUVBLGVBQUEsVUFBQSxDQUFBLFNBQUE7O0lBRUEsU0FBQSxlQUFBLE9BQUEsU0FBQTs7O1FBR0EsSUFBQSxZQUFBLFNBQUEsT0FBQTtZQUNBLFFBQUEsZUFBQSxnQkFBQTs7O1FBR0EsSUFBQSxXQUFBLFdBQUE7WUFDQSxPQUFBLFFBQUEsZUFBQTs7O1FBR0EsSUFBQSxhQUFBLFdBQUE7WUFDQSxJQUFBLFFBQUE7WUFDQSxJQUFBOztZQUVBLElBQUEsT0FBQTtnQkFDQSxVQUFBLE1BQUEsTUFBQSxLQUFBO2dCQUNBLFVBQUEsUUFBQSxLQUFBO2dCQUNBLFVBQUEsS0FBQSxNQUFBO2dCQUNBLE9BQUEsUUFBQSxNQUFBLEtBQUEsUUFBQTttQkFDQTtnQkFDQSxPQUFBOzs7O1FBSUEsSUFBQSxrQkFBQSxXQUFBO1lBQ0EsSUFBQSxPQUFBLEtBQUE7WUFDQSxJQUFBO1lBQ0EsSUFBQSxRQUFBLFNBQUEsSUFBQTtnQkFDQSxPQUFBLEtBQUE7O1lBRUEsT0FBQTs7O1FBR0EsSUFBQSxjQUFBLFdBQUE7WUFDQSxJQUFBLGNBQUE7Z0JBQ0EsSUFBQSxRQUFBO2dCQUNBLElBQUEsVUFBQSxNQUFBLE1BQUEsS0FBQTtnQkFDQSxVQUFBLFFBQUEsS0FBQTtnQkFDQSxVQUFBLEtBQUEsTUFBQTtnQkFDQSxPQUFBO29CQUNBLE9BQUEsUUFBQTtvQkFDQSxNQUFBLFFBQUE7b0JBQ0EsTUFBQSxRQUFBO29CQUNBLFFBQUEsUUFBQTs7Ozs7UUFLQSxJQUFBLFdBQUEsU0FBQSxNQUFBO1lBQ0EsUUFBQSxJQUFBO1lBQ0EsT0FBQSxNQUFBLEtBQUEsa0JBQUEsTUFBQTtnQkFDQSxTQUFBLFVBQUE7b0JBQ0EsUUFBQSxJQUFBLFNBQUE7b0JBQ0EsVUFBQSxTQUFBLEtBQUE7b0JBQ0EsT0FBQTs7Z0JBRUEsU0FBQSxVQUFBOztvQkFFQSxPQUFBOzs7O1FBSUEsSUFBQSxRQUFBLFNBQUEsTUFBQTtZQUNBLE9BQUEsTUFBQSxLQUFBLGVBQUEsTUFBQTtnQkFDQSxTQUFBLFVBQUE7O29CQUVBLFVBQUEsU0FBQSxLQUFBO29CQUNBLE9BQUE7O2dCQUVBLFNBQUEsVUFBQTs7b0JBRUEsT0FBQTs7Ozs7OztRQU9BLElBQUEsU0FBQSxXQUFBO1lBQ0EsUUFBQSxlQUFBLFdBQUE7O1FBRUEsSUFBQSxVQUFBO1lBQ0EsYUFBQTtZQUNBLFdBQUE7WUFDQSxVQUFBO1lBQ0EsWUFBQTtZQUNBLFVBQUE7WUFDQSxPQUFBO1lBQ0EsTUFBQTtZQUNBLFFBQUE7OztRQUdBLE9BQUE7Ozs7Ozs7OztBQ3JHQSxDQUFBLFdBQUE7SUFDQSxRQUFBLE9BQUEsV0FBQTtTQUNBLE9BQUEsWUFBQSxXQUFBO1lBQ0EsT0FBQSxTQUFBLE1BQUEsUUFBQSxLQUFBO2dCQUNBLElBQUEsTUFBQTtvQkFDQSxTQUFBOztnQkFFQSxJQUFBLFFBQUE7b0JBQ0EsTUFBQTs7Z0JBRUEsSUFBQSxLQUFBLFVBQUEsVUFBQSxLQUFBLFNBQUEsSUFBQSxVQUFBLFFBQUE7b0JBQ0EsT0FBQTt1QkFDQTtvQkFDQSxPQUFBLE9BQUEsTUFBQSxVQUFBLEdBQUEsU0FBQSxJQUFBLFVBQUE7Ozs7SUFJQSxPQUFBLGNBQUEsV0FBQTtRQUNBLE9BQUEsU0FBQSxPQUFBO1lBQ0EsSUFBQSxNQUFBLFFBQUEsT0FBQTtZQUNBLElBQUEsSUFBQSxRQUFBO1lBQ0EsT0FBQSxFQUFBLFFBQUEsS0FBQTs7O0lBR0EsT0FBQSxXQUFBLFdBQUE7UUFDQSxPQUFBLFNBQUEsT0FBQTtZQUNBLElBQUEsTUFBQSxRQUFBLE9BQUE7WUFDQSxJQUFBLEtBQUEsbUNBQUEsUUFBQTtZQUNBLE9BQUE7OztJQUdBLE9BQUEsWUFBQSxXQUFBO1FBQ0EsT0FBQSxTQUFBLE1BQUE7WUFDQSxJQUFBLE1BQUEsT0FBQSxPQUFBO1lBQ0EsSUFBQSxLQUFBLG9DQUFBO1lBQ0EsT0FBQTs7O0lBR0EsT0FBQSxjQUFBLFdBQUE7UUFDQSxPQUFBLFNBQUEsT0FBQTtZQUNBLElBQUEsTUFBQSxRQUFBLE9BQUE7WUFDQSxJQUFBLElBQUEsUUFBQTtZQUNBLE9BQUEsRUFBQSxRQUFBLEtBQUE7OztJQUdBLE9BQUEsYUFBQSxXQUFBO1FBQ0EsT0FBQSxTQUFBLEtBQUE7WUFDQSxJQUFBLE1BQUEsTUFBQSxPQUFBO1lBQ0EsSUFBQSxJQUFBLElBQUEsVUFBQTtZQUNBLE9BQUEsRUFBQSxTQUFBLEtBQUE7OztJQUdBLE9BQUEsVUFBQSxXQUFBO1FBQ0EsT0FBQSxTQUFBLEtBQUE7WUFDQSxJQUFBLE1BQUEsTUFBQSxPQUFBO1lBQ0EsSUFBQSxJQUFBLElBQUEsVUFBQTtZQUNBLElBQUEsSUFBQSxLQUFBLFFBQUEsR0FBQTtZQUNBLE9BQUEsRUFBQSxRQUFBLEtBQUE7OztJQUdBLE9BQUEsY0FBQSxXQUFBO1FBQ0EsT0FBQSxTQUFBLE1BQUE7WUFDQSxJQUFBLE1BQUEsT0FBQSxPQUFBO1lBQ0EsSUFBQSxJQUFBLE9BQUE7WUFDQSxPQUFBLEVBQUEsUUFBQSxLQUFBOzs7OztBQ2hFQSxDQUFBLFdBQUE7OztFQUVBO09BQ0EsT0FBQTtPQUNBLFVBQUEsVUFBQTs7RUFFQSxTQUFBLFFBQUEsVUFBQTtJQUNBLE9BQUEsU0FBQSxRQUFBLFNBQUE7TUFDQSxTQUFBLEdBQUEsU0FBQSxVQUFBO1FBQ0EsUUFBQSxRQUFBOzs7Ozs7O0FDVEEsQ0FBQSxXQUFBOztJQUVBO1NBQ0EsT0FBQTtTQUNBLFVBQUEsaUJBQUE7O0lBRUEsU0FBQSxnQkFBQTtRQUNBLE9BQUE7WUFDQSxVQUFBO1lBQ0EsU0FBQTtZQUNBLE1BQUE7Y0FDQSxTQUFBOztZQUVBLE1BQUEsU0FBQSxPQUFBLFNBQUEs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QUFBO29CQUNBLE9BQUEsS0FBQSxTQUFBLEtBQUEsR0FBQTtvQkFDQSxPQUFBLFVBQUEsU0FBQSxLQUFBLEdBQUE7b0JBQ0EsT0FBQSxnQkFBQSxTQUFBLEtBQUEsR0FBQTtvQkFDQSxRQUFBLEtBQUE7dUJBQ0EsSUFBQSxTQUFBLEtBQUEsR0FBQSxRQUFBLEtBQUE7b0JBQ0EsSUFBQSxZQUFBLFNBQUEsS0FBQTtvQkFDQSxPQUFBLFFBQUEsU0FBQSxVQUFBO29CQUNBLE9BQUEsUUFBQSxnQkFBQSxVQUFBO29CQUNBLE9BQUEsUUFBQSxtQkFBQSxVQUFBO29CQUNBLE9BQUEsUUFBQSxrQkFBQSxVQUFBO29CQUNBLE9BQUEsUUFBQSxtQkFBQSxVQUFBO3VCQUNBLElBQUEsU0FBQSxLQUFBLEdBQUEsUUFBQSxLQUFBO29CQUNBLElBQUEsVUFBQSxTQUFBLEtBQUE7b0JBQ0EsT0FBQSxRQUFBLFlBQUEsUUFBQTtvQkFDQSxPQUFBLFFBQUEsY0FBQSxRQUFBO29CQUNBLE9BQUEsUUFBQSxnQkFBQSxRQUFBOzs7O1lBSUEsT0FBQSxRQUFBLFVBQUE7WUFDQSxRQUFBLElBQUEsT0FBQSxRQUFBO1dBQ0EsU0FBQSxVQUFBO1lBQ0EsSUFBQSxLQUFBLFFBQUEsS0FBQTtnQkFDQSxPQUFBLFdBQUE7Z0JBQ0EsUUFBQSxJQUFBO2dCQUNBLE9BQUEsR0FBQTs7WUFFQSxRQUFBLElBQUEsU0FBQTs7O1FBR0EsR0FBQSxRQUFBLFNBQUEsU0FBQTtZQUNBLFFBQUEsSUFBQTtZQUNBLFFBQUEsV0FBQTtZQUNBLFFBQUEsU0FBQTtZQUNBLFFBQUEsVUFBQTtZQUNBLFFBQUEsYUFBQTtZQUNBLFFBQUEsbUJBQUE7WUFDQSxRQUFBLGVBQUE7WUFDQSxRQUFBLHVCQUFBO1lBQ0EsUUFBQSxhQUFBO1lBQ0EsUUFBQSxVQUFBO1lBQ0EsUUFBQSxhQUFBO1lBQ0EsT0FBQSxhQUFBO1lBQ0EsT0FBQSxvQkFBQSxTQUFBLGFBQUEsWUFBQTtZQUNBLE9BQUEsb0JBQUE7OztRQUdBLE9BQUEsY0FBQSxTQUFBLE9BQUE7WUFDQSxRQUFB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QUEsbUNBQUEsU0FBQTs7NEJBRUEsT0FBQSx1QkFBQSxPQUFBLG1DQUFBLFVBQUEsT0FBQTs0QkFDQSxPQUFBLGlDQUFBLE9BQUEscUJBQUEsU0FBQTs7OzRCQUdBLE9BQUEsdUJBQUEsT0FBQSxXQUFBLFNBQUE7NEJBQ0EsT0FBQSw0QkFBQSxPQUFBLGdCQUFBLFNBQUE7Ozs0QkFHQSxPQUFBLFdBQUEsSUFBQSxVQUFBLFlBQUEsVUFBQSxTQUFBLEtBQUE7Ozs0QkFHQSxJQUFBLFVBQUEsSUFBQTs0QkFDQSxRQUFBLFFBQUEsWUFBQSxZQUFBOzRCQUNBLE9BQUEsT0FBQSxRQUFBOzs0QkFFQSxPQUFBLHFCQUFBLFlBQUEsWUFBQTs0QkFDQSxPQUFBLGtCQUFBLENBQUEsT0FBQSxxQkFBQSxPQUFBLFFBQUE7Ozs7OzRCQUtBLElBQUEsY0FBQSxLQUFBLElBQUEsU0FBQSxPQUFBLFdBQUE7NEJBQ0EsSUFBQSxnQkFBQSxXQUFBO2dDQUNBLE9BQUEsWUFBQSxZQUFBLFlBQUEsWUFBQTs7NEJBRUEsT0FBQSxTQUFBOzRCQUNBLFFBQUEsT0FBQTs0QkFDQSxJQUFBLFlBQUEsS0FBQSxJQUFBLFNBQUEsS0FBQSxJQUFBLE9BQUEsV0FBQSxPQUFBOzRCQUNBLElBQUEsZ0JBQUEsV0FBQTtnQ0FDQSxPQUFBLG9CQUFBLENBQUEsQ0FBQSxZQUFBLFlBQUEsVUFBQSxhQUFBLE9BQUEsUUFBQTs7NEJBRUEsT0FBQSxTQUFBOzRCQUNBLFFBQUEsT0FBQTs0QkFDQSxJQUFBLFlBQUEsS0FBQSxJQUFBLFNBQUEsS0FBQSxJQUFBLE9BQUEsV0FBQSxPQUFBOzRCQUNBLElBQUEsZ0JBQUEsV0FBQTtnQ0FDQSxPQUFBLG9CQUFBLENBQUEsQ0FBQSxZQUFBLFlBQUEsVUFBQSxhQUFBLE9BQUEsUUFBQTs7NEJBRUEsT0FBQSxTQUFBOzRCQUNBLFFBQUEsT0FBQTs0QkFDQSxJQUFBLFlBQUEsS0FBQSxJQUFBLFNBQUEsS0FBQSxJQUFBLE9BQUEsV0FBQSxPQUFBOzRCQUNBLElBQUEsZ0JBQUEsV0FBQTtnQ0FDQSxPQUFBLG9C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QSxjQUFBLGlCQUFBLFlBQUE7Z0JBQ0EsUUFBQSxZQUFBO2dCQUNBLFFBQUEsVUFBQTs7Z0JBRUEsTUFBQSxJQUFBLHdCQUFBO29CQUNBLFNBQUE7d0JBQ0EsZUFBQSxZQUFBLGVBQUE7O21CQUVBLEtBQUEsU0FBQSxVQUFBO29CQUNBLFFBQUEsSUFBQTtvQkFDQSxPQUFBLGFBQUEsU0FBQTtvQkFDQSxRQUFBLElBQUEsU0FBQTttQkFDQSxTQUFBLFVBQUE7b0JBQ0EsUUFBQSxJQUFBLFNBQUE7Ozs7Ozs7UUFPQSxHQUFBLGNBQUEsU0FBQSxTQUFBO1lBQ0EsT0FBQSxJQUFBLEtBQUEsU0FBQTs7O1FBR0EsR0FBQSxlQUFBLFNBQUEsV0FBQTtZQUNBLFFBQUEsSUFBQSxnQkFBQSxVQUFBO1lBQ0EsR0FBQSxnQkFBQTtZQUNBLEdBQUEsbUJBQUE7OztRQUdBLE9BQUEsUUFBQSxTQUFBLEtBQUEsS0FBQSxNQUFBO1lBQ0EsUUFBQSxJQUFBLFNBQUE7WUFDQSxPQUFBLFFBQUE7WUFDQSxJQUFBLFFBQUE7WUFDQSxLQUFBLElBQUEsSUFBQSxLQUFBLEtBQUEsS0FBQSxLQUFBLE1BQUE7Z0JBQ0EsTUFBQSxLQUFBOztZQUVBLE9BQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQzFFQSxRQUFBLE9BQUEsU0FBQSxXQUFBLCtCQUFBLFVBQUEsUUFBQTs7SUFFQSxPQUFBLGlCQUFBLFNBQUEsUUFBQTtPQUNBOzs7O0FDSkEsQ0FBQSxXQUFBO0lBQ0E7U0FDQSxPQUFBO1NBQ0EsV0FBQSxZQUFBOztJQUVBLFNBQUEsVUFBQSxDQUFBLFVBQUEsU0FBQSxVQUFBOztJQUVBLFNBQUEsU0FBQSxRQUFBLE9BQUEsUUFBQSxnQkFBQTtRQUNBLElBQUEsS0FBQTs7UUFFQSxHQUFBLE9BQUEsV0FBQTtZQUNBLE1BQUEsSUFBQSxrQkFBQTtnQkFDQSxTQUFBO29CQUNBLGVBQUEsWUFBQSxlQUFBOztlQUVBLEtBQUEs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QUE7NEJBQ0EsaUJBQUEsWUFBQSxTQUFBOzRCQUNBLGlCQUFBLFNBQUE7NEJBQ0EsaUJBQUEsa0JBQUEsU0FBQTs0QkFDQSxnQkFBQSxLQUFBOzRCQUNBLE1BQUEsSUFBQSxXQUFBOytCQUNBOzRCQUNBLElBQUEsa0JBQUE7NEJBQ0EsZ0JBQUEsZ0JBQUEsU0FBQTs0QkFDQSxnQkFBQSxXQUFBLEtBQUE7NEJBQ0EsZ0JBQUEsUUFBQSxTQUFBOzRCQUNBLGdCQUFBLFlBQUEsS0FBQTs0QkFDQSxnQkFBQSxXQUFBLEtBQUE7NEJBQ0EsZ0JBQUEsWUFBQSxLQUFBLFFBQUE7NEJBQ0EsZ0JBQUEsWUFBQSxTQUFBOzRCQUNBLGdCQUFBLFNBQUE7NEJBQ0EsZ0JBQUEsa0JBQUEsU0FBQTs0QkFDQSxNQUFBLElBQUEsV0FBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O2dCQTJFQSxJQUFBLFVBQUEsSUFBQSxJQUFBLENBQUEsb0JBQUEsT0FBQTs7Z0JBRUEsT0FBQSxzQkFBQSxNQUFBLEtBQUE7Z0JBQ0EsUUFBQSxJQUFBLE9BQUE7ZUFDQSxTQUFBLFVBQUE7Ozs7WUFJQSxZQUFBLFNBQUEsV0FBQTtnQkFDQSxPQUFBO2VBQ0E7O1FBRUEsT0FBQTs7UUFFQSxPQUFBLElBQUEsWUFBQSxTQUFBLE9BQUE7WUFDQSxTQUFBLE9BQUE7OztRQUdBLEdBQUEsY0FBQSxTQUFBLFNBQUE7WUFDQSxPQUFBLElBQUEsS0FBQSxTQUFBOzs7UUFHQSxHQUFBLGVBQUEsU0FBQSxXQUFBOztZQUVBLEdBQUEsZ0JBQUE7WUFDQSxHQUFBLG1CQUFBOzs7UUFHQSxPQUFBLFFBQUEsU0FBQSxLQUFBLEtBQUEsTUFBQTs7WUFFQSxPQUFBLFFBQUE7WUFDQSxJQUFBLFFBQUE7WUFDQSxLQUFBLElBQUEsSUFBQSxLQUFBLEtBQUEsS0FBQSxLQUFBLE1BQUE7Z0JBQ0EsTUFBQSxLQUFBOztZQUVBLE9BQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FD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QSxhQUFBLENBQUEsY0FBQSxVQUFBO0tBQ0EsTUFBQSxLQUFBLG9CQUFBLFlBQUE7Z0JBQ0EsU0FBQTtvQkFDQSxlQUFBLFlBQUEsZUFBQTs7ZUFFQTtnQkFDQSxTQUFBLFVBQUE7Z0JBQ0EsR0FBQTttQkFDQSxHQUFBLGdCQUFBO21CQUNBLE9BQUEsZUFBQTs7Z0JBRUEsU0FBQSxVQUFBO29CQUNBLFFBQUEsSUFBQSxTQUFBLEtBQUE7OztNQUdBLEdBQUEsU0FBQSxTQUFBLE1BQUE7UUFDQSxJQUFBLFNBQUEsV0FBQSxlQUFBO1VBQ0EsT0FBQTs7WUFFQTtVQUNBLE9BQUE7OztHQUdBLEdBQUE7OztBQUdBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQEF1dGhvciBoaXRqb3NoaUBkZWxvaXR0ZS5jb21cclxuICovXHJcbihmdW5jdGlvbigpIHtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnbXlBcHAnLCBbJ3VpLnJvdXRlcicsICduZ0ZpbGVVcGxvYWQnLCAnNzIwa2IuZGF0ZXBpY2tlcicsICdhbmd1bGFyTW9tZW50JywgJ2ZpbHRlcnMnXSk7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ215QXBwJylcclxuICAgICAgICAuY29uZmlnKFsnJHN0YXRlUHJvdmlkZXInLCAnJHVybFJvdXRlclByb3ZpZGVyJywgY29uZmlnXSlcclxuICAgICAgICAucnVuKFsnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnYXV0aGVudGljYXRpb24nLCBydW5dKTtcclxuXHJcbiAgICB2YXIgR0VUSF9IT1NUTkFNRSA9IFwiMTI3LjAuMC4xXCI7IC8vIHB1dCB5b3VyIElQIGFkZHJlc3MhXHJcbiAgICAvLyB2YXIgQVBQX0hPU1ROQU1FID0gXCIxMjcuMC4wLjFcIjtcclxuXHJcbiAgICB2YXIgR0VUSF9SUENQT1JUID0gODU0NTtcclxuXHJcbiAgICAvLyBpZiB3ZSB1c2UgdWkucm91dGVyIHdlIGhhdmUgdG8gY2hhbmdlICRyb3V0ZVByb3ZpZGVyIHRvICRzdGF0ZVByb3ZpZGVyXHJcbiAgICAvLyAkbG9jYXRpb25Qcm92aWRlciBpcyB1c2VkIHRvIHJlbW92ZSAjLyB0aGF0IEFuZ3VsYXIgYWRkcyB0byByb3V0ZVxyXG4gICAgZnVuY3Rpb24gY29uZmlnKCRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpIHtcclxuXHJcbiAgICAgICAgdmFyIHNpZ25VcFN0YXRlID0ge1xyXG4gICAgICAgICAgICBuYW1lOiAnc2lnbnVwJyxcclxuICAgICAgICAgICAgdXJsOiAnL3NpZ251cCcsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAncGFydGlhbHMvc2lnbnVwLmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnc2lnblVwQ3RybCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJ1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGxvZ2luU3RhdGUgPSB7XHJcbiAgICAgICAgICAgIG5hbWU6ICdsb2dpbicsXHJcbiAgICAgICAgICAgIHVybDogJy9sb2dpbicsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAncGFydGlhbHMvbG9naW4uaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdsb2dpbkN0cmwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bSdcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBsb2dvdXRTdGF0ZSA9IHtcclxuICAgICAgICAgICAgbmFtZTogJ2xvZ291dCcsXHJcbiAgICAgICAgICAgIHVybDogJy9sb2dvdXQnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3BhcnRpYWxzL2xvZ291dC5odG1sJ1xyXG4gICAgICAgICAgICAvLyBjb250cm9sbGVyOiAnbG9nb3V0Q3RybCcsXHJcbiAgICAgICAgICAgIC8vIGNvbnRyb2xsZXJBczogJ3ZtJ1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGlwZnMgPSB7XHJcbiAgICAgICAgICAgIG5hbWU6ICdpcGZzJyxcclxuICAgICAgICAgICAgdXJsOiAnL2lwZnMnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3BhcnRpYWxzL2lwZnMuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdpcGZzQ3RybCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJ1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGRhc2hib2FyZCA9IHtcclxuICAgICAgICAgICAgbmFtZTogJ2Rhc2hib2FyZCcsXHJcbiAgICAgICAgICAgIHVybDogJy9kYXNoYm9hcmQnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3BhcnRpYWxzL2Rhc2hib2FyZC5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2Rhc2hib2FyZEN0cmwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bSdcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIG5vdGlmaWNhdGlvbiA9IHtcclxuICAgICAgICAgICAgbmFtZTogJ25vdGlmaWNhdGlvbicsXHJcbiAgICAgICAgICAgIHVybDogJy9ub3RpZmljYXRpb24nLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3BhcnRpYWxzL25vdGlmaWNhdGlvbi5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ25vdGlmaWNhdGlvbkN0cmwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bSdcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBob21lID0ge1xyXG4gICAgICAgICAgICBuYW1lOiAnaG9tZScsXHJcbiAgICAgICAgICAgIHVybDogJy9ob21lJyxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdwYXJ0aWFscy9ob21lLmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnaG9tZUN0cmwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bSdcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICB2YXIgaW5pdGlhdGVMYyA9IHtcclxuICAgICAgICAgICAgbmFtZTogJ2luaXRpYXRlTGMnLFxyXG4gICAgICAgICAgICB1cmw6ICcvY3JlYXRlbGMnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3BhcnRpYWxzL2FwcGxpY2FudEZvcm0uaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdhcHBsaWNhbnRDdHJsJyxcclxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nXHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIFRoZSBjaGFuZ2VzIGZvciB3aXJlIGZyYW1lcyBzdGFydHMgaGVyZVxyXG4gICAgICAgIHZhciBpc3N1ZUJhbmtMbmRpbmdQYWdlID0ge1xyXG4gICAgICAgICAgICBuYW1lOiAnaXNzdWVCYW5rTG5kaW5nUGFnZScsXHJcbiAgICAgICAgICAgIHVybDogJy9pc3N1ZWJhbmsvaG9tZS8nLFxyXG4gICAgICAgICAgICBwYXJhbXM6IHtcclxuICAgICAgICAgICAgICAgICdhY3Rpb25JdGVtJzogbnVsbCxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdwYXJ0aWFscy9pc3N1ZUJhbmtMbmRpbmdQYWdlLmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnaXNzdWVCYW5rQ3RybCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJ1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGFkdmlzaW5nQmFua0xuZGluZ1BhZ2UgPSB7XHJcbiAgICAgICAgICAgIG5hbWU6ICdhZHZpc2luZ0JhbmtMbmRpbmdQYWdlJyxcclxuICAgICAgICAgICAgdXJsOiAnL2FkdkJhbmsnLFxyXG4gICAgICAgICAgICBwYXJhbXM6IHtcclxuICAgICAgICAgICAgICAgICdhY3Rpb25JdGVtJzogbnVsbCxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdwYXJ0aWFscy9hZHZpc2luZ0JhbmtMbmRpbmdQYWdlLmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnYWR2aXNpbmdCYW5rQ3RybCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJ1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGFjY2VwdExvZGdlbWVudFBhZ2UgPSB7XHJcbiAgICAgICAgICAgIG5hbWU6ICdhY2NlcHRMb2RnZW1lbnRQYWdlJyxcclxuICAgICAgICAgICAgdXJsOiAnL2FjY2VwdExvZGdlbWVudCcsXHJcbiAgICAgICAgICAgIHBhcmFtczoge1xyXG4gICAgICAgICAgICAgICAgJ2FjdGlvbkl0ZW0nOiBudWxsLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3BhcnRpYWxzL2FjY2VwdExvZGdlbWVudFBhZ2UuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdhY2NlcHRMb2RnZW1lbnRDdHJsJyxcclxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgYmVuZWZpY2lhcnlMbmRpbmdQYWdlID0ge1xyXG4gICAgICAgICAgICBuYW1lOiAnYmVuZWZpY2lhcnlMbmRpbmdQYWdlJyxcclxuICAgICAgICAgICAgdXJsOiAnL2JlbmVmaWNpYXJ5L2hvbWUnLFxyXG4gICAgICAgICAgICBwYXJhbXM6IHtcclxuICAgICAgICAgICAgICAgICdhY3Rpb25JdGVtJzogbnVsbCxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdwYXJ0aWFscy9iZW5lZmljaWFyeUxhbmRpbmdQYWdlLmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnYmVuZWZpY2lhcnlDdHJsJyxcclxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgcHJlc2VudGluZ0xhbmRpbmdQYWdlID0ge1xyXG4gICAgICAgICAgICBuYW1lOiAncHJlc2VudGluZ0xhbmRpbmdQYWdlJyxcclxuICAgICAgICAgICAgdXJsOiAnL3ByZXNlbnRpbmcvaG9tZScsXHJcbiAgICAgICAgICAgIHBhcmFtczoge1xyXG4gICAgICAgICAgICAgICAgJ2FjdGlvbkl0ZW0nOiBudWxsLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3BhcnRpYWxzL3ByZXNlbnRpbmdMYW5kaW5nUGFnZS5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ3ByZXNlbnRpbmdDdHJsJyxcclxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nXHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgLy8gVGhlIGNoYW5nZXMgZm9yIHdpcmUgZnJhbWVzIEVuZHMgaGVyZVxyXG5cclxuICAgICAgICB2YXIgaXNzdWluZ0Zvcm0gPSB7XHJcbiAgICAgICAgICAgIG5hbWU6ICdpc3N1aW5nRm9ybScsXHJcbiAgICAgICAgICAgIHVybDogJy9pc3N1aW5nRm9ybScsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAncGFydGlhbHMvaXNzdWluZ0Zvcm0uaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdpc3N1ZUZvcm1DdHJsJyxcclxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nXHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIC8vIHVybCB3aWxsIGJlIHZtL29yZGVyRGV0YWlsc1xyXG4gICAgICAgIC8vIC8vIG5lc3RlZCBzdGF0ZXNcclxuICAgICAgICAvLyB2YXIgb3JkZXJEZXRhaWxzID0ge1xyXG4gICAgICAgIC8vICAgICBuYW1lOiAnYXBwbGljYW50Rm9ybS5vcmRlckRldGFpbHMnLFxyXG4gICAgICAgIC8vICAgICB1cmw6ICcvb3JkZXJEZXRhaWxzJyxcclxuICAgICAgICAvLyAgICAgdGVtcGxhdGVVcmw6ICdwYXJ0aWFscy9hcHBsaWNhbnRPcmRlckRldGFpbHMuaHRtbCcsXHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIC8vIHZhciBkZXRhaWxzID0ge1xyXG4gICAgICAgIC8vICAgICBuYW1lOiAnZGV0YWlscycsXHJcbiAgICAgICAgLy8gICAgIHVybDogJy9kZXRhaWxzLzppdGVtSWQnLFxyXG4gICAgICAgIC8vICAgICB0ZW1wbGF0ZVVybDogJ3BhcnRpYWxzL2RldGFpbHMuaHRtbCcsXHJcbiAgICAgICAgLy8gICAgIGNvbnRyb2xsZXI6ICdkZXRhaWxzQ3RybCcsXHJcbiAgICAgICAgLy8gICAgIGNvbnRyb2xsZXJBczogJ3ZtJ1xyXG4gICAgICAgIC8vIH1cclxuXHJcblxyXG4gICAgICAgIC8vIHZhciB1cGxvYWQgPSB7XHJcbiAgICAgICAgLy8gICAgIG5hbWU6ICd1cGxvYWQnLFxyXG4gICAgICAgIC8vICAgICB1cmw6ICcvdXBsb2FkJyxcclxuICAgICAgICAvLyAgICAgdGVtcGxhdGVVcmw6ICdwYXJ0aWFscy9maWxldXBsb2FkLmh0bWwnLFxyXG4gICAgICAgIC8vICAgICBjb250cm9sbGVyOiAnZmlsZUN0cmwnLFxyXG4gICAgICAgIC8vICAgICBjb250cm9sbGVyQXM6ICd2bSdcclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIHZhciBibG9ja2V4cGxvcmVyID0ge1xyXG4gICAgICAgICAgICBuYW1lOiAnYmxvY2tleHBsb3JlcicsXHJcbiAgICAgICAgICAgIHVybDogJy9ibG9ja2V4cGxvcmVyJyxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdwYXJ0aWFscy9ibG9ja21haW4uaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdtYWluRGFzaEN0cmwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bSdcclxuICAgICAgICB9XHJcbiAgICAgICAgLy9cclxuICAgICAgICB2YXIgYmxvY2tpZCA9IHtcclxuICAgICAgICAgICAgbmFtZTogJ2Jsb2NraWQnLFxyXG4gICAgICAgICAgICB1cmw6ICcvYmxvY2svOmJsb2NrSWQnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3BhcnRpYWxzL2Jsb2NrSW5mb3MuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdibG9ja0luZm9zQ3RybCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJ1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL1xyXG4gICAgICAgIHZhciB0cmFuc2FjdGlvbmlkID0ge1xyXG4gICAgICAgICAgICBuYW1lOiAndHJhbnNhY3Rpb25pZCcsXHJcbiAgICAgICAgICAgIHVybDogJy90eC86dHJhbnNhY3Rpb25JZCcsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAncGFydGlhbHMvdHJhbnNhY3Rpb25JbmZvcy5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ3RyYW5zYWN0aW9uSW5mb3NDdHJsJyxcclxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nXHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdmFyIGFkZHJlc3MgPSB7XHJcbiAgICAgICAgICAgIG5hbWU6ICdhZGRyZXNzJyxcclxuICAgICAgICAgICAgdXJsOiAnL2FkZHJlc3MvOmFkZHJlc3NJZCcsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAncGFydGlhbHMvYWRkcmVzc0luZm9zLmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnYWRkcmVzc0luZm9zQ3RybCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJ1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgY2hhaW5hcGkgPSB7XHJcbiAgICAgICAgICAgIG5hbWU6ICdjaGFpbmFwaScsXHJcbiAgICAgICAgICAgIHVybDogJy9jaGFpbi9hcGknLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3BhcnRpYWxzL2FwaS5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2NoYWluSW5mb3NDdHJsJyxcclxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBjaGFpbiA9IHtcclxuICAgICAgICAgICAgbmFtZTogJ2NoYWluJyxcclxuICAgICAgICAgICAgdXJsOiAnL2NoYWluLycsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAncGFydGlhbHMvY2hhaW5JbmZvcy5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2NoYWluSW5mb3NDdHJsJyxcclxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nXHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgLy9cclxuICAgICAgICAvLyB2YXIgZGlmZmljdWx0eSA9IHtcclxuICAgICAgICAvLyAgICAgbmFtZTogJ2RpZmZpY3VsdHknLFxyXG4gICAgICAgIC8vICAgICB1cmw6ICcvY2hhaW4vZGlmZmljdWx0eScsXHJcbiAgICAgICAgLy8gICAgIHRlbXBsYXRlVXJsOiAncGFydGlhbHMvYXBpL2RpZmZpY3VsdHkuaHRtbCcsXHJcbiAgICAgICAgLy8gICAgIGNvbnRyb2xsZXI6ICdjaGFpbkluZm9zQ3RybCcsXHJcbiAgICAgICAgLy8gICAgIGNvbnRyb2xsZXJBczogJ3ZtJ1xyXG4gICAgICAgIC8vIH1cclxuXHJcblxyXG5cclxuICAgICAgICAkc3RhdGVQcm92aWRlclxyXG4gICAgICAgICAgICAuc3RhdGUobG9naW5TdGF0ZSlcclxuICAgICAgICAgICAgLnN0YXRlKHNpZ25VcFN0YXRlKVxyXG4gICAgICAgICAgICAuc3RhdGUoaXBmcylcclxuICAgICAgICAgICAgLnN0YXRlKGhvbWUpXHJcbiAgICAgICAgICAgIC5zdGF0ZShpbml0aWF0ZUxjKVxyXG4gICAgICAgICAgICAuc3RhdGUoaXNzdWVCYW5rTG5kaW5nUGFnZSlcclxuICAgICAgICAgICAgLnN0YXRlKGFkdmlzaW5nQmFua0xuZGluZ1BhZ2UpXHJcbiAgICAgICAgICAgIC5zdGF0ZShiZW5lZmljaWFyeUxuZGluZ1BhZ2UpXHJcbiAgICAgICAgICAgIC5zdGF0ZShwcmVzZW50aW5nTGFuZGluZ1BhZ2UpXHJcbiAgICAgICAgICAgIC5zdGF0ZShpc3N1aW5nRm9ybSlcclxuICAgICAgICAgICAgLy8gLnN0YXRlKGRldGFpbHMpXHJcbiAgICAgICAgICAgIC5zdGF0ZShsb2dvdXRTdGF0ZSlcclxuICAgICAgICAgICAgLnN0YXRlKG5vdGlmaWNhdGlvbilcclxuICAgICAgICAgICAgLnN0YXRlKGRhc2hib2FyZClcclxuICAgICAgICAgICAgLnN0YXRlKGFjY2VwdExvZGdlbWVudFBhZ2UpXHJcblxyXG4gICAgICAgICAgICAuc3RhdGUoYmxvY2tleHBsb3JlcilcclxuICAgICAgICAgICAgLnN0YXRlKGJsb2NraWQpXHJcbiAgICAgICAgICAgIC5zdGF0ZSh0cmFuc2FjdGlvbmlkKVxyXG4gICAgICAgICAgICAuc3RhdGUoYWRkcmVzcylcclxuICAgICAgICAgICAgLnN0YXRlKGNoYWluYXBpKVxyXG4gICAgICAgICAgICAuc3RhdGUoY2hhaW4pO1xyXG5cclxuICAgICAgICAvLyBkZWZhdWx0IHJvdXRlXHJcbiAgICAgICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnL2xvZ2luJyk7XHJcbiAgICAgICAgLy8gZW5hYmxlIGh0bWw1TW9kZSB0byBnZXQgcmlkIG9mICMgYXBwZW5kZWQgaW4gVVJMXHJcbiAgICAgICAgLy8gJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHJ1bigkcm9vdFNjb3BlLCAkbG9jYXRpb24sIGF1dGhlbnRpY2F0aW9uKSB7XHJcblxyXG4gICAgICAgIHZhciB3ZWIzID0gcmVxdWlyZSgnd2ViMycpO1xyXG4gICAgICAgIHZhciB1cmwgPSAkbG9jYXRpb24uYWJzVXJsKCkuc3BsaXQoJyMhJylbMF07XHJcbiAgICAgICAgdmFyIHByb3RvY29sID0gdXJsLnNwbGl0KCc6JylbMF07XHJcbiAgICAgICAgdmFyIGV0aERvbWFpbiA9IHVybC5zcGxpdCgnOicpWzFdO1xyXG4gICAgICAgIHZhciBldGhQb3J0ID0gXCI4NTQ1XCI7XHJcbiAgICAgICAgY29uc29sZS5sb2cocHJvdG9jb2wgKyBcIjpcIiArIGV0aERvbWFpbiArIFwiOlwiICsgZXRoUG9ydCk7XHJcbiAgICAgICAgaWYgKGV0aERvbWFpbiA9PSBcIjUyLjE3Mi40NC42OFwiKSB7XHJcbiAgICAgICAgICAgIC8vIHBvaW50IHRvIHRoZSBzZXJ2ZXIgd2hlcmUgZXRoZXJldW0gaXMgZGVwbG95ZWRcclxuICAgICAgICAgICAgZXRoRG9tYWluID0gXCIxNzIuMTguMjUuMTgwXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciB3ZWIzID0gbmV3IFdlYjMobmV3IFdlYjMucHJvdmlkZXJzLkh0dHBQcm92aWRlcihwcm90b2NvbCArIFwiOlwiICsgZXRoRG9tYWluICsgXCI6XCIgKyBldGhQb3J0KSk7XHJcbiAgICAgICAgJHJvb3RTY29wZS53ZWIzID0gd2ViMztcclxuICAgICAgICAkcm9vdFNjb3BlLiRvbignJGxvY2F0aW9uQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbihldmVudCwgbmV4dFJvdXRlLCBjdXJyZW50Um91dGUpIHtcclxuICAgICAgICAgICAgdmFyIHB1YmxpY1BhZ2VzID0gWycvbG9naW4nLCAnL3NpZ251cCcsICcvbG9nb3V0J107XHJcbiAgICAgICAgICAgIHZhciByZXN0cmljdGVkUGFnZSA9IHB1YmxpY1BhZ2VzLmluZGV4T2YoJGxvY2F0aW9uLnBhdGgoKSkgPT09IC0xO1xyXG4gICAgICAgICAgICBpZiAocmVzdHJpY3RlZFBhZ2UgJiYgIWF1dGhlbnRpY2F0aW9uLmlzTG9nZ2VkSW4oKSkge1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9sb2dpbicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24oKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdteUFwcCcpXHJcbiAgICAgICAgLnNlcnZpY2UoJ2FwaUNhbGwnLCBhcGlDYWxsKTtcclxuXHJcbiAgICBhcGlDYWxsLiRpbmplY3QgPSBbJyRodHRwJywgJ2F1dGhlbnRpY2F0aW9uJywgJyRzdGF0ZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIGFwaUNhbGwoJGh0dHAsIGF1dGhlbnRpY2F0aW9uLCAkc3RhdGUpIHtcclxuICAgICAgICB2YXIgbWFrZUNhbGwgPSBmdW5jdGlvbih1cmwsIGh0dHBNZXRob2QsIGRhdGEpe1xyXG4gICAgICAgICAgY29uc29sZS5sb2coXCJpbnNpZGUgYXBpQ2FsbCBzZXJ2aWNlICEhXCIpO1xyXG4gICAgICAgICAgdmFyIHJlc3VsdCA9IHtcclxuICAgICAgICAgICAgc3RhdHVzOlwiXCIsXHJcbiAgICAgICAgICAgIGRhdGE6XCJcIlxyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIGlmKCBodHRwTWV0aG9kID09PSBcInBvc3RcIiApe1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInBvc3Q6IFwiICsgdXJsKTtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QodXJsLGRhdGEse1xyXG4gICAgICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogJ0JlYXJlciAnICsgYXV0aGVudGljYXRpb24uZ2V0VG9rZW4oKVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSkudGhlbihcclxuICAgICAgICAgICAgICBmdW5jdGlvbiBzdWNjZXNzKHJlc3BvbnNlKXtcclxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQuc3RhdHVzID0gXCJzdWNjZXNzXCI7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQuZGF0YSA9IHJlc3BvbnNlLmRhdGEubWVzc2FnZTtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICBmdW5jdGlvbiBlcnJvcihyZXNwb25zZSl7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXNlciA9IGF1dGhlbnRpY2F0aW9uLmN1cnJlbnRVc2VyKCk7XHJcbiAgICAgICAgICAgICAgICBpZih1c2VyLnJvbGUhPTIwMCkge1xyXG4gICAgICAgICAgICAgICAgICByZXN1bHQuc3RhdHVzID0gXCJSb2xlIEJhc2VkIEF1dGhlbnRpY2F0aW9uIEZhaWxlZFwiO1xyXG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIldyb25nIHVzZXIgcm9sZVwiKTtcclxuICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdob21lJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnN0YXR1cyA9IFwiZmFpbHVyZVwiO1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0LmRhdGEgPSByZXNwb25zZS5kYXRhLm1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGVsc2UgaWYoIGh0dHBNZXRob2QgPT09IFwiZ2V0XCIpe1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImdldDogXCIgKyB1cmwpO1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCx7XHJcbiAgICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAnQmVhcmVyICcgKyBhdXRoZW50aWNhdGlvbi5nZXRUb2tlbigpXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KS50aGVuKFxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIHN1Y2Nlc3MocmVzcG9uc2Upe1xyXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5zdGF0dXMgPSBcInN1Y2Nlc3NcIjtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5kYXRhID0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlO1xyXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzdWx0LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIGVycm9yKHJlc3BvbnNlKXtcclxuICAgICAgICAgICAgICAgIHZhciB1c2VyID0gYXV0aGVudGljYXRpb24uY3VycmVudFVzZXIoKTtcclxuICAgICAgICAgICAgICAgIGlmKHVzZXIucm9sZSE9MjAwKSB7XHJcbiAgICAgICAgICAgICAgICAgIHJlc3VsdC5zdGF0dXMgPSBcIlJvbGUgQmFzZWQgQXV0aGVudGljYXRpb24gRmFpbGVkXCI7XHJcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiV3JvbmcgdXNlciByb2xlXCIpO1xyXG4gICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ2hvbWUnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQuc3RhdHVzID0gXCJmYWlsdXJlXCI7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQuZGF0YSA9IHJlc3BvbnNlLmRhdGEubWVzc2FnZTtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJOb3QgYSBzdXBwb3J0ZWQgaHR0cE1ldGhvZFwiKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgbWFrZUNhbGw6IG1ha2VDYWxsLFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG4gICAgfVxyXG5cclxuXHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbigpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ215QXBwJylcbiAgICAgICAgLnNlcnZpY2UoJ2F1dGhlbnRpY2F0aW9uJywgYXV0aGVudGljYXRpb24pO1xuXG4gICAgYXV0aGVudGljYXRpb24uJGluamVjdCA9IFsnJGh0dHAnLCAnJHdpbmRvdyddO1xuXG4gICAgZnVuY3Rpb24gYXV0aGVudGljYXRpb24oJGh0dHAsICR3aW5kb3cpIHtcblxuXG4gICAgICAgIHZhciBzYXZlVG9rZW4gPSBmdW5jdGlvbih0b2tlbikge1xuICAgICAgICAgICAgJHdpbmRvdy5zZXNzaW9uU3RvcmFnZVsnbWVhbi10b2tlbiddID0gdG9rZW47XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldFRva2VuID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJHdpbmRvdy5zZXNzaW9uU3RvcmFnZVsnbWVhbi10b2tlbiddO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpc0xvZ2dlZEluID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgdG9rZW4gPSBnZXRUb2tlbigpO1xuICAgICAgICAgICAgdmFyIHBheWxvYWQ7XG5cbiAgICAgICAgICAgIGlmICh0b2tlbikge1xuICAgICAgICAgICAgICAgIHBheWxvYWQgPSB0b2tlbi5zcGxpdCgnLicpWzFdO1xuICAgICAgICAgICAgICAgIHBheWxvYWQgPSAkd2luZG93LmF0b2IocGF5bG9hZCk7XG4gICAgICAgICAgICAgICAgcGF5bG9hZCA9IEpTT04ucGFyc2UocGF5bG9hZCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBheWxvYWQuZXhwID4gRGF0ZS5ub3coKSAvIDEwMDA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgY3VycmVudFVzZXJSb2xlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgdXNlciA9IHRoaXMuY3VycmVudFVzZXIoKTtcbiAgICAgICAgICAgIHZhciByb2xlO1xuICAgICAgICAgICAgaWYgKHVzZXIgJiYgdXNlciAhPT0gXCJcIikge1xuICAgICAgICAgICAgICAgIHJvbGUgPSB1c2VyLnJvbGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcm9sZTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgY3VycmVudFVzZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChpc0xvZ2dlZEluKCkpIHtcbiAgICAgICAgICAgICAgICB2YXIgdG9rZW4gPSBnZXRUb2tlbigpO1xuICAgICAgICAgICAgICAgIHZhciBwYXlsb2FkID0gdG9rZW4uc3BsaXQoJy4nKVsxXTtcbiAgICAgICAgICAgICAgICBwYXlsb2FkID0gJHdpbmRvdy5hdG9iKHBheWxvYWQpO1xuICAgICAgICAgICAgICAgIHBheWxvYWQgPSBKU09OLnBhcnNlKHBheWxvYWQpO1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIGVtYWlsOiBwYXlsb2FkLmVtYWlsLFxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBwYXlsb2FkLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHJvbGU6IHBheWxvYWQucm9sZSxcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBwYXlsb2FkLnVzZXJJZFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHJlZ2lzdGVyID0gZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgY29uc29sZS5sb2codXNlcik7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL3VzZXIvcmVnaXN0ZXInLCB1c2VyKS50aGVuKFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICBzYXZlVG9rZW4ocmVzcG9uc2UuZGF0YS50b2tlbik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIGVycm9yXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgbG9naW4gPSBmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL3VzZXIvbG9naW4nLCB1c2VyKS50aGVuKFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFNhdmUgdG9rZW4gaW4gbG9jYWwgc3RvcmFnZVxuICAgICAgICAgICAgICAgICAgICBzYXZlVG9rZW4ocmVzcG9uc2UuZGF0YS50b2tlbik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHJldHVybiBlcnJvciByZXNwb25zZVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG5cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuXG5cbiAgICAgICAgdmFyIGxvZ291dCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHdpbmRvdy5zZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCdtZWFuLXRva2VuJyk7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgICAgICAgY3VycmVudFVzZXI6IGN1cnJlbnRVc2VyLFxuICAgICAgICAgICAgc2F2ZVRva2VuOiBzYXZlVG9rZW4sXG4gICAgICAgICAgICBnZXRUb2tlbjogZ2V0VG9rZW4sXG4gICAgICAgICAgICBpc0xvZ2dlZEluOiBpc0xvZ2dlZEluLFxuICAgICAgICAgICAgcmVnaXN0ZXI6IHJlZ2lzdGVyLFxuICAgICAgICAgICAgbG9naW46IGxvZ2luLFxuICAgICAgICAgICAgcm9sZTogY3VycmVudFVzZXJSb2xlLFxuICAgICAgICAgICAgbG9nb3V0OiBsb2dvdXRcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gc2VydmljZTtcblxuICAgIH1cblxuXG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2ZpbHRlcnMnLCBbXSlcclxuICAgICAgICAuZmlsdGVyKCd0cnVuY2F0ZScsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24odGV4dCwgbGVuZ3RoLCBlbmQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChpc05hTihsZW5ndGgpKVxyXG4gICAgICAgICAgICAgICAgICAgIGxlbmd0aCA9IDEwO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChlbmQgPT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICBlbmQgPSBcIi4uLlwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0ZXh0Lmxlbmd0aCA8PSBsZW5ndGggfHwgdGV4dC5sZW5ndGggLSBlbmQubGVuZ3RoIDw9IGxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0ZXh0O1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nKHRleHQpLnN1YnN0cmluZygwLCBsZW5ndGggLSBlbmQubGVuZ3RoKSArIGVuZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9KS5cclxuICAgIGZpbHRlcignZGlmZkZvcm1hdCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbihkaWZmaSkge1xyXG4gICAgICAgICAgICBpZiAoaXNOYU4oZGlmZmkpKSByZXR1cm4gZGlmZmk7XHJcbiAgICAgICAgICAgIHZhciBuID0gZGlmZmkgLyAxMDAwMDAwMDAwMDAwO1xyXG4gICAgICAgICAgICByZXR1cm4gbi50b0ZpeGVkKDMpICsgXCIgVFwiO1xyXG4gICAgICAgIH07XHJcbiAgICB9KS5cclxuICAgIGZpbHRlcignc3R5bGl6ZScsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbihzdHlsZSkge1xyXG4gICAgICAgICAgICBpZiAoaXNOYU4oc3R5bGUpKSByZXR1cm4gc3R5bGU7XHJcbiAgICAgICAgICAgIHZhciBzaSA9ICc8c3BhbiBjbGFzcz1cImJ0biBidG4tcHJpbWFyeVwiPicgKyBzdHlsZSArICc8L3NwYW4+JztcclxuICAgICAgICAgICAgcmV0dXJuIHNpO1xyXG4gICAgICAgIH07XHJcbiAgICB9KS5cclxuICAgIGZpbHRlcignc3R5bGl6ZTInLCBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24odGV4dCkge1xyXG4gICAgICAgICAgICBpZiAoaXNOYU4odGV4dCkpIHJldHVybiB0ZXh0O1xyXG4gICAgICAgICAgICB2YXIgc2kgPSAnPGkgY2xhc3M9XCJmYSBmYS1leGNoYW5nZVwiPjwvaT4gJyArIHRleHQ7XHJcbiAgICAgICAgICAgIHJldHVybiBzaTtcclxuICAgICAgICB9O1xyXG4gICAgfSkuXHJcbiAgICBmaWx0ZXIoJ2hhc2hGb3JtYXQnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24oaGFzaHIpIHtcclxuICAgICAgICAgICAgaWYgKGlzTmFOKGhhc2hyKSkgcmV0dXJuIGhhc2hyO1xyXG4gICAgICAgICAgICB2YXIgbiA9IGhhc2hyIC8gMTAwMDAwMDAwMDAwMDtcclxuICAgICAgICAgICAgcmV0dXJuIG4udG9GaXhlZCgzKSArIFwiIFRIL3NcIjtcclxuICAgICAgICB9O1xyXG4gICAgfSkuXHJcbiAgICBmaWx0ZXIoJ2dhc0Zvcm1hdCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbih0eHQpIHtcclxuICAgICAgICAgICAgaWYgKGlzTmFOKHR4dCkpIHJldHVybiB0eHQ7XHJcbiAgICAgICAgICAgIHZhciBiID0gbmV3IEJpZ051bWJlcih0eHQpO1xyXG4gICAgICAgICAgICByZXR1cm4gYi50b0Zvcm1hdCgwKSArIFwiIG0vc1wiO1xyXG4gICAgICAgIH07XHJcbiAgICB9KS5cclxuICAgIGZpbHRlcignQmlnTnVtJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHR4dCkge1xyXG4gICAgICAgICAgICBpZiAoaXNOYU4odHh0KSkgcmV0dXJuIHR4dDtcclxuICAgICAgICAgICAgdmFyIGIgPSBuZXcgQmlnTnVtYmVyKHR4dCk7XHJcbiAgICAgICAgICAgIHZhciB3ID0gd2ViMy5mcm9tV2VpKGIsIFwiZXRoZXJcIik7XHJcbiAgICAgICAgICAgIHJldHVybiB3LnRvRml4ZWQoNikgKyBcIiBFVEhcIjtcclxuICAgICAgICB9O1xyXG4gICAgfSkuXHJcbiAgICBmaWx0ZXIoJ3NpemVGb3JtYXQnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24oc2l6ZSkge1xyXG4gICAgICAgICAgICBpZiAoaXNOYU4oc2l6ZSkpIHJldHVybiBzaXplO1xyXG4gICAgICAgICAgICB2YXIgcyA9IHNpemUgLyAxMDAwO1xyXG4gICAgICAgICAgICByZXR1cm4gcy50b0ZpeGVkKDMpICsgXCIga0JcIjtcclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbigpIHtcblxuICBhbmd1bGFyXG4gICAgICAubW9kdWxlKCdteUFwcCcpXG4gICAgICAuZGlyZWN0aXZlKCdnb0JhY2snLCBnb0JhY2spO1xuXG4gIGZ1bmN0aW9uIGdvQmFjayggJHdpbmRvdyApIHtcbiAgICByZXR1cm4gZnVuY3Rpb24oJHNjb3BlLCAkZWxlbWVudCl7XG4gICAgICAkZWxlbWVudC5vbignY2xpY2snLCBmdW5jdGlvbigpe1xuICAgICAgICAkd2luZG93Lmhpc3RvcnkuYmFjaygpO1xuICAgICAgfSlcbiAgfVxuICB9XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ215QXBwJylcclxuICAgICAgICAuZGlyZWN0aXZlKCdsaW1pdFRvTWF4TWluJywgbGltaXRUb01heE1pbik7XHJcblxyXG4gICAgZnVuY3Rpb24gbGltaXRUb01heE1pbigpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICByZXF1aXJlOiAnbmdNb2RlbCcsXHJcbiAgICAgICAgICAgIHNjb3BlOntcclxuICAgICAgICAgICAgICBuZ01vZGVsOiAnPSdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJpYnV0ZXMpIHtcclxuICAgICAgICAgICAgICAvLyBlbGVtZW50Lm9uKFwia2V5ZG93biBrZXl1cFwiLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgZWxlbWVudC5vbihcImJsdXJcIiwgZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKE51bWJlcihlbGVtZW50LnZhbCgpKSA+IE51bWJlcihhdHRyaWJ1dGVzLm1heCkgJiZcclxuICAgICAgICAgICAgICAgICAgICAgIGUua2V5Q29kZSAhPSA0NiAvLyBkZWxldGVcclxuICAgICAgICAgICAgICAgICAgICAgICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICBlLmtleUNvZGUgIT0gOCAvLyBiYWNrc3BhY2VcclxuICAgICAgICAgICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQudmFsKGF0dHJpYnV0ZXMubWF4KTtcclxuICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5nTW9kZWwgPSBOdW1iZXIoYXR0cmlidXRlcy5tYXgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChOdW1iZXIoZWxlbWVudC52YWwoKSkgPCBOdW1iZXIoYXR0cmlidXRlcy5taW4pICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICBlLmtleUNvZGUgIT0gNDYgLy8gZGVsZXRlXHJcbiAgICAgICAgICAgICAgICAgICAgICAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgZS5rZXlDb2RlICE9IDggLy8gYmFja3NwYWNlXHJcbiAgICAgICAgICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnZhbChhdHRyaWJ1dGVzLm1pbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICBzY29wZS5uZ01vZGVsID0gTnVtYmVyKGF0dHJpYnV0ZXMubWluKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uKCkge1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdteUFwcCcpXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgnbmF2aWdhdGlvbicsIG5hdmlnYXRpb24pO1xyXG5cclxuICAgIGZ1bmN0aW9uIG5hdmlnYXRpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFQScsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnLi4vLi4vcGFydGlhbHMvbmF2aWdhdGlvbi5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ25hdmlnYXRpb25DdHJsIGFzIG5hdnZtJ1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICBcclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uKCkge1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdteUFwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ3ByaW50cGFnZScsIHByaW50cGFnZSk7XG5cbiAgICBmdW5jdGlvbiBwcmludHBhZ2UoICR0aW1lb3V0ICkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHRlbXBsYXRlOiBcIjxidXR0b24gY2xhc3M9J2J0biBidG4taW52ZXJzZSBidG4tbGcgYnRuLWxvZ2luJz5cIiArXG4gICAgICAgICAgICBcdFx0XHRcdFx0ICBcIlByaW50XCIgK1xuICAgICAgICAgICAgXHRcdFx0XHRcdFwiPC9idXR0b24+XCIsXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cmlidXRlcykge1xuICAgICAgICAgICAgICBlbGVtZW50Lm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIHZhciBleHBhbmRCdXR0b24gPSBhbmd1bGFyLmVsZW1lbnQoXCIjY29sbGFwc2UtaW5pdFwiKTtcbiAgICAgICAgICAgICAgICB2YXIgZXhwYW5kVGV4dCA9IGV4cGFuZEJ1dHRvbi50ZXh0KCk7XG4gICAgICAgICAgICAgICAgaWYoIGV4cGFuZFRleHQudHJpbSgpID09PSBcIkV4cGFuZCBBbGxcIiApe1xuICAgICAgICAgICAgICAgICAgZXhwYW5kQnV0dG9uLmNsaWNrKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICR0aW1lb3V0KCBmdW5jdGlvbigpeyB3aW5kb3cucHJpbnQoKSB9LCAyMDAwKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxuXG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnbXlBcHAnKVxuICAgICAgICAuY29udHJvbGxlcignYWNjZXB0TG9kZ2VtZW50Q3RybCcsIGFjY2VwdExvZGdlbWVudEN0cmwpO1xuXG4gICAgYWNjZXB0TG9kZ2VtZW50Q3RybC4kaW5qZWN0ID0gWyckc2NvcGUnLCckaHR0cCcsJ2F1dGhlbnRpY2F0aW9uJywnJHJvb3RTY29wZScsJyR3aW5kb3cnLCckc3RhdGUnLCckc3RhdGVQYXJhbXMnXTtcblxuICAgIGZ1bmN0aW9uIGFjY2VwdExvZGdlbWVudEN0cmwoJHNjb3BlLCRodHRwLGF1dGhlbnRpY2F0aW9uLCAkcm9vdFNjb3BlLCR3aW5kb3csJHN0YXRlLCRzdGF0ZVBhcmFtcykge1xuXHRcdGNvbnNvbGUubG9nKFwiaW5zaWRlIGFjY2VwdExvZGdlbWVudEN0cmwtMVwiKVxuXHQgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgdm0uaW5pdCA9IGZ1bmN0aW9uKCl7XG5cdCAgICAgJGh0dHAuZ2V0KCcvYWNjZXB0TG9kZ2VtZW50L2xjRGV0YWlscycsIHtcblx0XHRcdCBoZWFkZXJzOiB7XG5cdFx0XHRcdCBBdXRob3JpemF0aW9uOiAnQmVhcmVyICcgKyBhdXRoZW50aWNhdGlvbi5nZXRUb2tlbigpXG5cdFx0XHQgfVxuXHRcdCB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cdFx0XHQkc2NvcGUuYWNwdExkZ21lbnRMQ0xpc3QgPSByZXNwb25zZS5kYXRhO1xuXHRcdFx0Y29uc29sZS5sb2coJHNjb3BlLmFjcHRMZGdtZW50TENMaXN0KTtcblx0XHQgfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdCAgIHZhciB1c2VyID0gYXV0aGVudGljYXRpb24uY3VycmVudFVzZXIoKTtcblx0XHRcdCAgIGlmKHVzZXIucm9sZSE9MjAwKSB7XG5cdFx0XHRcdCAgICRzY29wZS5lcnJvck1zZyA9IFwiTm90IHRoZSBjb3JyZWN0IHJvbGVcIjtcblx0XHRcdFx0ICAgJHN0YXRlLmdvKCdob21lJyk7XG5cdFx0XHQgICB9XG5cdFx0XHQgfSlcbiAgICAgICAudGhlbiggZnVuY3Rpb24oKXtcbiAgICAgICAgIGlmKCAkc3RhdGVQYXJhbXMuYWN0aW9uSXRlbSAhPSBcIlwiICYmICRzdGF0ZVBhcmFtcy5hY3Rpb25JdGVtICE9IG51bGwgKXtcbiAgICAgICAgICAgY29uc29sZS5sb2coXCJhY3Rpb24gaXRlbSBub3QgbnVsbFwiKTtcbiAgICAgICAgICAgY29uc29sZS5sb2coJHN0YXRlUGFyYW1zLmFjdGlvbkl0ZW0pO1xuXG4gICAgICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5hY3B0TGRnbWVudExDTGlzdCk7XG4gICAgICAgICB2YXIgc2VsZWN0ZWRMY051bWJlciA9ICRzY29wZS5hY3B0TGRnbWVudExDTGlzdC5maWx0ZXIoZnVuY3Rpb24oIGRhdGFPYmogKSB7XG4gICAgICAgICAgICAgICAgIHJldHVybiAoZGF0YU9iai5sY051bWJlciA9PSAkc3RhdGVQYXJhbXMuYWN0aW9uSXRlbSApIDtcbiAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgJHNjb3BlLmFjcHRMZGdtZW50Rm9ybURldGFpbHMgPSBzZWxlY3RlZExjTnVtYmVyWzBdO1xuICAgICAgICAgdm0uc2hvd0FjY29yZGlvbiA9IHRydWU7XG4gICAgICAgICAkc3RhdGVQYXJhbXMuYWN0aW9uSXRlbSA9IFwiXCI7XG4gICAgICAgICB9XG4gICAgICAgfSk7XG5cdCAgIH1cblxuXHQgIC8qIGZ1bmN0aW9uIHRvIGVuYWJsZSBBY2NvcmRpYW4gb24gc2VsZWN0aW9uIG9mIExDIE51bWJlciBvbiB0aGUgSFRNTCBwYWdlICovXG5cdCAgdm0uZmV0Y2hEZXRhaWwgPSBmdW5jdGlvbihsY0RldGFpbHMpe1xuICAgICAgaWYoIGxjRGV0YWlscyAhPSBudWxsICYmIGxjRGV0YWlscyAhPSBcIlwiKXtcbiAgICAgICAgdm0uc2hvd0FjY29yZGlvbiA9IHRydWU7XG4gICAgICAgIHZtLnN1Ym1pdE1lc3NhZ2UgPSBcIlwiO1xuICAgICAgfVxuXHQgIH1cblxuXG5cdCAgLyogRnVuY3Rpb24gdG8gY2xlYXIgdGhlIGZpZWxkcyBvbiByZXNldCBidXR0b24gKi9cblx0ICB2bS5jbGVhciA9IGZ1bmN0aW9uKCl7XG5cdFx0XHRjb25zb2xlLmxvZyhcImNsZWFyIGFsbCBmaWVsZHMgaW5zaWRlIGFjY2VwdExvZGdlbWVudFNlcnZpY2UtMlwiKTtcblx0XHRcdHZtLnN1Ym1pdE1lc3NhZ2UgPSBcIlwiO1xuXHRcdCAgIGlmKCAkc2NvcGUuYWNwdExkZ21lbnRGb3JtRGV0YWlscyAhPSBcIlwiICYmICRzY29wZS5hY3B0TGRnbWVudEZvcm1EZXRhaWxzICE9IHVuZGVmaW5lZFxuICAgICAgICAgICYmICRzY29wZS5hY3B0TGRnbWVudEZvcm1EZXRhaWxzICE9IG51bGwgKXtcblx0XHRcdCAgY29uc29sZS5sb2coXCJjbGVhcmluZyBhbGwgZmllbGRzXCIpO1xuXHRcdFx0ICAkc2NvcGUuYWNwdExkZ21lbnRGb3JtRGV0YWlscyA9IFwiXCI7XG5cdFx0XHQgIHZtLnNob3dBY2NvcmRpb249ZmFsc2U7XG5cdFx0ICB9XG5cblx0ICB9XG5cblx0ICAvKiBGdW5jdGlvbiB0byBTYXZlIHRoZSBBZHZpc2luZyBiYW5rIHNjcmVlbiBkZXRhaWxzICovXG5cdCAgdm0uc3VibWl0ID0gZnVuY3Rpb24obGNEZXRhaWxzKXtcblx0XHQgIGNvbnNvbGUubG9nKFwiaW5zaWRlIGFjY2VwdExvZGdlbWVudENvbnRyb2xsZXItPnN1Ym1pdCgpXCIpO1xuXHRcdCAgY29uc29sZS5sb2coXCJjb250cmFjdElEPVwiK2xjRGV0YWlscy5faWQpO1xuXHRcdCAgdmFyIGNvbnRyYWN0SUQgPSB7J2NvbnRyYWN0SUQnOiBsY0RldGFpbHMuX2lkfTtcblx0XHQgICAkaHR0cC5wb3N0KCcvYWNjZXB0TG9kZ2VtZW50L2FjY2VwdExDJyxjb250cmFjdElELCB7XG4gICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAnQmVhcmVyICcgKyBhdXRoZW50aWNhdGlvbi5nZXRUb2tlbigpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkudGhlbihcbiAgICAgICAgICAgICAgICBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgdm0uaW5pdCgpO1xuICAgICAgICAgICAgICAgICAgdm0uY2xlYXIoKTtcbiAgICAgICAgICAgICAgICAgIHZtLnN1Ym1pdE1lc3NhZ2U9XCJMb2RnZW1lbnQgQWNjZXB0ZWQgOiBCbG9jayBjaGFpbiBwcm9jZXNzaW5nIGluaXRpYXRlZFwiO1xuICAgICAgICAgICAgICAgICAgdm0uc2hvd0FjY29yZGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9KTtcblx0XHR9XG5cblx0ICB2bS5zZXRUYWIgPSBmdW5jdGlvbihpbmRleCl7XG4gICAgICAgIGlmKCBpbmRleCA9PSAkcm9vdFNjb3BlLnRhYklkZW50aWZpZXIgKXtcbiAgICAgICAgICByZXR1cm4gXCJhY3RpdmVcIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNle1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuXHQgIHZtLmluaXQoKTtcbiAgICB9XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnbXlBcHAnKVxuXG4gICAgICAgIC5jb250cm9sbGVyKCdhcHBsaWNhbnRDdHJsJywgYXBwbGljYW50Q3RybCk7XG5cbiAgICBhcHBsaWNhbnRDdHJsLiRpbmplY3QgPSBbJyRzY29wZScsICckaHR0cCcsICdhdXRoZW50aWNhdGlvbicsICdVcGxvYWQnLCAnJHRpbWVvdXQnLCAnJHN0YXRlJ107XG5cblxuICAgIGZ1bmN0aW9uIGFwcGxpY2FudEN0cmwoJHNjb3BlLCAkaHR0cCwgYXV0aGVudGljYXRpb24sIFVwbG9hZCwgJHRpbWVvdXQsICRzdGF0ZSkge1xuICAgICAgICBjb25zb2xlLmxvZyhcImluc2lkZSBhcHBsaWNhbnRGb3JtIGNvbnRyb2xsZXJcIilcbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgLy8gdXNpbmcgYmVsb3cgcmVnZXggaW4gbmctcGF0dGVyblxuICAgICAgICAkc2NvcGUub25seU51bWJlcnMgPSAvXlswLTldezEsN30kLztcblxuICAgICAgICAkaHR0cC5nZXQoJy9hcHBsaWNhbnQvb25sb2FkLycsIHtcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAnQmVhcmVyICcgKyBhdXRoZW50aWNhdGlvbi5nZXRUb2tlbigpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICRzY29wZS5hcHBGb3JtID0ge307XG4gICAgICAgICAgICAkc2NvcGUudG9kYXkgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgdmFyIHVzZXIgPSBhdXRoZW50aWNhdGlvbi5jdXJyZW50VXNlcigpO1xuICAgICAgICAgICAgdmFyIHNlbGxlcnMgPSBbXTtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCByZXNwb25zZS5kYXRhLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGFbaV0ucm9sZSA9PSAxMDAgJiYgdXNlci51c2VySWQgPT0gcmVzcG9uc2UuZGF0YVtpXS5faWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJ1eWVyID0gcmVzcG9uc2UuZGF0YVtpXTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYnV5ZXIpO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYXBwRm9ybS5idXllcklkID0gYnV5ZXIuX2lkO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYXBwRm9ybS5idXllck5hbWUgPSBidXllci5uYW1lO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYXBwRm9ybS5idXllckFkZCA9IGJ1eWVyLmFkZHJlc3M7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5hcHBGb3JtLmJ1eWVyQWNjTnVtYmVyID0gYnV5ZXIuYWNjb3VudERldGFpbC5hY2NvdW50Tm87XG4gICAgICAgICAgICAgICAgICAgIC8vJHNjb3BlLmFwcEZvcm0uYnV5ZXI9YnV5ZXI7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGFbaV0ucm9sZSA9PSA0MDApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGxlciA9IHtcbiAgICAgICAgICAgICAgICAgICAgICBzZWxsZXJJZDonJyxcbiAgICAgICAgICAgICAgICAgICAgICBuYW1lOicnLFxuICAgICAgICAgICAgICAgICAgICAgIHNlbGxlckFkZDonJyxcbiAgICAgICAgICAgICAgICAgICAgICBzZWxsZXJBY2NOdW1iZXI6JydcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgc2VsbGVyLnNlbGxlcklkPXJlc3BvbnNlLmRhdGFbaV0uX2lkO1xuICAgICAgICAgICAgICAgICAgICBzZWxsZXIubmFtZT1yZXNwb25zZS5kYXRhW2ldLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgIHNlbGxlci5zZWxsZXJBZGQ9cmVzcG9uc2UuZGF0YVtpXS5hZGRyZXNzO1xuICAgICAgICAgICAgICAgICAgICBzZWxsZXIuc2VsbGVyQWNjTnVtYmVyPXJlc3BvbnNlLmRhdGFbaV0uYWNjTnVtYmVyO1xuICAgICAgICAgICAgICAgICAgICBzZWxsZXJzLnB1c2goc2VsbGVyKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGFbaV0ucm9sZSA9PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlzc3VlQmFuayA9IHJlc3BvbnNlLmRhdGFbaV07XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5hcHBGb3JtLmJhbmtJZCA9IGlzc3VlQmFuay5faWQ7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5hcHBGb3JtLmlzc3VlQmFua05hbWUgPSBpc3N1ZUJhbmsuZW50aXR5O1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYXBwRm9ybS5pc3N1ZUJhbmtBZGRyZXNzID0gaXNzdWVCYW5rLmFkZHJlc3M7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5hcHBGb3JtLmlzc3VlQmFua0JyYW5jaCA9IGlzc3VlQmFuay5icmFuY2g7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5hcHBGb3JtLmlzc3VlQmFua0FkZHJlc3MgPSBpc3N1ZUJhbmsuYWRkcmVzcztcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGFbaV0ucm9sZSA9PSAzMDApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFkdkJhbmsgPSByZXNwb25zZS5kYXRhW2ldO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYXBwRm9ybS5hZHZCYW5rSWQgPSBhZHZCYW5rLl9pZDtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFwcEZvcm0uYWR2QmFua05hbWUgPSBhZHZCYW5rLmVudGl0eTtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFwcEZvcm0uYWR2QmFua0JyYW5jaCA9IGFkdkJhbmsuYnJhbmNoO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJHNjb3BlLmFwcEZvcm0uc2VsbGVycyA9IHNlbGxlcnM7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUuYXBwRm9ybS5zZWxsZXJzKTtcbiAgICAgICAgfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlmICh1c2VyLnJvbGUgIT0gMTAwKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yTXNnID0gXCJOb3QgdGhlIGNvcnJlY3Qgcm9sZVwiO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiV3JvbmcgdXNlciByb2xlXCIpO1xuICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnaG9tZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2Uuc3RhdHVzKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdm0uY2xlYXIgPSBmdW5jdGlvbihhcHBGb3JtKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkNsZWFyIHNlY3Rpb24gXCIpO1xuICAgICAgICAgICAgYXBwRm9ybS5wb051bWJlciA9IFwiXCI7XG4gICAgICAgICAgICBhcHBGb3JtLnBvSXRlbSA9IFwiXCI7XG4gICAgICAgICAgICBhcHBGb3JtLnBvVmFsdWUgPSBcIlwiO1xuICAgICAgICAgICAgYXBwRm9ybS5sY0R1cmF0aW9uID0gXCJcIjtcbiAgICAgICAgICAgIGFwcEZvcm0udG9sZXJhbmNlUGVyY2VudCA9IFwiXCI7XG4gICAgICAgICAgICBhcHBGb3JtLnVzYW5jZVBlcmlvZCA9IFwiXCI7XG4gICAgICAgICAgICBhcHBGb3JtLmluaXRpYXRvcklwZmNEb2NIYXNoID0gXCJcIjtcbiAgICAgICAgICAgIGFwcEZvcm0ucG9Jbml0RGF0ZSA9IFwiXCI7XG4gICAgICAgICAgICBhcHBGb3JtLm1lc3NhZ2UgPSBcIlwiO1xuICAgICAgICAgICAgYXBwRm9ybS5wb1F1YW50aXR5ID0gXCJcIjtcbiAgICAgICAgICAgICRzY29wZS5zdWJtaXREYXRhID0gXCJcIjtcbiAgICAgICAgICAgICRzY29wZS5jcmVhdGVMY1JlcXVlc3RGb3JtLnBvTnVtYmVyLiRzZXRWYWxpZGl0eShcInBvVW5pcXVlXCIsIHRydWUpO1xuICAgICAgICAgICAgJHNjb3BlLmNyZWF0ZUxjUmVxdWVzdEZvcm0uJHNldFByaXN0aW5lKCk7XG4gICAgICAgIH1cblxuICAgICAgICAkc2NvcGUudXBsb2FkRmlsZXMgPSBmdW5jdGlvbihmaWxlcykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJVcGxvYWRpbmcgLS0tLS0tLS0tLS0tLS0tLVwiKTtcbiAgICAgICAgICAgICRzY29wZS5hcHBGb3JtLmZpbGVzID0gZmlsZXM7XG4gICAgICAgICAgICAkc2NvcGUuYXBwRm9ybS5tZXNzYWdlID0gJHNjb3BlLmFwcEZvcm0uZmlsZXNbMF0ubmFtZSArIFwiIGZpbGUgc2VsZWN0ZWRcIjtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5zdWJtaXQgPSBmdW5jdGlvbihhcHBGb3JtKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhhcHBGb3JtKTtcbiAgICAgICAgICAgIHZhciBteWJvZHkgPSBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQpLmZpbmQoJ2JvZHknKTtcbiAgICAgICAgICAgIG15Ym9keS5hZGRDbGFzcygnd2FpdGluZycpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJUaGlzIGlzIGZvciBzdWJtaXQgaW4gY29udHJvbGxlclwiICsgYXBwRm9ybSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInBvTnVtYmVyPVwiICsgYXBwRm9ybS5wb051bWJlcik7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkN1cnJlbmN5ID09PT4gXCIgKyBhcHBGb3JtLnBvQ3VycmVuY3kpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJTZWxsZXIgaW4gY29udHJvbGxlciAtLS0tLS0tLS0tXCIrYXBwRm9ybS5zZWxsZXJJZCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRoaXMgaXMgZm9yIHN1Ym1pdCBpbiBjb250cm9sbGVyICAgIEZpbGVzICAgXCIgKyBhcHBGb3JtLmZpbGVzKTtcbiAgICAgICAgICAgIHZhciBmaWxlcyA9IGFwcEZvcm0uZmlsZXM7XG5cblxuICAgICAgICAgICAgdmFyIGZpbGVOYW1lID0gZmlsZXNbMF0ubmFtZTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiIENvbnRyb2xsZXIgbmFlbSAgICAgICBcIiArIGZpbGVOYW1lKTtcblxuICAgICAgICAgICAgaWYgKGZpbGVzICYmIGZpbGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIFVwbG9hZC51cGxvYWQoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvYXBwbGljYW50L3VwbG9hZCcsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzOiBmaWxlc1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5yZXN1bHQgPSByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJUaGUgcmVzcG9uc2UgZm9yIHVwbG9hZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hcHBGb3JtLmluaXRpYXRvcklwZmNEb2NIYXNoID0gcmVzcG9uc2UuZGF0YVswXS5oYXNoO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFwcEZvcm0uaW5pdGlhdGVyRmlsZU5hbWUgPSBmaWxlTmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hcHBGb3JtLnVzZXJEYXRlID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hcHBGb3JtLnBvQ3VycmVuY3kgPSBcIiRcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICRodHRwLnBvc3QoJy9hcHBsaWNhbnQvc3VibWl0LycsIGFwcEZvcm0sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICdCZWFyZXIgJyArIGF1dGhlbnRpY2F0aW9uLmdldFRva2VuKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJSRVNQT1NOU0VfX19fX19fX1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5jbGVhcigkc2NvcGUuYXBwRm9ybSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnN1Ym1pdERhdGEgPSByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15Ym9keS5yZW1vdmVDbGFzcygnd2FpdGluZycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15Ym9keS5yZW1vdmVDbGFzcygnd2FpdGluZycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLnN0YXR1cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yTXNnID0gcmVzcG9uc2Uuc3RhdHVzICsgJzogJyArIHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnByb2dyZXNzID1cbiAgICAgICAgICAgICAgICAgICAgICAgIE1hdGgubWluKDEwMCwgcGFyc2VJbnQoMTAwLjAgKiBldnQubG9hZGVkIC8gZXZ0LnRvdGFsKSk7XG4gICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJUSEUgTE9DQUwgU0FWRVwiKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gVXBsb2FkLnVwbG9hZCh7XG4gICAgICAgICAgICAgICAgICAgIC8vICAgdXJsOiAnL2FwcGxpY2FudC91cGxvYWRMb2NhbCcsXG4gICAgICAgICAgICAgICAgICAgIC8vICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICAvLyAgICAgICBmaWxlczogZmlsZXNcbiAgICAgICAgICAgICAgICAgICAgLy8gICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIH0pO1xuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0ucG9wdWxhdGVCZW5lZmlhcnkgPSBmdW5jdGlvbihzZWxsZXIpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcImluIHNlbGVjdGlvbiBcIitzZWxsZXIuX2lkKTtcblxuICAgICAgICAgICAgJHNjb3BlLmFwcEZvcm0uc2VsbGVySWQgPSBzZWxsZXIuX2lkO1xuICAgICAgICAgICAgJHNjb3BlLmFwcEZvcm0uc2VsbGVyTmFtZSA9IHNlbGxlci5uYW1lO1xuICAgICAgICAgICAgJHNjb3BlLmFwcEZvcm0uc2VsbGVyQWRkID0gc2VsbGVyLnNlbGxlckFkZDtcbiAgICAgICAgICAgICRzY29wZS5hcHBGb3JtLnNlbGxlckFjY051bWJlciA9IHNlbGxlci5zZWxsZXJBY2NOdW1iZXI7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gRnVuY3Rpb24gdG8gY2hlY2sgaWYgUE8gTnVtYmVyIGlzIHVuaXF1ZSBmb3IgYSBidXllcklkXG4gICAgICAgIHZtLnZhbGlkYXRlUG9OdW1iZXIgPSBmdW5jdGlvbihwb051bWJlcikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJ2YWxpZGF0aW5nIFBPIG51bWJlciBvbiBibHVyXCIpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJwb251bWJlciBpcyA6IFwiICsgcG9OdW1iZXIpO1xuICAgICAgICAgICAgdmFyIGJ1eWVySWQgPSBhdXRoZW50aWNhdGlvbi5jdXJyZW50VXNlcigpLnVzZXJJZDtcbiAgICAgICAgICAgIGlmIChwb051bWJlciAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAvLyBlbmNvZGluZyB3aGlsZSBzZW5kaW5nIGFzIGdldCBxdWVyeSBwYXJhbWV0ZXJcbiAgICAgICAgICAgICAgICBwb051bWJlciA9IGVuY29kZVVSSUNvbXBvbmVudChwb051bWJlcik7XG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBwbGljYW50L3ZhbGlkYXRlUG9OdW1iZXIvJyArIHBvTnVtYmVyICsgJy8nICsgYnV5ZXJJZCwge1xuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAnQmVhcmVyICcgKyBhdXRoZW50aWNhdGlvbi5nZXRUb2tlbigpXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgcG9OdW1iZXIgaXMgdW5pcXVlXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNyZWF0ZUxjUmVxdWVzdEZvcm0ucG9OdW1iZXIuJHNldFZhbGlkaXR5KFwicG9VbmlxdWVcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgcG9OdW1iZXIgYWxyZWFkeSBleGlzdHMgaW4gREJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVyci5kYXRhLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNyZWF0ZUxjUmVxdWVzdEZvcm0ucG9OdW1iZXIuJHNldFZhbGlkaXR5KFwicG9VbmlxdWVcIiwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHZtLnJlbW92ZVVuaXF1ZU1zZyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHNjb3BlLmNyZWF0ZUxjUmVxdWVzdEZvcm0ucG9OdW1iZXIuJHNldFZhbGlkaXR5KFwicG9VbmlxdWVcIiwgdHJ1ZSk7XG4gICAgICAgIH1cblxuXG5cblxuICAgIH1cbn0pKCk7XG4iLCIvKipcbiAgKiBAYXV0aG9yIHN1a29obGlAZGVsb2l0dGUuY29tXG4gICogL2JlbmVmaWNpYXJ5L2hvbWUgLT4gY29udHJvbGxlclxuICAqIFRoaXMgY29udHJvbGxlciBoYW5kbGVzIFNoYXJlIExvZGdlbWVudFxuKi9cbihmdW5jdGlvbigpIHtcbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ215QXBwJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ2JlbmVmaWNpYXJ5Q3RybCcsIGJlbmVmaWNpYXJ5Q3RybCk7XG5cbiAgICBiZW5lZmljaWFyeUN0cmwuJGluamVjdCA9IFsnJHN0YXRlJywnYXBpQ2FsbCcsJ2F1dGhlbnRpY2F0aW9uJywgJyRzY29wZScsICckaHR0cCcsICdVcGxvYWQnLCAnJHRpbWVvdXQnLCckc3RhdGVQYXJhbXMnXTtcblxuICAgIGZ1bmN0aW9uIGJlbmVmaWNpYXJ5Q3RybCgkc3RhdGUsIGFwaUNhbGwsIGF1dGhlbnRpY2F0aW9uLCAkc2NvcGUsICRodHRwLCBVcGxvYWQsICR0aW1lb3V0LCAkc3RhdGVQYXJhbXMpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgdm0uc2hvd0FjY29yZGlvbiA9IGZhbHNlO1xuICAgICAgICAvLyBQcmVwb3B1bGF0ZSBMQyBOdW1iZXIgZHJvcGRvd25cbiAgICAgICAgdm0uaW5pdCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJQcmVwb3B1bGF0ZSBpbml0IGZ1bmN0aW9uIGNhbGxlZCAhIVwiKTtcbiAgICAgICAgICAvLyBnZXQgTEMgbnVtYmVycyBmcm9tIG1vbmdvXG4gICAgICAgICAgJGh0dHAuZ2V0KCcvYmVuZWZpY2lhcnkvZ2V0TGNOdW1iZXJzLycsIHtcbiAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogJ0JlYXJlciAnICsgYXV0aGVudGljYXRpb24uZ2V0VG9rZW4oKVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICAgICAudGhlbiggZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJSZXNwb25zZSBMYyBOdW1iZXJzXCIpOyAgICAgICAgICAgIFxuICAgICAgICAgICAgdm0ubG9kZ2VtZW50RGV0YWlscyA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmdW5jdGlvbihlcnIpe1xuICAgICAgICAgICAgdmFyIHVzZXIgPSBhdXRoZW50aWNhdGlvbi5jdXJyZW50VXNlcigpO1xuICAgICBcdFx0XHQgICBpZih1c2VyLnJvbGUhPTQwMCkge1xuICAgICBcdFx0XHRcdCAgICRzY29wZS5lcnJvck1zZyA9IFwiTm90IHRoZSBjb3JyZWN0IHJvbGVcIjtcbiAgICAgXHRcdFx0XHQgICAkc3RhdGUuZ28oJ2hvbWUnKTtcbiAgICAgXHRcdFx0ICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgICAgLnRoZW4oIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBpZiggJHN0YXRlUGFyYW1zLmFjdGlvbkl0ZW0gIT0gXCJcIiAmJiAkc3RhdGVQYXJhbXMuYWN0aW9uSXRlbSAhPSBudWxsICl7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiYWN0aW9uIGl0ZW0gbm90IG51bGxcIik7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCRzdGF0ZVBhcmFtcy5hY3Rpb25JdGVtKTtcblxuICAgICAgICAgICAgICBjb25zb2xlLmxvZyh2bS5sb2RnZW1lbnREZXRhaWxzKTtcbiAgICAgICAgICAgIHZhciBzZWxlY3RlZExjTnVtYmVyID0gdm0ubG9kZ2VtZW50RGV0YWlscy5maWx0ZXIoZnVuY3Rpb24oIGRhdGFPYmogKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoZGF0YU9iai5sY051bWJlciA9PSAkc3RhdGVQYXJhbXMuYWN0aW9uSXRlbSApIDtcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coc2VsZWN0ZWRMY051bWJlclswXSk7XG4gICAgICAgICAgICB2bS5zaGFyZUxvZGdlbWVudCA9IHNlbGVjdGVkTGNOdW1iZXJbMF07XG4gICAgICAgICAgICB2bS5zaG93QWNjb3JkaW9uID0gdHJ1ZTtcbiAgICAgICAgICAgICRzdGF0ZVBhcmFtcy5hY3Rpb25JdGVtID0gXCJcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIC8vIGdldCBQcmVzZW50aW5nIEJhbmsgRGV0YWlsc1xuICAgICAgICAgICRodHRwLmdldCgnL2JlbmVmaWNpYXJ5L2dldFByZXNlbnRpbmdCYW5rJyx7XG4gICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogJ0JlYXJlciAnICsgYXV0aGVudGljYXRpb24uZ2V0VG9rZW4oKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgICAgLnRoZW4oIGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiUmVzcG9uc2UgUHJlc2VudGluZyBCYW5rXCIpO1xuICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YSk7XG4gICAgICAgICAgICB2bS5wcmVzZW50aW5nQmFuayA9IHJlc3BvbnNlLmRhdGFbMF07XG4gICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKXtcbiAgICAgICAgICAgIHZhciB1c2VyID0gYXV0aGVudGljYXRpb24uY3VycmVudFVzZXIoKTtcbiAgICAgXHRcdFx0ICAgaWYodXNlci5yb2xlIT00MDApIHtcbiAgICAgXHRcdFx0XHQgICAkc2NvcGUuZXJyb3JNc2cgPSBcIk5vdCB0aGUgY29ycmVjdCByb2xlXCI7XG4gICAgIFx0XHRcdFx0ICAgJHN0YXRlLmdvKCdob21lJyk7XG4gICAgIFx0XHRcdCAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLmNsZWFyID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICB2bS5zaG93QWNjb3JkaW9uID0gZmFsc2U7XG4gICAgICAgICAgdm0uc2hhcmVMb2RnZW1lbnQgPSBcIlwiO1xuICAgICAgICAgIHZtLmludm9pY2VGaWxlPVwiXCI7XG4gICAgICAgICAgdm0uaW52b2ljZUZpbGVBcnJheT1cIlwiO1xuICAgICAgICAgIHZtLmxvZGdlbWVudEZpbGVzPVwiXCI7XG4gICAgICAgICAgdm0uc3VibWl0TWVzc2FnZT1cIlwiO1xuICAgICAgICAgIHZtLmNyZWF0ZUxvZGdlbWVudEZvcm0uJHNldFByaXN0aW5lKCk7XG4gICAgICAgICAgdm0uY3JlYXRlTG9kZ2VtZW50Rm9ybS5iaWxsTnVtYmVyLiRzZXRWYWxpZGl0eShcImJpbGxOdW1iZXJVbmlxdWVcIix0cnVlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLmZldGNoRGV0YWlsID0gZnVuY3Rpb24oc2VsZWN0ZWRMYyl7XG4gICAgICAgICAgY29uc29sZS5sb2coXCIgZmV0Y2ggZGV0YWlscyBmdW5jdGlvblwiKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhzZWxlY3RlZExjKTtcbiAgICAgICAgICB2bS5zaG93QWNjb3JkaW9uID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZ1bmN0aW9uIHRvIGNoZWNrIGlmIEJpbGwgTnVtYmVyIGlzIHVuaXF1ZSBmb3IgYSBiZW5lZmljaWFyeVxuICAgICAgICB2bS52YWxpZGF0ZUJpbGxOdW1iZXIgPSBmdW5jdGlvbihiaWxsTnVtYmVyKXtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcInZhbGlkYXRpbmcgYmlsbE51bWJlciBvbiBibHVyXCIpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiYmlsbE51bWJlciBpcyA6IFwiICsgYmlsbE51bWJlcik7XG4gICAgICAgICAgLy8gZW5jb2Rpbmcgd2hpbGUgc2VuZGluZyBhcyBnZXQgcXVlcnkgcGFyYW1ldGVyXG4gICAgICAgICAgYmlsbE51bWJlciA9IGVuY29kZVVSSUNvbXBvbmVudChiaWxsTnVtYmVyKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIkVuY29kaW5nIGJpbGxOdW1iZXIgaXMgOiBcIiArIGJpbGxOdW1iZXIpO1xuICAgICAgICAgIHZhciBzZWxsZXJJZCA9IGF1dGhlbnRpY2F0aW9uLmN1cnJlbnRVc2VyKCkudXNlcklkO1xuICAgICAgICAgIGlmKCBiaWxsTnVtYmVyICE9IHVuZGVmaW5lZCAmJiBiaWxsTnVtYmVyICE9ICd1bmRlZmluZWQnKXtcbiAgICAgICAgICAgICRodHRwLmdldCgnL2JlbmVmaWNpYXJ5L3ZhbGlkYXRlQmlsbE51bWJlci8nICsgYmlsbE51bWJlciArICcvJyArIHNlbGxlcklkLCB7XG4gICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAnQmVhcmVyICcgKyBhdXRoZW50aWNhdGlvbi5nZXRUb2tlbigpXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAvLyBpZiBiaWxsTnVtYmVyIGlzIHVuaXF1ZVxuICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEubWVzc2FnZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgICAgICAgLy8gaWYgYmlsbE51bWJlciBhbHJlYWR5IGV4aXN0cyBpbiBEQlxuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyLmRhdGEubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICB2bS5jcmVhdGVMb2RnZW1lbnRGb3JtLmJpbGxOdW1iZXIuJHNldFZhbGlkaXR5KFwiYmlsbE51bWJlclVuaXF1ZVwiLGZhbHNlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHZtLnJlbW92ZVVuaXF1ZU1zZyA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgdm0uY3JlYXRlTG9kZ2VtZW50Rm9ybS5iaWxsTnVtYmVyLiRzZXRWYWxpZGl0eShcImJpbGxOdW1iZXJVbmlxdWVcIix0cnVlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLnNlbGVjdEZpbGVzID0gZnVuY3Rpb24oZmlsZXMpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVXBsb2FkaW5nIC0tLS0tLS0tLS0tLS0tLS1cIik7XG4gICAgICAgICAgICB2bS5sb2RnZW1lbnRGaWxlcyA9IGZpbGVzO1xuICAgICAgICAgICAgY29uc29sZS5sb2codm0ubG9kZ2VtZW50RmlsZXMpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnNlbGVjdEludm9pY2UgPSBmdW5jdGlvbihmaWxlKXtcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhmaWxlKTtcbiAgICAgICAgICBpZiggZmlsZS5sZW5ndGggPiAxKXtcbiAgICAgICAgICAgIC8vIHJlbW92ZSBleHRyYSBmaWxlXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlJlbW92ZSBleHRyYSBmaWxlXCIpO1xuICAgICAgICAgICAgZmlsZS5zaGlmdCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zb2xlLmxvZyhcIlVwbG9hZGluZyBJbnZvaWNlLS0tLS0tLS0tLS0tLS0tLVwiKTtcbiAgICAgICAgICB2bS5pbnZvaWNlRmlsZSA9IGZpbGVbMF07XG4gICAgICAgICAgdm0uaW52b2ljZUZpbGVBcnJheSA9IGZpbGU7XG4gICAgICAgICAgY29uc29sZS5sb2codm0uaW52b2ljZUZpbGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgdm0ucmVtb3ZlQXR0YWNoZW1lbnQgPSBmdW5jdGlvbihpbmRleCx0eXBlT2ZGaWxlKXtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcInR5cGUgb2YgZmlsZSBpczogXCIgKyB0eXBlT2ZGaWxlKTtcbiAgICAgICAgICBpZiggdHlwZU9mRmlsZSA9PT0gXCJvdGhlcnNcIil7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInNlbnQgaW5kZXggaXMgOiBcIiArIGluZGV4KTtcbiAgICAgICAgICAgIHZtLmxvZGdlbWVudEZpbGVzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKCB0eXBlT2ZGaWxlID09PSBcImludm9pY2VcIil7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInNlbnQgaW5kZXggaXMgOiBcIiArIGluZGV4KTtcbiAgICAgICAgICAgIHZtLmludm9pY2VGaWxlPVwiXCI7XG4gICAgICAgICAgICB2bS5pbnZvaWNlRmlsZUFycmF5LnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdm0uc3VibWl0ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIlN1Ym1pdCBmdW5jdGlvbiBjYWxsZWQhXCIpO1xuICAgICAgICAgIHZhciBteWJvZHkgPSBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQpLmZpbmQoJ2JvZHknKTtcbiAgICAgICAgICBteWJvZHkuYWRkQ2xhc3MoJ3dhaXRpbmcnKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyh2bS5zaGFyZUxvZGdlbWVudCk7XG4gICAgICAgICAgdmFyIGxvZGdlbWVudFJlcXVlc3QgPSB7XG4gICAgICAgICAgICBcImNvbnRyYWN0SURcIjogdm0uc2hhcmVMb2RnZW1lbnQuX2lkLFxuICAgICAgICAgICAgXCJiaWxsTnVtYmVyXCI6IHZtLnNoYXJlTG9kZ2VtZW50LmJpbGxOdW1iZXIsXG4gICAgICAgICAgICBcImJpbGxRdWFudGl0eVwiOiB2bS5zaGFyZUxvZGdlbWVudC5iaWxsUXVhbnRpdHksXG4gICAgICAgICAgICBcImJpbGxBbW91bnRcIjogdm0uc2hhcmVMb2RnZW1lbnQuYmlsbEFtb3VudCxcbiAgICAgICAgICAgIFwiYmlsbExhZGluZ1wiOnZtLnNoYXJlTG9kZ2VtZW50LmJpbGxMYWRpbmcsXG4gICAgICAgICAgICBcInByZXNlbnRpbmdCYW5rSWRcIjp2bS5wcmVzZW50aW5nQmFuay5faWRcbiAgICAgICAgICB9O1xuICAgICAgICAgIGNvbnNvbGUubG9nKGxvZGdlbWVudFJlcXVlc3QpO1xuICAgICAgICAgIC8vIGZpbGVzIGlzIGEgbmV3IGFycmF5LCBjb3B5IG9mIGxvZGdlbWVudEZpbGVzXG4gICAgICAgICAgdmFyIGZpbGVzID0gdm0ubG9kZ2VtZW50RmlsZXMuc2xpY2UoKTtcbiAgICAgICAgICB2YXIgaW52b2ljZUZpbGUgPSB2bS5pbnZvaWNlRmlsZTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcImxvZGdlbWVudEZpbGVzIGFyZTogXCIpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKGZpbGVzKTtcbiAgICAgICAgICBpZiAoZmlsZXMgJiYgZmlsZXMubGVuZ3RoICYmIGludm9pY2VGaWxlKSB7XG4gICAgICAgICAgICAgIC8vIGRpc2FibGluZyBzdWJtaXQgYnV0dG9uXG4gICAgICAgICAgICAgIHZtLmNsZWFyKCk7XG4gICAgICAgICAgICAgIHZtLnN1Ym1pdE1lc3NhZ2UgID0gXCJMb2RnZW1lbnQgQ3JlYXRpb24gQW5kIEZpbGUgVXBsb2FkIEluIFByb2dyZXNzLCBQbGVhc2UgV2FpdC5cIjtcbiAgICAgICAgICAgICAgLy8gYXBwZW5kcyB0byBzdGFydCBvZiBhcnJheVxuICAgICAgICAgICAgICBmaWxlcy51bnNoaWZ0KGludm9pY2VGaWxlKTtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coZmlsZXMpO1xuICAgICAgICAgICAgICBVcGxvYWQudXBsb2FkKHtcbiAgICAgICAgICAgICAgICAgIHVybDogJy9iZW5lZmljaWFyeS91cGxvYWQnLFxuICAgICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICAgIGZpbGVzOiBmaWxlc1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRoZSByZXNwb25zZSBmb3IgbG9kZ2VtZW50RmlsZXMgdXBsb2FkXCIpO1xuICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICB2YXIgbG9kZ2VtZW50RG9jdW1lbnRzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgZm9yKCB2YXIgaT0wOyBpPHJlc3BvbnNlLmRhdGEubGVuZ3RoOyBpKyspe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoIGkgPT0gMCApe1xuICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGVtcERvYyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImlwZnNEb2NIYXNoXCIgOiByZXNwb25zZS5kYXRhW2ldLmhhc2gsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJmaWxlTmFtZVwiIDogcmVzcG9uc2UuZGF0YVtpXS5maWxlTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImZpbGVUeXBlXCIgOiBcImludm9pY2VcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNle1xuICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGVtcERvYyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImlwZnNEb2NIYXNoXCIgOiByZXNwb25zZS5kYXRhW2ldLmhhc2gsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJmaWxlTmFtZVwiIDogcmVzcG9uc2UuZGF0YVtpXS5maWxlTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImZpbGVUeXBlXCIgOiBcIm90aGVyc1wiXG4gICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZGdlbWVudERvY3VtZW50cy5wdXNoKHRlbXBEb2MpO1xuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhsb2RnZW1lbnREb2N1bWVudHMpO1xuICAgICAgICAgICAgICAgICAgICAgIGxvZGdlbWVudFJlcXVlc3RbXCJsb2RnZW1lbnREb2N1bWVudHNcIl0gPSBsb2RnZW1lbnREb2N1bWVudHM7XG4gICAgICAgICAgICAgICAgICAgICAgJGh0dHAucG9zdCgnL2JlbmVmaWNpYXJ5L3NhdmVMb2RnZW1lbnRGb3JtLycsIGxvZGdlbWVudFJlcXVlc3QsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogJ0JlYXJlciAnICsgYXV0aGVudGljYXRpb24uZ2V0VG9rZW4oKVxuICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlJFU1BPTlNFIEZyb20gc2F2ZSBsb2RnZW1lbnRGb3JtIVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gJHNjb3BlLnN1Ym1pdERhdGEgPSByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uaW5pdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5jbGVhcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICBteWJvZHkucmVtb3ZlQ2xhc3MoJ3dhaXRpbmcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uc3VibWl0TWVzc2FnZSA9IHJlc3BvbnNlLmRhdGEubWVzc2FnZTtcbiAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcblx0XHRcdFx0ICAgICAgICAgICAgICAgICAgbXlib2R5LnJlbW92ZUNsYXNzKCd3YWl0aW5nJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVyci5zdGF0dXMpO1xuICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xuXG4gICAgICAgICAgICAgICAgICBpZiAoZXJyLnN0YXR1cyA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JNc2cgPSBlcnIuc3RhdHVzICsgJzogJyArIGVyci5kYXRhO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9LCBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgICAgICAgICAgICRzY29wZS5wcm9ncmVzcyA9XG4gICAgICAgICAgICAgICAgICAgICAgTWF0aC5taW4oMTAwLCBwYXJzZUludCgxMDAuMCAqIGV2dC5sb2FkZWQgLyBldnQudG90YWwpKTtcbiAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVEhFIExPQ0FMIFNBVkVcIik7XG4gICAgICAgICAgICAgICAgLy8gVXBsb2FkLnVwbG9hZCh7XG4gICAgICAgICAgICAgICAgLy8gICB1cmw6ICcvYmVuZWZpY2lhcnkvdXBsb2FkTG9jYWwnLFxuICAgICAgICAgICAgICAgIC8vICAgZGF0YToge1xuICAgICAgICAgICAgICAgIC8vICAgICAgIGZpbGVzOiBmaWxlc1xuICAgICAgICAgICAgICAgIC8vICAgfVxuICAgICAgICAgICAgICAgIC8vIH0pO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZXtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRmlsZXMgTm90IFVwbG9hZGVkIFByb3Blcmx5XCIpO1xuICAgICAgICAgICAgLy8gZGlzYWJsaW5nIHN1Ym1pdCBidXR0b25cbiAgICAgICAgICAgIHZtLmNsZWFyKCk7XG4gICAgICAgICAgICB2bS5zdWJtaXRNZXNzYWdlICA9IFwiLS0tIEZpbGVzIE5vdCBVcGxvYWRlZCBQcm9wZXJseSwgUGxlYXNlIFRyeSBBZ2FpbiAtLS1cIjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB2bS5pbml0KCk7XG4gICAgfTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnbXlBcHAnKVxyXG5cclxuICAgICAgICAuY29udHJvbGxlcignYWRkcmVzc0luZm9zQ3RybCcsIGFkZHJlc3NJbmZvc0N0cmwpO1xyXG5cclxuXHJcbiAgICBhZGRyZXNzSW5mb3NDdHJsLiRpbmplY3QgPSBbJyRyb290U2NvcGUnLCAnJHNjb3BlJywgJyRsb2NhdGlvbicsICckc3RhdGVQYXJhbXMnLCAnJHEnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBhZGRyZXNzSW5mb3NDdHJsKCRyb290U2NvcGUsICRzY29wZSwgJGxvY2F0aW9uLCAkcm91dGVQYXJhbXMsICRxKSB7XHJcbiAgICAgICAgdmFyIHdlYjMgPSAkcm9vdFNjb3BlLndlYjM7XHJcbiAgICAgICAgJHNjb3BlLmluaXQgPSBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5hZGRyZXNzSWQgPSAkcm91dGVQYXJhbXMuYWRkcmVzc0lkO1xyXG4gICAgICAgICAgICB2YXIgYWRkcmVzc0lkID0gJHJvdXRlUGFyYW1zLmFkZHJlc3NJZDtcclxuXHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuYWRkcmVzc0lkICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGdldEFkZHJlc3NCYWxhbmNlKClcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmJhbGFuY2UgPSB3ZWIzLmZyb21XZWkocmVzdWx0KS50b051bWJlcigpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgZ2V0QWRkcmVzc1RyYW5zYWN0aW9uQ291bnQoKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudHhDb3VudCA9IHJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGdldENvZGUoKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY29kZSA9IHJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGdldFRyYW5zYWN0aW9ucygpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZ2V0VHJhbnNhY3Rpb25zIGlzIGV4ZWN1dGVkIVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50cmFuc2FjdGlvbnMgPSByZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBnZXRFVEhVU0QoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKFwiL1wiKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0QWRkcmVzc0JhbGFuY2UoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgd2ViMy5ldGguZ2V0QmFsYW5jZSgkc2NvcGUuYWRkcmVzc0lkLCBmdW5jdGlvbihlcnJvciwgcmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRFVEhVU0QoKSB7XHJcbiAgICAgICAgICAgICAgICAkLmdldEpTT04oXCJodHRwczovL2NvaW5tYXJrZXRjYXAtbmV4dWlzdC5yaGNsb3VkLmNvbS9hcGkvZXRoL3ByaWNlXCIsIGZ1bmN0aW9uKGpzb24pIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcHJpY2UgPSBqc29uLnVzZDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZXRodXNkID0gcHJpY2UudG9GaXhlZCgyKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYmFsYW5jZXVzZCA9IFwiJFwiICsgZXRodXNkICogJHNjb3BlLmJhbGFuY2U7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmJhbGFuY2V1c2QgPSBiYWxhbmNldXNkO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coXCJCYWxhbmNlIGluIFVTRCBcIiArICRzY29wZS5iYWxhbmNldXNkKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRBZGRyZXNzVHJhbnNhY3Rpb25Db3VudCgpIHtcclxuICAgICAgICAgICAgICAgIC8vIHZhciBzdWNjZXNzPSQuZ2V0U2NyaXB0KCcuLi8uLi9jb25maWcuanMnKTtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAgICB3ZWIzLmV0aC5nZXRUcmFuc2FjdGlvbkNvdW50KCRzY29wZS5hZGRyZXNzSWQsIGZ1bmN0aW9uKGVycm9yLCByZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldENvZGUoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgd2ViMy5ldGguZ2V0Q29kZSgkc2NvcGUuYWRkcmVzc0lkLCBmdW5jdGlvbihlcnJvciwgcmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBUT0RPOiBub3Qgd29ya2luZyB5ZXQ6XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldFRyYW5zYWN0aW9ucygpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLypcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL2dvLWV0aGVyZXVtL2lzc3Vlcy8xODk3I2lzc3VlY29tbWVudC0xNjYzNTE3OTdcclxuICAgICAgICAgICAgICAgIC8vIHBsdXMgdGhlIGZvbGxvd2luZyBwb3N0c1xyXG4gICAgICAgICAgICAgICAgLy8gR2l2aW5nIHVwIGZvciBub3cuIEludmVzdGVkIGFub3RoZXIgMyBob3VycyB3aXRob3V0IHJlc3VsdHMuIEdycnJyLi5cclxuXHJcbiAgICAgICAgICAgICAgICAvLyB2YXIgb3B0aW9ucz1cImFkZHJlc3M6XCIrJHNjb3BlLmFkZHJlc3NJZDtcclxuICAgICAgICAgICAgICAgIC8vIHZhciBvcHRpb25zID0ge1wiYWRkcmVzc1wiOiBcIjB4ZjJjYzBlZWFhYWVkMzEzNTQyY2IyNjJiMGI4YzM5NzI0MjUxNDNmMFwifTsgLy8gJHNjb3BlLmFkZHJlc3NJZH07IC8vICwgXCJ0b3BpY3NcIjogW251bGxdXHJcbiAgICAgICAgICAgICAgICAvLyB2YXIgb3B0aW9ucyA9ICdwZW5kaW5nJ1xyXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2cob3B0aW9ucyk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB7ZnJvbUJsb2NrOiAwLCB0b0Jsb2NrOiAnbGF0ZXN0JywgYWRkcmVzczogXCIweGYyY2MwZWVhYWFlZDMxMzU0MmNiMjYyYjBiOGMzOTcyNDI1MTQzZjBcIn07XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIG15ZmlsdGVyID0gd2ViMy5ldGguZmlsdGVyKG9wdGlvbnMpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHZhciBteWZpbHRlcj0gd2ViMy5ldGguZmlsdGVyKG9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cobXlmaWx0ZXIpO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBteWZpbHRlci5nZXQoZnVuY3Rpb24gKGVycm9yLCBsb2cpIHtcclxuICAgICAgICAgICAgICAgIFx0ICBjb25zb2xlLmxvZyhcImdldCBlcnJvcjpcIiwgZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgXHQgIGNvbnNvbGUubG9nKFwiZ2V0IGxvZzpcIiwgbG9nKTtcclxuICAgICAgICAgICAgICAgIFx0fSk7XHJcblxyXG4gICAgICAgICAgICAgICAgd2ViMy5ldGguZmlsdGVyKG9wdGlvbnMsXHJcbiAgICAgICAgICAgICAgICBcdFx0ZnVuY3Rpb24oZXJyb3IsIHJlc3VsdCl7XHJcbiAgICAgICAgICAgICAgICBcdFx0XHRpZighZXJyb3Ipe1xyXG4gICAgICAgICAgICAgICAgXHRcdFx0XHRjb25zb2xlLmxvZyhcIm5vIGVycm9yXCIpO1xyXG4gICAgICAgICAgICAgICAgXHRcdFx0XHRkZWZlcnJlZC5yZXNvbHZlKHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICBcdFx0XHRcdH1cclxuICAgICAgICAgICAgICAgIFx0XHRcdGVsc2V7XHJcbiAgICAgICAgICAgICAgICBcdFx0XHRcdGNvbnNvbGUubG9nKFwiZXJyb3JcIik7XHJcbiAgICAgICAgICAgICAgICBcdFx0XHRcdGRlZmVycmVkLnJlamVjdChlcnJvcik7XHJcbiAgICAgICAgICAgICAgICBcdFx0XHRcdH1cclxuICAgICAgICAgICAgICAgIFx0XHRcdH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS5pbml0KCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGhleDJhKGhleHgpIHtcclxuICAgICAgICAgICAgdmFyIGhleCA9IGhleHgudG9TdHJpbmcoKTsgLy9mb3JjZSBjb252ZXJzaW9uXHJcbiAgICAgICAgICAgIHZhciBzdHIgPSAnJztcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoZXgubGVuZ3RoOyBpICs9IDIpXHJcbiAgICAgICAgICAgICAgICBzdHIgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShwYXJzZUludChoZXguc3Vic3RyKGksIDIpLCAxNikpO1xyXG4gICAgICAgICAgICByZXR1cm4gc3RyO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbigpIHtcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdteUFwcCcpXHJcblxyXG4gICAgICAgIC5jb250cm9sbGVyKCdibG9ja0luZm9zQ3RybCcsIGJsb2NrSW5mb3NDdHJsKTtcclxuXHJcblxyXG4gICAgYmxvY2tJbmZvc0N0cmwuJGluamVjdCA9IFsnJHJvb3RTY29wZScsICckc2NvcGUnLCAnJGxvY2F0aW9uJywgJyRzdGF0ZVBhcmFtcycsICckcSddO1xyXG5cclxuXHJcbiAgICBmdW5jdGlvbiBibG9ja0luZm9zQ3RybCgkcm9vdFNjb3BlLCAkc2NvcGUsICRsb2NhdGlvbiwgJHN0YXRlUGFyYW1zLCAkcSkge1xyXG4gICAgICAgIHZhciB3ZWIzID0gJHJvb3RTY29wZS53ZWIzO1xyXG4gICAgICAgIHZhciBCaWdOdW1iZXIgPSByZXF1aXJlKCdiaWdudW1iZXIuanMnKTtcclxuICAgICAgICAkc2NvcGUuaW5pdCA9IGZ1bmN0aW9uKCkge1xyXG5cclxuXHJcbiAgICAgICAgICAgICRzY29wZS5ibG9ja0lkID0gJHN0YXRlUGFyYW1zLmJsb2NrSWQ7XHJcblxyXG5cclxuICAgICAgICAgICAgaWYgKCRzY29wZS5ibG9ja0lkICE9PSB1bmRlZmluZWQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBnZXRCbG9ja0luZm9zKClcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG51bWJlciA9IHdlYjMuZXRoLmJsb2NrTnVtYmVyO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlc3VsdCA9IHJlc3VsdDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5udW1iZXJPZlVuY2xlcyA9IHJlc3VsdC51bmNsZXMubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiAoJHNjb3BlLm51bWJlck9mVW5jbGVzIT0wKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vXHR1bmNsZTE9cmVzdWx0LnVuY2xlc1swXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9cdGNvbnNvbGUubG9nKHdlYjMuZXRoLmdldFVuY2xlKHVuY2xlMSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL31cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuaGFzaCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaGFzaCA9IHJlc3VsdC5oYXNoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmhhc2ggPSAncGVuZGluZyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5taW5lciAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWluZXIgPSByZXN1bHQubWluZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWluZXIgPSAncGVuZGluZyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmdhc0xpbWl0ID0gcmVzdWx0Lmdhc0xpbWl0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZ2FzVXNlZCA9IHJlc3VsdC5nYXNVc2VkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubm9uY2UgPSByZXN1bHQubm9uY2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkaWZmID0gKFwiXCIgKyByZXN1bHQuZGlmZmljdWx0eSkucmVwbGFjZSgvWydcIl0rL2csICcnKSAvIDEwMDAwMDAwMDAwMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5kaWZmaWN1bHR5ID0gZGlmZi50b0ZpeGVkKDMpICsgXCIgVFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZ2FzTGltaXQgPSBuZXcgQmlnTnVtYmVyKHJlc3VsdC5nYXNMaW1pdCkudG9Gb3JtYXQoMCkgKyBcIiBtL3NcIjsgLy8gdGhhdCdzIGEgc3RyaW5nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5nYXNVc2VkID0gbmV3IEJpZ051bWJlcihyZXN1bHQuZ2FzVXNlZCkudG9Gb3JtYXQoMCkgKyBcIiBtL3NcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm5vbmNlID0gcmVzdWx0Lm5vbmNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubnVtYmVyID0gcmVzdWx0Lm51bWJlcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnBhcmVudEhhc2ggPSByZXN1bHQucGFyZW50SGFzaDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnVuY2xlZGF0YSA9IHJlc3VsdC5zaGEzVW5jbGVzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucm9vdEhhc2ggPSByZXN1bHQuc3RhdGVSb290O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYmxvY2tOdW1iZXIgPSByZXN1bHQubnVtYmVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudGltZXN0YW1wID0gbmV3IERhdGUocmVzdWx0LnRpbWVzdGFtcCAqIDEwMDApLnRvVVRDU3RyaW5nKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5leHRyYURhdGEgPSByZXN1bHQuZXh0cmFEYXRhLnNsaWNlKDIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YUZyb21IZXggPSBoZXgyYShyZXN1bHQuZXh0cmFEYXRhLnNsaWNlKDIpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNpemUgPSByZXN1bHQuc2l6ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmZpcnN0QmxvY2sgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmxhc3RCbG9jayA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmJsb2NrTnVtYmVyICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5jb25mID0gbnVtYmVyIC0gJHNjb3BlLmJsb2NrTnVtYmVyICsgXCIgQ29uZmlybWF0aW9uc1wiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bWJlciA9PT0gJHNjb3BlLmJsb2NrTnVtYmVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNvbmYgPSAnVW5jb25maXJtZWQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5sYXN0QmxvY2sgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5ibG9ja051bWJlciA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5maXJzdEJsb2NrID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5ibG9ja051bWJlciAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5mbyA9IHdlYjMuZXRoLmdldEJsb2NrKCRzY29wZS5ibG9ja051bWJlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5mbyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0RhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld0RhdGUuc2V0VGltZShpbmZvLnRpbWVzdGFtcCAqIDEwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50aW1lID0gbmV3RGF0ZS50b1VUQ1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvXCIpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0QmxvY2tJbmZvcygpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgd2ViMy5ldGguZ2V0QmxvY2soJHNjb3BlLmJsb2NrSWQsIGZ1bmN0aW9uKGVycm9yLCByZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS5pbml0KCk7XHJcblxyXG4gICAgICAgIC8vIHBhcnNlIHRyYW5zYWN0aW9uc1xyXG4gICAgICAgICRzY29wZS50cmFuc2FjdGlvbnMgPSBbXVxyXG5cclxuICAgICAgICB3ZWIzLmV0aC5nZXRCbG9ja1RyYW5zYWN0aW9uQ291bnQoJHNjb3BlLmJsb2NrSWQsIGZ1bmN0aW9uKGVycm9yLCByZXN1bHQpIHtcclxuICAgICAgICAgICAgdmFyIHR4Q291bnQgPSByZXN1bHQ7XHJcbiAgICAgICAgICAgICRzY29wZS5udW1iZXJPZlRyYW5zYWN0aW9ucyA9IHR4Q291bnQ7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGJsb2NrSWR4ID0gMDsgYmxvY2tJZHggPCB0eENvdW50OyBibG9ja0lkeCsrKSB7XHJcbiAgICAgICAgICAgICAgICB3ZWIzLmV0aC5nZXRUcmFuc2FjdGlvbkZyb21CbG9jaygkc2NvcGUuYmxvY2tJZCwgYmxvY2tJZHgsIGZ1bmN0aW9uKGVycm9yLCByZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIlJlc3VsdDogXCIsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgd2ViMy5ldGguZ2V0VHJhbnNhY3Rpb25SZWNlaXB0KHJlc3VsdC5oYXNoLCBmdW5jdGlvbihlcnJvciwgcmVjZWlwdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNhY3Rpb24gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogcmVjZWlwdC50cmFuc2FjdGlvbkhhc2gsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNoOiByZWNlaXB0LnRyYW5zYWN0aW9uSGFzaCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb206IHJlY2VpcHQuZnJvbSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvOiByZWNlaXB0LnRvLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FzOiByZWNlaXB0Lmdhc1VzZWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dDogcmVzdWx0LmlucHV0LnNsaWNlKDIpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHdlYjMuZnJvbVdlaShyZXN1bHQudmFsdWUsIFwiZXRoZXJcIiksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250cmFjdEFkZHJlc3M6IHJlY2VpcHQuY29udHJhY3RBZGRyZXNzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50cmFuc2FjdGlvbnMucHVzaCh0cmFuc2FjdGlvbilcclxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaGV4MmEoaGV4eCkge1xyXG4gICAgICAgICAgICB2YXIgaGV4ID0gaGV4eC50b1N0cmluZygpOyAvL2ZvcmNlIGNvbnZlcnNpb25cclxuICAgICAgICAgICAgdmFyIHN0ciA9ICcnO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhleC5sZW5ndGg7IGkgKz0gMilcclxuICAgICAgICAgICAgICAgIHN0ciArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHBhcnNlSW50KGhleC5zdWJzdHIoaSwgMiksIDE2KSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gc3RyO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uKCkge1xyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ215QXBwJylcclxuXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ2NoYWluSW5mb3NDdHJsJywgY2hhaW5JbmZvc0N0cmwpO1xyXG5cclxuICAgIGNoYWluSW5mb3NDdHJsLiRpbmplY3QgPSBbJyRyb290U2NvcGUnLCAnJHNjb3BlJywgJyRsb2NhdGlvbicsICckcm91dGVQYXJhbXMnLCAnJHEnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBjaGFpbkluZm9zQ3RybCgkcm9vdFNjb3BlLCAkc2NvcGUsICRsb2NhdGlvbiwgJHJvdXRlUGFyYW1zLCAkcSkge1xyXG4gICAgICAgIHZhciB3ZWIzID0gJHJvb3RTY29wZS53ZWIzO1xyXG4gICAgICAgIHZhciBCaWdOdW1iZXIgPSByZXF1aXJlKCdiaWdudW1iZXIuanMnKTtcclxuICAgICAgICAkc2NvcGUuaW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBnZXRDaGFpbkluZm9zKClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVzdWx0ID0gcmVzdWx0OyAvLyBqdXN0IGEgZHVtbXkgdmFsdWUsIGJ1dCBmb2xsb3dpbmcgV2hpdCdzIGV4YW1wbGUuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5ibG9ja051bSA9IHdlYjMuZXRoLmJsb2NrTnVtYmVyOyAvLyBub3cgdGhhdCB3YXMgZWFzeVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmJsb2NrTnVtICE9PSB1bmRlZmluZWQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IHB1dCB0aGUgMiB3ZWIzLmV0aC5nZXRCbG9jayBpbnRvIHRoZSBhc3luYyBmdW5jdGlvbiBiZWxvd1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICBlYXNpZXN0IHRvIGZpcnN0IGRvIHdpdGggZmFzdEluZm9zQ3RybFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYmxvY2tOZXdlc3QgPSB3ZWIzLmV0aC5nZXRCbG9jaygkc2NvcGUuYmxvY2tOdW0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrTmV3ZXN0ICE9PSB1bmRlZmluZWQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBkaWZmaWN1bHR5XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGlmZmljdWx0eSA9IGJsb2NrTmV3ZXN0LmRpZmZpY3VsdHk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGlmZmljdWx0eVRvRXhwb25lbnRpYWwgPSBibG9ja05ld2VzdC5kaWZmaWN1bHR5LnRvRXhwb25lbnRpYWwoMyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRvdGFsRGlmZmljdWx0eSA9IGJsb2NrTmV3ZXN0LnRvdGFsRGlmZmljdWx0eTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50b3RhbERpZmZpY3VsdHlUb0V4cG9uZW50aWFsID0gYmxvY2tOZXdlc3QudG90YWxEaWZmaWN1bHR5LnRvRXhwb25lbnRpYWwoMyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRvdGFsRGlmZmljdWx0eURpdmlkZWRCeURpZmZpY3VsdHkgPSAkc2NvcGUudG90YWxEaWZmaWN1bHR5LmRpdmlkZWRCeSgkc2NvcGUuZGlmZmljdWx0eSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudG90YWxEaWZmaWN1bHR5RGl2aWRlZEJ5RGlmZmljdWx0eV9mb3JtYXR0ZWQgPSAkc2NvcGUudG90YWxEaWZmaWN1bHR5RGl2aWRlZEJ5RGlmZmljdWx0eS50b0Zvcm1hdCgxKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuQWx0c2hlZXRzQ29lZmZpY2llbnQgPSAkc2NvcGUudG90YWxEaWZmaWN1bHR5RGl2aWRlZEJ5RGlmZmljdWx0eS5kaXZpZGVkQnkoJHNjb3BlLmJsb2NrTnVtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5BbHRzaGVldHNDb2VmZmljaWVudF9mb3JtYXR0ZWQgPSAkc2NvcGUuQWx0c2hlZXRzQ29lZmZpY2llbnQudG9Gb3JtYXQoNCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbGFyZ2UgbnVtYmVycyBzdGlsbCBwcmludGVkIG5pY2VseTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5kaWZmaWN1bHR5X2Zvcm1hdHRlZCA9ICRzY29wZS5kaWZmaWN1bHR5LnRvRm9ybWF0KDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRvdGFsRGlmZmljdWx0eV9mb3JtYXR0ZWQgPSAkc2NvcGUudG90YWxEaWZmaWN1bHR5LnRvRm9ybWF0KDApO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEdhcyBMaW1pdFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmdhc0xpbWl0ID0gbmV3IEJpZ051bWJlcihibG9ja05ld2VzdC5nYXNMaW1pdCkudG9Gb3JtYXQoMCkgKyBcIiBtL3NcIjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaW1lXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmV3RGF0ZSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdEYXRlLnNldFRpbWUoYmxvY2tOZXdlc3QudGltZXN0YW1wICogMTAwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudGltZSA9IG5ld0RhdGUudG9VVENTdHJpbmcoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2Vjb25kc1NpbmNlQmxvY2sxID0gYmxvY2tOZXdlc3QudGltZXN0YW1wIC0gMTQzODIyNjc3MztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5kYXlzU2luY2VCbG9jazEgPSAoJHNjb3BlLnNlY29uZHNTaW5jZUJsb2NrMSAvIDg2NDAwKS50b0ZpeGVkKDIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEF2ZXJhZ2UgQmxvY2sgVGltZXM6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBtYWtlIGZ1bGx5IGFzeW5jLCBwdXQgYmVsb3cgaW50byAnZmFzdEluZm9zQ3RybCdcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYmxvY2tCZWZvcmUgPSB3ZWIzLmV0aC5nZXRCbG9jaygkc2NvcGUuYmxvY2tOdW0gLSAxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChibG9ja0JlZm9yZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmJsb2NrdGltZSA9IGJsb2NrTmV3ZXN0LnRpbWVzdGFtcCAtIGJsb2NrQmVmb3JlLnRpbWVzdGFtcDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5yYW5nZTEgPSAxMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5nZSA9ICRzY29wZS5yYW5nZTE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYmxvY2tQYXN0ID0gd2ViMy5ldGguZ2V0QmxvY2soTWF0aC5tYXgoJHNjb3BlLmJsb2NrTnVtIC0gcmFuZ2UsIDApKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChibG9ja0JlZm9yZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmJsb2NrdGltZUF2ZXJhZ2UxID0gKChibG9ja05ld2VzdC50aW1lc3RhbXAgLSBibG9ja1Bhc3QudGltZXN0YW1wKSAvIHJhbmdlKS50b0ZpeGVkKDIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJhbmdlMiA9IDEwMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5nZSA9ICRzY29wZS5yYW5nZTI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYmxvY2tQYXN0ID0gd2ViMy5ldGguZ2V0QmxvY2soTWF0aC5tYXgoJHNjb3BlLmJsb2NrTnVtIC0gcmFuZ2UsIDApKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChibG9ja0JlZm9yZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmJsb2NrdGltZUF2ZXJhZ2UyID0gKChibG9ja05ld2VzdC50aW1lc3RhbXAgLSBibG9ja1Bhc3QudGltZXN0YW1wKSAvIHJhbmdlKS50b0ZpeGVkKDIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJhbmdlMyA9IDEwMDAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZ2UgPSAkc2NvcGUucmFuZ2UzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJsb2NrUGFzdCA9IHdlYjMuZXRoLmdldEJsb2NrKE1hdGgubWF4KCRzY29wZS5ibG9ja051bSAtIHJhbmdlLCAwKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmxvY2tCZWZvcmUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5ibG9ja3RpbWVBdmVyYWdlMyA9ICgoYmxvY2tOZXdlc3QudGltZXN0YW1wIC0gYmxvY2tQYXN0LnRpbWVzdGFtcCkgLyByYW5nZSkudG9GaXhlZCgyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5yYW5nZTQgPSAxMDAwMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5nZSA9ICRzY29wZS5yYW5nZTQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYmxvY2tQYXN0ID0gd2ViMy5ldGguZ2V0QmxvY2soTWF0aC5tYXgoJHNjb3BlLmJsb2NrTnVtIC0gcmFuZ2UsIDApKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChibG9ja0JlZm9yZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmJsb2NrdGltZUF2ZXJhZ2U0ID0gKChibG9ja05ld2VzdC50aW1lc3RhbXAgLSBibG9ja1Bhc3QudGltZXN0YW1wKSAvIHJhbmdlKS50b0ZpeGVkKDIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmdlID0gJHNjb3BlLmJsb2NrTnVtO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJsb2NrUGFzdCA9IHdlYjMuZXRoLmdldEJsb2NrKDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrQmVmb3JlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYmxvY2t0aW1lQXZlcmFnZUFsbCA9ICgoYmxvY2tOZXdlc3QudGltZXN0YW1wIC0gYmxvY2tQYXN0LnRpbWVzdGFtcCkgLyByYW5nZSkudG9GaXhlZCgyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9mYXN0QW5zd2Vycygkc2NvcGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8kc2NvcGU9QmxvY2tFeHBsb3JlckNvbnN0YW50cygkc2NvcGUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQmxvY2sgRXhwbG9yZXIgSW5mb1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXNDb25uZWN0ZWQgPSB3ZWIzLmlzQ29ubmVjdGVkKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8kc2NvcGUucGVlckNvdW50ID0gd2ViMy5uZXQucGVlckNvdW50O1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS52ZXJzaW9uQXBpID0gd2ViMy52ZXJzaW9uLmFwaTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudmVyc2lvbkNsaWVudCA9IHdlYjMudmVyc2lvbi5jbGllbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnZlcnNpb25OZXR3b3JrID0gd2ViMy52ZXJzaW9uLm5ldHdvcms7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnZlcnNpb25DdXJyZW5jeSA9IHdlYjMudmVyc2lvbi5ldGhlcmV1bTsgLy8gVE9ETzogY2hhbmdlIHRoYXQgdG8gY3VycmVuY3luYW1lP1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyByZWFkeSBmb3IgdGhlIGZ1dHVyZTpcclxuICAgICAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudmVyc2lvbldoaXNwZXIgPSB3ZWIzLnZlcnNpb24ud2hpc3BlcjtcclxuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnZlcnNpb25XaGlzcGVyID0gZXJyLm1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0Q2hhaW5JbmZvcygpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKDApOyAvLyBkdW1teSB2YWx1ZSAwLCBmb3Igbm93LiAvLyBzZWUgYmxvY2tJbmZvc0NvbnRyb2xsZXIuanNcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICAkc2NvcGUuaW5pdCgpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5yZXN1bHQpO1xyXG5cclxuICAgIH07XHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbigpIHtcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdteUFwcCcpXHJcblxyXG4gICAgICAgIC5jb250cm9sbGVyKCdtYWluRGFzaEN0cmwnLCBtYWluRGFzaEN0cmwpO1xyXG5cclxuXHJcbiAgICBtYWluRGFzaEN0cmwuJGluamVjdCA9IFsnJHJvb3RTY29wZScsICckc2NvcGUnLCAnJGxvY2F0aW9uJywgJyR0aW1lb3V0J107XHJcblxyXG5cclxuICAgIGZ1bmN0aW9uIG1haW5EYXNoQ3RybCgkcm9vdFNjb3BlLCAkc2NvcGUsICRsb2NhdGlvbiwgJHRpbWVvdXQpIHtcclxuICAgICAgICB2YXIgd2ViMyA9ICRyb290U2NvcGUud2ViMztcclxuICAgICAgICB2YXIgQmlnTnVtYmVyID0gcmVxdWlyZSgnYmlnbnVtYmVyLmpzJyk7XHJcbiAgICAgICAgLy8gRGlzcGxheSAmIHVwZGF0ZSBibG9jayBsaXN0XHJcbiAgICAgICAgLy8gZ2V0RVRIUmF0ZXMoKTtcclxuICAgICAgICB1cGRhdGVCbG9ja0xpc3QoKTtcclxuICAgICAgICB1cGRhdGVUWExpc3QoKTtcclxuICAgICAgICB1cGRhdGVTdGF0cygpO1xyXG4gICAgICAgIC8vIGdldEhhc2hyYXRlKCk7XHJcblxyXG4gICAgICAgIHdlYjMuZXRoLmZpbHRlcihcImxhdGVzdFwiKS53YXRjaChmdW5jdGlvbihlcnJvciwgcmVzdWx0KSB7XHJcbiAgICAgICAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdXBkYXRlQmxvY2tMaXN0KCk7XHJcbiAgICAgICAgICAgICAgICB1cGRhdGVUWExpc3QoKTtcclxuICAgICAgICAgICAgICAgIHVwZGF0ZVN0YXRzKCk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnByb2Nlc3NSZXF1ZXN0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciByZXF1ZXN0U3RyID0gJHNjb3BlLmV0aFJlcXVlc3Q7XHJcblxyXG5cclxuICAgICAgICAgICAgaWYgKHJlcXVlc3RTdHIgIT09IHVuZGVmaW5lZCkge1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIG1heWJlIHdlIGNhbiBjcmVhdGUgYSBzZXJ2aWNlIHRvIGRvIHRoZSByZWcgZXggdGVzdCwgc28gd2UgY2FuIHVzZSBpdCBpbiBldmVyeSBjb250cm9sbGVyID9cclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgcmVnZXhwVHggPSAvWzAtOWEtekEtWl17NjR9Py87XHJcbiAgICAgICAgICAgICAgICAvL3ZhciByZWdleHBBZGRyID0gIC9bQS1aMC05Ll8lKy1dK0BbQS1aMC05Li1dK1xcLltBLVpdezIsNH0vOyAvLyBUT0RPIEFERFIgUkVHRVggb3IgdXNlIGlzQWRkcmVzcyhoZXhTdHJpbmcpIEFQSSA/XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVnZXhwQWRkciA9IC9eKDB4KT9bMC05YS1mXXs0MH0kLzsgLy9OZXcgRVRIIFJlZ3VsYXIgRXhwcmVzc2lvbiBmb3IgQWRkcmVzc2VzXHJcbiAgICAgICAgICAgICAgICB2YXIgcmVnZXhwQmxvY2sgPSAvWzAtOV17MSw3fT8vO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSByZWdleHBUeC50ZXN0KHJlcXVlc3RTdHIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGdvVG9UeEluZm9zKHJlcXVlc3RTdHIpXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJlZ2V4cEFkZHIudGVzdChyZXF1ZXN0U3RyLnRvTG93ZXJDYXNlKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ29Ub0FkZHJJbmZvcyhyZXF1ZXN0U3RyLnRvTG93ZXJDYXNlKCkpXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gcmVnZXhwQmxvY2sudGVzdChyZXF1ZXN0U3RyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ29Ub0Jsb2NrSW5mb3MocmVxdWVzdFN0cilcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwibm9wZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ29Ub0Jsb2NrSW5mb3MocmVxdWVzdFN0cikge1xyXG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2Jsb2NrLycgKyByZXF1ZXN0U3RyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdvVG9BZGRySW5mb3MocmVxdWVzdFN0cikge1xyXG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2FkZHJlc3MvJyArIHJlcXVlc3RTdHIudG9Mb3dlckNhc2UoKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnb1RvVHhJbmZvcyhyZXF1ZXN0U3RyKSB7XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvdHgvJyArIHJlcXVlc3RTdHIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlU3RhdHMoKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5ibG9ja051bSA9IHdlYjMuZXRoLmJsb2NrTnVtYmVyOyAvLyBub3cgdGhhdCB3YXMgZWFzeVxyXG5cclxuICAgICAgICAgICAgaWYgKCRzY29wZS5ibG9ja051bSAhPT0gdW5kZWZpbmVkKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gVE9ETzogcHV0IHRoZSAyIHdlYjMuZXRoLmdldEJsb2NrIGludG8gdGhlIGFzeW5jIGZ1bmN0aW9uIGJlbG93XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICBlYXNpZXN0IHRvIGZpcnN0IGRvIHdpdGggZmFzdEluZm9zQ3RybFxyXG4gICAgICAgICAgICAgICAgdmFyIGJsb2NrTmV3ZXN0ID0gd2ViMy5ldGguZ2V0QmxvY2soJHNjb3BlLmJsb2NrTnVtKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoYmxvY2tOZXdlc3QgIT09IHVuZGVmaW5lZCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBkaWZmaWN1bHR5XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmRpZmZpY3VsdHkgPSBibG9ja05ld2VzdC5kaWZmaWN1bHR5O1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5kaWZmaWN1bHR5VG9FeHBvbmVudGlhbCA9IGJsb2NrTmV3ZXN0LmRpZmZpY3VsdHkudG9FeHBvbmVudGlhbCgzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRvdGFsRGlmZmljdWx0eSA9IGJsb2NrTmV3ZXN0LnRvdGFsRGlmZmljdWx0eTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudG90YWxEaWZmaWN1bHR5VG9FeHBvbmVudGlhbCA9IGJsb2NrTmV3ZXN0LnRvdGFsRGlmZmljdWx0eS50b0V4cG9uZW50aWFsKDMpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudG90YWxEaWZmaWN1bHR5RGl2aWRlZEJ5RGlmZmljdWx0eSA9ICRzY29wZS50b3RhbERpZmZpY3VsdHkuZGl2aWRlZEJ5KCRzY29wZS5kaWZmaWN1bHR5KTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudG90YWxEaWZmaWN1bHR5RGl2aWRlZEJ5RGlmZmljdWx0eV9mb3JtYXR0ZWQgPSAkc2NvcGUudG90YWxEaWZmaWN1bHR5RGl2aWRlZEJ5RGlmZmljdWx0eS50b0Zvcm1hdCgxKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLkFsdHNoZWV0c0NvZWZmaWNpZW50ID0gJHNjb3BlLnRvdGFsRGlmZmljdWx0eURpdmlkZWRCeURpZmZpY3VsdHkuZGl2aWRlZEJ5KCRzY29wZS5ibG9ja051bSk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLkFsdHNoZWV0c0NvZWZmaWNpZW50X2Zvcm1hdHRlZCA9ICRzY29wZS5BbHRzaGVldHNDb2VmZmljaWVudC50b0Zvcm1hdCg0KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gbGFyZ2UgbnVtYmVycyBzdGlsbCBwcmludGVkIG5pY2VseTpcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGlmZmljdWx0eV9mb3JtYXR0ZWQgPSAkc2NvcGUuZGlmZmljdWx0eS50b0Zvcm1hdCgwKTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudG90YWxEaWZmaWN1bHR5X2Zvcm1hdHRlZCA9ICRzY29wZS50b3RhbERpZmZpY3VsdHkudG9Gb3JtYXQoMCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEdhcyBMaW1pdFxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5nYXNMaW1pdCA9IG5ldyBCaWdOdW1iZXIoYmxvY2tOZXdlc3QuZ2FzTGltaXQpLnRvRm9ybWF0KDApICsgXCIgbS9zXCI7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBBZGRpbmcgbmV3IGRpZmZpY3VsdHlcclxuXHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIFRpbWVcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbmV3RGF0ZSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3RGF0ZS5zZXRUaW1lKGJsb2NrTmV3ZXN0LnRpbWVzdGFtcCAqIDEwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS50aW1lID0gbmV3RGF0ZS50b1VUQ1N0cmluZygpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2Vjb25kc1NpbmNlQmxvY2sxID0gYmxvY2tOZXdlc3QudGltZXN0YW1wIC0gMTQzODIyNjc3MztcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF5c1NpbmNlQmxvY2sxID0gKCRzY29wZS5zZWNvbmRzU2luY2VCbG9jazEgLyA4NjQwMCkudG9GaXhlZCgyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQXZlcmFnZSBCbG9jayBUaW1lczpcclxuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBtYWtlIGZ1bGx5IGFzeW5jLCBwdXQgYmVsb3cgaW50byAnZmFzdEluZm9zQ3RybCdcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJsb2NrQmVmb3JlID0gd2ViMy5ldGguZ2V0QmxvY2soJHNjb3BlLmJsb2NrTnVtIC0gMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrQmVmb3JlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmJsb2NrdGltZSA9IGJsb2NrTmV3ZXN0LnRpbWVzdGFtcCAtIGJsb2NrQmVmb3JlLnRpbWVzdGFtcDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJhbmdlMSA9IDEwMDtcclxuICAgICAgICAgICAgICAgICAgICByYW5nZSA9ICRzY29wZS5yYW5nZTE7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJsb2NrUGFzdCA9IHdlYjMuZXRoLmdldEJsb2NrKE1hdGgubWF4KCRzY29wZS5ibG9ja051bSAtIHJhbmdlLCAwKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrQmVmb3JlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmJsb2NrdGltZUF2ZXJhZ2UxID0gKChibG9ja05ld2VzdC50aW1lc3RhbXAgLSBibG9ja1Bhc3QudGltZXN0YW1wKSAvIHJhbmdlKS50b0ZpeGVkKDIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmFuZ2UyID0gMTAwMDtcclxuICAgICAgICAgICAgICAgICAgICByYW5nZSA9ICRzY29wZS5yYW5nZTI7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJsb2NrUGFzdCA9IHdlYjMuZXRoLmdldEJsb2NrKE1hdGgubWF4KCRzY29wZS5ibG9ja051bSAtIHJhbmdlLCAwKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrQmVmb3JlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmJsb2NrdGltZUF2ZXJhZ2UyID0gKChibG9ja05ld2VzdC50aW1lc3RhbXAgLSBibG9ja1Bhc3QudGltZXN0YW1wKSAvIHJhbmdlKS50b0ZpeGVkKDIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmFuZ2UzID0gMTAwMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2UgPSAkc2NvcGUucmFuZ2UzO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBibG9ja1Bhc3QgPSB3ZWIzLmV0aC5nZXRCbG9jayhNYXRoLm1heCgkc2NvcGUuYmxvY2tOdW0gLSByYW5nZSwgMCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChibG9ja0JlZm9yZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5ibG9ja3RpbWVBdmVyYWdlMyA9ICgoYmxvY2tOZXdlc3QudGltZXN0YW1wIC0gYmxvY2tQYXN0LnRpbWVzdGFtcCkgLyByYW5nZSkudG9GaXhlZCgyKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJhbmdlNCA9IDEwMDAwMDtcclxuICAgICAgICAgICAgICAgICAgICByYW5nZSA9ICRzY29wZS5yYW5nZTQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJsb2NrUGFzdCA9IHdlYjMuZXRoLmdldEJsb2NrKE1hdGgubWF4KCRzY29wZS5ibG9ja051bSAtIHJhbmdlLCAwKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrQmVmb3JlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmJsb2NrdGltZUF2ZXJhZ2U0ID0gKChibG9ja05ld2VzdC50aW1lc3RhbXAgLSBibG9ja1Bhc3QudGltZXN0YW1wKSAvIHJhbmdlKS50b0ZpeGVkKDIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2UgPSAkc2NvcGUuYmxvY2tOdW07XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJsb2NrUGFzdCA9IHdlYjMuZXRoLmdldEJsb2NrKDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChibG9ja0JlZm9yZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5ibG9ja3RpbWVBdmVyYWdlQWxsID0gKChibG9ja05ld2VzdC50aW1lc3RhbXAgLSBibG9ja1Bhc3QudGltZXN0YW1wKSAvIHJhbmdlKS50b0ZpeGVkKDIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy9mYXN0QW5zd2Vycygkc2NvcGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vJHNjb3BlPUJsb2NrRXhwbG9yZXJDb25zdGFudHMoJHNjb3BlKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gQmxvY2sgRXhwbG9yZXIgSW5mb1xyXG4gICAgICAgICAgICAkc2NvcGUuaXNDb25uZWN0ZWQgPSB3ZWIzLmlzQ29ubmVjdGVkKCk7XHJcbiAgICAgICAgICAgIC8vJHNjb3BlLnBlZXJDb3VudCA9IHdlYjMubmV0LnBlZXJDb3VudDtcclxuICAgICAgICAgICAgJHNjb3BlLnZlcnNpb25BcGkgPSB3ZWIzLnZlcnNpb24uYXBpO1xyXG4gICAgICAgICAgICAkc2NvcGUudmVyc2lvbkNsaWVudCA9IHdlYjMudmVyc2lvbi5jbGllbnQ7XHJcbiAgICAgICAgICAgIC8vJHNjb3BlLnZlcnNpb25OZXR3b3JrID0gd2ViMy52ZXJzaW9uLm5ldHdvcms7XHJcbiAgICAgICAgICAgICRzY29wZS52ZXJzaW9uQ3VycmVuY3kgPSB3ZWIzLnZlcnNpb24uZXRoZXJldW07IC8vIFRPRE86IGNoYW5nZSB0aGF0IHRvIGN1cnJlbmN5bmFtZT9cclxuXHJcbiAgICAgICAgICAgIC8vIHJlYWR5IGZvciB0aGUgZnV0dXJlOlxyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnZlcnNpb25XaGlzcGVyID0gd2ViMy52ZXJzaW9uLndoaXNwZXI7XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnZlcnNpb25XaGlzcGVyID0gZXJyLm1lc3NhZ2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiB1cGRhdGVUWExpc3QoKSB7XHJcbiAgICAgICAgICAgIHZhciBjdXJyZW50VFhudW1iZXIgPSB3ZWIzLmV0aC5ibG9ja051bWJlcjtcclxuICAgICAgICAgICAgJHNjb3BlLnR4TnVtYmVyID0gY3VycmVudFRYbnVtYmVyO1xyXG4gICAgICAgICAgICAkc2NvcGUucmVjZW50dHJhbnNhY3Rpb25zID0gW107XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMTAgJiYgY3VycmVudFRYbnVtYmVyIC0gaSA+PSAwOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmICh3ZWIzLmV0aC5nZXRUcmFuc2FjdGlvbkZyb21CbG9jayhjdXJyZW50VFhudW1iZXIgLSBpKSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlY2VudHRyYW5zYWN0aW9ucy5wdXNoKHdlYjMuZXRoLmdldFRyYW5zYWN0aW9uRnJvbUJsb2NrKGN1cnJlbnRUWG51bWJlciAtIGkpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlQmxvY2tMaXN0KCkge1xyXG4gICAgICAgICAgICB2YXIgY3VycmVudEJsb2NrTnVtYmVyID0gd2ViMy5ldGguYmxvY2tOdW1iZXI7XHJcbiAgICAgICAgICAgICRzY29wZS5ibG9ja051bWJlciA9IGN1cnJlbnRCbG9ja051bWJlcjtcclxuICAgICAgICAgICAgJHNjb3BlLmJsb2NrcyA9IFtdO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDEwICYmIGN1cnJlbnRCbG9ja051bWJlciAtIGkgPj0gMDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYmxvY2tzLnB1c2god2ViMy5ldGguZ2V0QmxvY2soY3VycmVudEJsb2NrTnVtYmVyIC0gaSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uKCkge1xyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ215QXBwJylcclxuXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ3RyYW5zYWN0aW9uSW5mb3NDdHJsJywgdHJhbnNhY3Rpb25JbmZvc0N0cmwpO1xyXG5cclxuICAgIHRyYW5zYWN0aW9uSW5mb3NDdHJsLiRpbmplY3QgPSBbJyRyb290U2NvcGUnLCAnJHNjb3BlJywgJyRsb2NhdGlvbicsICckc3RhdGVQYXJhbXMnLCAnJHEnXTtcclxuXHJcbiAgICBmdW5jdGlvbiB0cmFuc2FjdGlvbkluZm9zQ3RybCgkcm9vdFNjb3BlLCAkc2NvcGUsICRsb2NhdGlvbiwgJHJvdXRlUGFyYW1zLCAkcSkge1xyXG4gICAgICAgIHZhciB3ZWIzID0gJHJvb3RTY29wZS53ZWIzO1xyXG4gICAgICAgICRzY29wZS5pbml0ID0gZnVuY3Rpb24oKSB7XHJcblxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnR4SWQgPSAkcm91dGVQYXJhbXMudHJhbnNhY3Rpb25JZDtcclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUudHhJZCAhPT0gdW5kZWZpbmVkKSB7IC8vIGFkZCBhIHRlc3QgdG8gY2hlY2sgaWYgaXQgbWF0Y2ggdHggcGF0ZXJucyB0byBhdm9pZCB1c2VsZXNzIEFQSSBjYWxsLCBjbGllbnRzIGFyZSBub3Qgb2JsaWdlZCB0byBjb21lIGZyb20gdGhlIHNlYXJjaCBmb3JtLi4uXHJcblxyXG4gICAgICAgICAgICAgICAgZ2V0VHJhbnNhY3Rpb25JbmZvcygpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vVE9ETyBSZWZhY3RvciB0aGlzIGxvZ2ljLCBhc3luY2hyb24gY2FsbHMgKyBzZXJ2aWNlcy4uLi5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG51bWJlciA9IHdlYjMuZXRoLmJsb2NrTnVtYmVyO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlc3VsdCA9IHJlc3VsdDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuYmxvY2tIYXNoICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5ibG9ja0hhc2ggPSByZXN1bHQuYmxvY2tIYXNoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmJsb2NrSGFzaCA9ICdwZW5kaW5nJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmJsb2NrTnVtYmVyICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5ibG9ja051bWJlciA9IHJlc3VsdC5ibG9ja051bWJlcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5ibG9ja051bWJlciA9ICdwZW5kaW5nJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZnJvbSA9IHJlc3VsdC5mcm9tO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZ2FzID0gcmVzdWx0LmdhcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8kc2NvcGUuZ2FzUHJpY2UgPSByZXN1bHQuZ2FzUHJpY2UuY1swXSArIFwiIFdFSVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZ2FzUHJpY2UgPSB3ZWIzLmZyb21XZWkocmVzdWx0Lmdhc1ByaWNlLCBcImV0aGVyXCIpLnRvRm9ybWF0KDEwKSArIFwiIEVUSFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaGFzaCA9IHJlc3VsdC5oYXNoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaW5wdXQgPSByZXN1bHQuaW5wdXQ7IC8vIHRoYXQncyBhIHN0cmluZ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubm9uY2UgPSByZXN1bHQubm9uY2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50byA9IHJlc3VsdC50bztcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRyYW5zYWN0aW9uSW5kZXggPSByZXN1bHQudHJhbnNhY3Rpb25JbmRleDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8kc2NvcGUuZXRoVmFsdWUgPSB3ZWIzLmZyb21XZWkocmVzdWx0LnZhbHVlWzBdLCBcImV0aGVyXCIpOyBOZXdlciBtZXRob2QgYnV0IGhhcyBcIlwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5ldGhWYWx1ZSA9IHJlc3VsdC52YWx1ZS5jWzBdIC8gMTAwMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50eHByaWNlID0gd2ViMy5mcm9tV2VpKHJlc3VsdC5nYXMgKiByZXN1bHQuZ2FzUHJpY2UsIFwiZXRoZXJcIikgKyBcIiBFVEhcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5ibG9ja051bWJlciAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY29uZiA9IG51bWJlciAtICRzY29wZS5ibG9ja051bWJlcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuY29uZiA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5jb25mID0gJ3VuY29uZmlybWVkJzsgLy9UT0RPIGNoYW5nZSBjb2xvciBidXR0b24gd2hlbiB1bmNvbmZpcm1lZC4uLiBuZy1pZiBvciBuZy1jbGFzc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vVE9ETyBSZWZhY3RvciB0aGlzIGxvZ2ljLCBhc3luY2hyb24gY2FsbHMgKyBzZXJ2aWNlcy4uLi5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5ibG9ja051bWJlciAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5mbyA9IHdlYjMuZXRoLmdldEJsb2NrKCRzY29wZS5ibG9ja051bWJlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5mbyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRpbWUgPSBpbmZvLnRpbWVzdGFtcDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aChcIi9cIik7IC8vIGFkZCBhIHRyaWdnZXIgdG8gZGlzcGxheSBhbiBlcnJvciBtZXNzYWdlIHNvIHVzZXIga25vd3MgaGUgbWVzc2VkIHVwIHdpdGggdGhlIFRYIG51bWJlclxyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0VHJhbnNhY3Rpb25JbmZvcygpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgd2ViMy5ldGguZ2V0VHJhbnNhY3Rpb24oJHNjb3BlLnR4SWQsIGZ1bmN0aW9uKGVycm9yLCByZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuXHJcbiAgICAgICAgfTtcclxuICAgICAgICAkc2NvcGUuaW5pdCgpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5yZXN1bHQpO1xyXG5cclxuICAgIH07XHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbigpIHtcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdteUFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ2Rhc2hib2FyZEN0cmwnLCBkYXNoYm9hcmRDdHJsKTtcclxuXHJcbiAgICBkYXNoYm9hcmRDdHJsLiRpbmplY3QgPSBbJyRzY29wZScsICckaHR0cCcsICdhdXRoZW50aWNhdGlvbiddO1xyXG5cclxuICAgIGZ1bmN0aW9uIGRhc2hib2FyZEN0cmwoJHNjb3BlLCAkaHR0cCwgYXV0aGVudGljYXRpb24pIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcImluc2lkZSBkYXNoYm9hcmRDdHJsIFwiKTtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnNob3dBY2NvcmRpb24gPSBmYWxzZTtcclxuICAgICAgICB2bS5sY0RldGFpbHNFbmFibGVkID0gdHJ1ZTtcclxuICAgICAgICAkc2NvcGUudG9kYXkgPSBuZXcgRGF0ZSgpO1xyXG5cclxuXHJcbiAgICAgICAgdm0uc2hvd1JhZGlvQnRuRGV0YWlsID0gZnVuY3Rpb24oZm9ybW9iaiwgc2xjdGRSYWRpb0J0bikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInNsY3RkUmFkaW9CdG49XCIgKyBzbGN0ZFJhZGlvQnRuKTtcclxuICAgICAgICAgICAgZm9ybW9iai5sY1NlbGVjdGVkID0gXCJcIjtcclxuICAgICAgICAgICAgdm0ubGNEZXRhaWxzRW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIHZtLnNob3dBY2NvcmRpb24gPSBmYWxzZTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJkYXNoYm9hcmRGb3JtLmxjU2VsZWN0ZWQ9PVwiICsgZm9ybW9iai5sY1NlbGVjdGVkKTtcclxuICAgICAgICAgICAgaWYgKHNsY3RkUmFkaW9CdG4gPT0gJ2NvbnRyYWN0RGF0ZScpIHtcclxuICAgICAgICAgICAgICAgIGlmIChmb3Jtb2JqLnN0YXJ0RGF0ZSAhPSB1bmRlZmluZWQgJiYgZm9ybW9iai5lbmREYXRlICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZnJvbSBkYXRlXCIgKyBmb3Jtb2JqLnN0YXJ0RGF0ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJmcm9tIGRhdGVcIiArIGZvcm1vYmouZW5kRGF0ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICRodHRwLmdldCgnL2Rhc2hib2FyZC9mZXRjaFBPLycgKyBmb3Jtb2JqLnN0YXJ0RGF0ZSArICcvJyArIGZvcm1vYmouZW5kRGF0ZSwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAnQmVhcmVyICcgKyBhdXRoZW50aWNhdGlvbi5nZXRUb2tlbigpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZGFzaGJvYXJkIGNvbnRyb2xsZXItaWZcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5kYXNoYm9hcmRzID0gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJkYXNoYm9hcmQgY29udHJvbGxlci1pZi0xXCIgKyByZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZS5zdGF0dXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHNsY3RkUmFkaW9CdG4gPT0gJ3BvTnVtYmVyJyB8fCBzbGN0ZFJhZGlvQnRuID09ICdsY051bWJlcicpIHtcclxuICAgICAgICAgICAgICAgIGZvcm1vYmouc3RhcnREYXRlID0gXCJcIjtcclxuICAgICAgICAgICAgICAgIGZvcm1vYmouZW5kRGF0ZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAvLyBpZiBzZWxlY3RlZCByYWRpbyB0eXBlIGlzIG5vdCBkYXRlLCBpdHMgZWl0aGVyIFBPIG9yIExDIE51bWJlclxyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvZGFzaGJvYXJkL0xDRGV0YWlscycsIHtcclxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICdCZWFyZXIgJyArIGF1dGhlbnRpY2F0aW9uLmdldFRva2VuKClcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJkYXNoYm9hcmQgY29udHJvbGxlci1lbHNlXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5kYXNoYm9hcmRzID0gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2Uuc3RhdHVzKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnRvVGltZXN0YW1wID0gZnVuY3Rpb24odGltZU9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IERhdGUodGltZU9iaikuZ2V0VGltZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uc2hvd0xDRGV0YWlsID0gZnVuY3Rpb24obGNEZXRhaWxzKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwibGNOdW1iZXIgaXNcIiArIGxjRGV0YWlscy5sY051bWJlcik7XHJcbiAgICAgICAgICAgIHZtLnNob3dBY2NvcmRpb24gPSB0cnVlO1xyXG4gICAgICAgICAgICB2bS5sY0RldGFpbHNFbmFibGVkID0gZmFsc2U7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnJhbmdlID0gZnVuY3Rpb24obWluLCBtYXgsIHN0ZXApIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJtYXg9XCIgKyBtYXgpO1xyXG4gICAgICAgICAgICBzdGVwID0gc3RlcCB8fCAxO1xyXG4gICAgICAgICAgICB2YXIgaW5wdXQgPSBbXTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IG1pbjsgaSA8PSBtYXg7IGkgKz0gc3RlcCkge1xyXG4gICAgICAgICAgICAgICAgaW5wdXQucHVzaChpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gaW5wdXQ7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcblxyXG5cclxufSkoKTtcclxuIiwiXHJcbmFuZ3VsYXIubW9kdWxlKFwibXlBcHBcIikuY29udHJvbGxlcihcIkZvb3RlckNvbnRyb2xsZXJcIiwgZnVuY3Rpb24gKCRzY29wZSkge1xyXG4gXHJcbiAgICAkc2NvcGUuc3VibWl0RmVlZGJhY2sgPSBmdW5jdGlvbihhY3Rpb24pIHtcclxuICAgICAgIHJldHVybjtcclxuICAgIH1cclxuIFxyXG59KTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdteUFwcCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdob21lQ3RybCcsIGhvbWVDdHJsKTtcblxuICAgIGhvbWVDdHJsLiRpbmplY3QgPSBbJyRzY29wZScsICckaHR0cCcsICckc3RhdGUnLCAnYXV0aGVudGljYXRpb24nXTtcblxuICAgIGZ1bmN0aW9uIGhvbWVDdHJsKCRzY29wZSwgJGh0dHAsICRzdGF0ZSwgYXV0aGVudGljYXRpb24pIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2bS5pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkaHR0cC5nZXQoJy9ob21lL2RldGFpbHMvJywge1xuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogJ0JlYXJlciAnICsgYXV0aGVudGljYXRpb24uZ2V0VG9rZW4oKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJIT01FXCIpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgdXNlckluZm8gPSBhdXRoZW50aWNhdGlvbi5jdXJyZW50VXNlcigpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaG9tZVBhZ2VEYXRhID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlzc3VlQm5rO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmVVc2VEYXRhO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaG9tZVBhZ2UgPXtcbiAgICAgICAgICAgICAgICAgICAgICByZVVzZURhdGE6XCJcIixcbiAgICAgICAgICAgICAgICAgICAgICBpc3N1ZUJuazpcIlwiLFxuICAgICAgICAgICAgICAgICAgICAgIHRhYmxlSGVhZGluZzE6XCJcIixcbiAgICAgICAgICAgICAgICAgICAgICB0YWJsZUhlYWRpbmcyOlwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgc3RhdGU6XCJcIixcbiAgICAgICAgICAgICAgICAgICAgICBzdGF0ZTE6XCJcIixcbiAgICAgICAgICAgICAgICAgICAgICBpc0FwcEZvcm06XCJcIlxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh1c2VySW5mby5yb2xlID09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaXNzdWVCbmsgPSBob21lUGFnZURhdGEuZmlsdGVyKGZ1bmN0aW9uKGRhdGFPYmopIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGRhdGFPYmoubGNWYWx1ZSA9PSAnMTAwJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlVXNlRGF0YSA9IGhvbWVQYWdlRGF0YS5maWx0ZXIoZnVuY3Rpb24oZGF0YU9iaikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoZGF0YU9iai5sY1ZhbHVlID09ICc1MDAnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaG9tZVBhZ2UudGFibGVIZWFkaW5nMSA9IFwiSXNzdWUgTENcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhvbWVQYWdlLnRhYmxlSGVhZGluZzIgPSBcIkxvZGdlIGRvY3VtZW50c1wiO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBob21lUGFnZS5pc3N1ZUJuayA9IGlzc3VlQm5rO1xuICAgICAgICAgICAgICAgICAgICAgICAgaG9tZVBhZ2UucmVVc2VEYXRhID0gcmVVc2VEYXRhO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBob21lUGFnZS5zdGF0ZTE9XCJpc3N1ZUJhbmtMbmRpbmdQYWdlXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBob21lUGFnZS5zdGF0ZT1cImFjY2VwdExvZGdlbWVudFBhZ2VcIjtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh1c2VySW5mby5yb2xlID09IDMwMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBob21lUGFnZS50YWJsZUhlYWRpbmcyID0gXCJBY2NlcHQgTENcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgaG9tZVBhZ2Uuc3RhdGU9XCJhZHZpc2luZ0JhbmtMbmRpbmdQYWdlXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGhvbWVQYWdlLnJlVXNlRGF0YT0gaG9tZVBhZ2VEYXRhO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHVzZXJJbmZvLnJvbGUgPT0gNDAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBob21lUGFnZS50YWJsZUhlYWRpbmcyID0gXCJVcGxvYWQgRG9jdW1lbnRzXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBob21lUGFnZS5zdGF0ZT1cImJlbmVmaWNpYXJ5TG5kaW5nUGFnZVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgaG9tZVBhZ2UucmVVc2VEYXRhPSBob21lUGFnZURhdGE7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodXNlckluZm8ucm9sZSA9PSA1MDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhvbWVQYWdlLnRhYmxlSGVhZGluZzIgPSBcIkxvZGdlIERvY3VtZW50c1wiO1xuICAgICAgICAgICAgICAgICAgICAgICAgaG9tZVBhZ2UucmVVc2VEYXRhPSBob21lUGFnZURhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgICBob21lUGFnZS5zdGF0ZT1cInByZXNlbnRpbmdMYW5kaW5nUGFnZVwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHVzZXJJbmZvLnJvbGUgPT0gMTAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgaG9tZVBhZ2UuaXNBcHBGb3JtID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgICAgICAgICAgdm0uaG9tZVBhZ2VEYXRhID0gaG9tZVBhZ2U7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHZtLmhvbWVQYWdlRGF0YSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbihlcnIpIHtcblxuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdm0uaW5pdCgpO1xuXG4gICAgfVxufSkoKTtcbiIsIi8qKlxuICogQGF1dGhvciBzdWtvaGxpQGRlbG9pdHRlLmNvbVxuICogL2lzc3VlQmFuay9ob21lIC0+IGNvbnRyb2xsZXJcbiAqIFRoaXMgY29udHJvbGxlciBoYW5kbGVzIElzc3VlIExDLCBwcmVwb3B1bGF0ZXMsIHVwbG9hZHNcbiAqIGZpbGUgdG8gaXBmcyBhbmQgc3VibWl0cyBmb3JtXG4gKi9cbihmdW5jdGlvbigpIHtcbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ215QXBwJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ2lzc3VlQmFua0N0cmwnLCBpc3N1ZUJhbmtDdHJsKTtcblxuICAgIGlzc3VlQmFua0N0cmwuJGluamVjdCA9IFsnJGh0dHAnLCAnJHNjb3BlJywgJyRyb290U2NvcGUnLCAnYXBpQ2FsbCcsICdhdXRoZW50aWNhdGlvbicsICckc3RhdGVQYXJhbXMnXTtcblxuICAgIGZ1bmN0aW9uIGlzc3VlQmFua0N0cmwoJGh0dHAsICRzY29wZSwgJHJvb3RTY29wZSwgYXBpQ2FsbCwgYXV0aGVudGljYXRpb24sICRzdGF0ZVBhcmFtcykge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG5cbiAgICAgICAgLy8gdXNpbmcgYmVsb3cgcmVnZXggaW4gbmctcGF0dGVyblxuICAgICAgICAkc2NvcGUub25seU51bWJlcnMgPSAvXlswLTldezEsN30kLztcblxuICAgICAgICB2bS5sY0RldGFpbHMgPSB7XG4gICAgICAgICAgICBsY0ZlZTogXCJcIixcbiAgICAgICAgICAgIGxjTnVtYmVyOiBcIlwiLFxuICAgICAgICAgICAgbGNWYWx1ZTogXCJcIixcbiAgICAgICAgICAgIGxjVGVybXM6IFwiXCIsXG4gICAgICAgICAgICBtZXNzYWdlOiBcIlwiLFxuICAgICAgICAgICAgc2hvd0FjY29yZGlvbjogZmFsc2VcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zb2xlLmxvZyhcIklzc3VlIEJhbmsgY29udHJvbGxlciAhIVwiKTtcblxuICAgICAgICB2bS5jbGVhciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdm0ubGNEZXRhaWxzLmxjTnVtYmVyID0gXCJcIjtcbiAgICAgICAgICAgIHZtLmxjRGV0YWlscy5sY1ZhbHVlID0gXCJcIjtcbiAgICAgICAgICAgIHZtLmxjRGV0YWlscy5sY1Rlcm1zID0gXCJcIjtcbiAgICAgICAgICAgIHZtLmxjRGV0YWlscy5tZXNzYWdlID0gXCJcIjtcbiAgICAgICAgICAgICRzY29wZS5pc3N1ZUxjRm9ybSA9IFwiXCI7XG4gICAgICAgICAgICB2bS5sY0RldGFpbHMubGNGZWUgPSBcIlwiO1xuICAgICAgICAgICAgdm0ubGNEZXRhaWxzLmxjRG9jc1JlcXVpcmVkID0gXCJcIjtcbiAgICAgICAgICAgIHZtLmxjRGV0YWlscy5zaG93QWNjb3JkaW9uID0gZmFsc2U7XG4gICAgICAgICAgICB2bS5hY2NlcHRMY0Zvcm0ubGNOdW1iZXIuJHNldFZhbGlkaXR5KCdsY1VuaXF1ZScsIHRydWUpO1xuICAgICAgICAgICAgdm0uYWNjZXB0TGNGb3JtLiRzZXRQcmlzdGluZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgdm0uc3VibWl0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlN1Ym1pdCBmdW5jdGlvbiBjYWxsZWQhXCIpO1xuICAgICAgICAgICAgdmFyIG15Ym9keSA9IGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudCkuZmluZCgnYm9keScpO1xuICAgICAgICAgICAgbXlib2R5LmFkZENsYXNzKCd3YWl0aW5nJyk7XG4gICAgICAgICAgICB2YXIgbGNSZXF1ZXN0ID0ge1xuICAgICAgICAgICAgICAgIFwiY29udHJhY3RJRFwiOiAkc2NvcGUuaXNzdWVMY0Zvcm0uX2lkLFxuICAgICAgICAgICAgICAgIFwibGNOdW1iZXJcIjogdm0ubGNEZXRhaWxzLmxjTnVtYmVyLFxuICAgICAgICAgICAgICAgIFwibGNWYWx1ZVwiOiB2bS5sY0RldGFpbHMubGNWYWx1ZSxcbiAgICAgICAgICAgICAgICBcImxjVGVybXNcIjogdm0ubGNEZXRhaWxzLmxjVGVybXMsXG4gICAgICAgICAgICAgICAgXCJsY0ZlZVwiOiB2bS5sY0RldGFpbHMubGNGZWUsXG4gICAgICAgICAgICAgICAgXCJsY0RvY3NSZXF1aXJlZFwiOiB2bS5sY0RldGFpbHMubGNEb2NzUmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgXCJhZHZpc2luZ0JhbmtJZFwiOnZtLmxjRGV0YWlscy5hZHZpc2luZ0JhbmtJZFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIC8vIGRpc2FibGluZyBzdWJtaXQgYnV0dG9uXG4gICAgICAgICAgICB2bS5jbGVhcigpO1xuICAgICAgICAgICAgdm0ubGNEZXRhaWxzLm1lc3NhZ2UgPSBcIi0tLSBJc3N1ZSBMYyBJbiBQcm9ncmVzcywgUGxlYXNlIFdhaXQgLS0tXCI7XG4gICAgICAgICAgICBhcGlDYWxsXG4gICAgICAgICAgICAgICAgLm1ha2VDYWxsKFwiL2xjUmVxdWVzdC9zYXZlTGNGb3JtXCIsIFwicG9zdFwiLCBsY1JlcXVlc3QpXG4gICAgICAgICAgICAgICAgLnRoZW4oXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXNwb25zZS5zdGF0dXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImNhbGxpbmcgaW5pdCBhZ2FpbiB0byB1cGRhdGUgUE8gTnVtYmVyIGxpc3RcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5pbml0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5jbGVhcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbXlib2R5LnJlbW92ZUNsYXNzKCd3YWl0aW5nJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5sY0RldGFpbHMubWVzc2FnZSA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApXG4gICAgICAgIH1cblxuICAgICAgICB2bS5maWxlVmlldyA9IGZ1bmN0aW9uKGlzc3VlTGNGb3JtKSB7XG4gICAgICAgICAgICB2YXIgZmlsZU5hbWUgPSBpc3N1ZUxjRm9ybS5pbml0aWF0ZXJGaWxlTmFtZTtcbiAgICAgICAgICAgIHdpbmRvdy5vcGVuKFwiL3N0YXRpYy91cGxvYWRlZEZpbGVzL1wiICsgZmlsZU5hbWUsIFwiX2JsYW5rXCIpO1xuICAgICAgICB9XG4gICAgICAgIHZtLmNoYW5nZUxjRmVlID0gZnVuY3Rpb24obGNWYWx1ZSkge1xuICAgICAgICAgICAgLy8gdmFsdWU9XCJ7eyAoKHZtLmxjRGV0YWlscy5sY1ZhbHVlICogKGlzc3VlTGNGb3JtLmxjRHVyYXRpb24raXNzdWVMY0Zvcm0udXNhbmNlUGVyaW9kKSAqIDAuNzUpLzM2NSkgfCBudW1iZXI6M319XCJcbiAgICAgICAgICAgIHZhciBSYXRlUGVyY2VudCA9IDAuMDA3NTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGxjVmFsdWUpO1xuICAgICAgICAgICAgaWYgKGxjVmFsdWUgIT0gbnVsbCAmJiBsY1ZhbHVlICE9IFwiXCIgJiYgbGNWYWx1ZSAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkxDIGR1cmF0aW9uXCIgKyAkc2NvcGUuaXNzdWVMY0Zvcm0ubGNEdXJhdGlvbik7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJVc2FuY2UgUGVyaW9kXCIgKyAkc2NvcGUuaXNzdWVMY0Zvcm0udXNhbmNlUGVyaW9kKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkxDIFZhbHVlXCIgKyBsY1ZhbHVlKTtcbiAgICAgICAgICAgICAgICAvLyB2YXIgbGNGZWUgPSAobGNWYWx1ZSAqICgkc2NvcGUuaXNzdWVMY0Zvcm0ubGNEdXJhdGlvbiskc2NvcGUuaXNzdWVMY0Zvcm0udXNhbmNlUGVyaW9kKSAqIFJhdGVQZXJjZW50KSAvIDM2NTtcbiAgICAgICAgICAgICAgICAvKnZhciBsY0ZlZSA9IChsY1ZhbHVlICgxKygkc2NvcGUuaXNzdWVMY0Zvcm0udG9sZXJhbmNlUGVyY2VudC8xMDApKlJhdGVQZXJjZW50KSAqIE1hdGgucm91bmQoKCRzY29wZS5pc3N1ZUxjRm9ybS5sY0R1cmF0aW9uICsgJHNjb3BlLmlzc3VlTGNGb3JtLnVzYW5jZVBlcmlvZCArMSApLzMwKS8xMiAqICgxKy4xNCsuMDA1Ky4wMDUpO1xuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiTEMgRmVlc1wiICsgbGNGZWUpO1xuICAgICAgICAgICAgICAgIHZtLmxjRGV0YWlscy5sY0ZlZSA9IGxjRmVlLnRvRml4ZWQoMik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdm0ucHJlcG9wdWxhdGVMQ0RldGFpbHMgPSBmdW5jdGlvbihsY0RldGFpbHMpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGxjRGV0YWlscyk7XG4gICAgICAgICAgICB2bS5sY0RldGFpbHMuc2hvd0FjY29yZGlvbiA9IHRydWU7XG4gICAgICAgICAgICB2YXIgUmF0ZVBlcmNlbnQgPSAwLjAwNzU7XG4gICAgICAgICAgICBpZiAoJHNjb3BlLmlzc3VlTGNGb3JtICE9IFwiXCIgJiYgJHNjb3BlLmlzc3VlTGNGb3JtICE9IHVuZGVmaW5lZCAmJlxuICAgICAgICAgICAgICAgICRzY29wZS5pc3N1ZUxjRm9ybSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgLyp2bS5sY0RldGFpbHMubGNGZWUgPSAoKGxjRGV0YWlscy5wb1ZhbHVlICpcblx0XHRcdFx0XHRcdFx0XHRcdCgkc2NvcGUuaXNzdWVMY0Zvcm0ubGNEdXJhdGlvbiskc2NvcGUuaXNzdWVMY0Zvcm0udXNhbmNlUGVyaW9kKSAqXG5cdFx0XHRcdFx0XHRcdFx0XHRSYXRlUGVyY2VudCkgLyAzNjUpO1xuXHRcdFx0XHRcdFx0XHRcdFx0Ki9cblxuXG4gICAgICAgICAgICAgICAgdmFyIGxjRmVlXzEgPSBsY0RldGFpbHMucG9WYWx1ZSAqICgxICsgKCRzY29wZS5pc3N1ZUxjRm9ybS50b2xlcmFuY2VQZXJjZW50IC8gMTAwKSkgKiBSYXRlUGVyY2VudDtcbiAgICAgICAgICAgICAgICB2YXIgbGNGZWVfMiA9IE1hdGguY2VpbCgoJHNjb3BlLmlzc3VlTGNGb3JtLmxjRHVyYXRpb24gKyAkc2NvcGUuaXNzdWVMY0Zvcm0udXNhbmNlUGVyaW9kICsgMSkgLyAzMCk7XG4gICAgICAgICAgICAgICAgdm0ubGNEZXRhaWxzLmxjRmVlID0gKGxjRmVlXzEgKiBsY0ZlZV8yKSAvIDEyICogKDEgKyAuMTQgKyAuMDA1ICsgLjAwNSk7XG5cbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIj09PT09PT09TEMgRkVFID09PT09XCIgKyB2bS5sY0RldGFpbHMubGNGZWUpO1xuICAgICAgICAgICAgICAgIC8vIDEgTEMgY3JlYXRpb24gRmVlID0gWyhMQyBEdXJhdGlvbiArIFVzYW5jZSBQZXJpb2QpIHggUmF0ZSVdLzM2NVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0ubGNEZXRhaWxzLmxjVmFsdWUgPSBsY0RldGFpbHMucG9WYWx1ZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBQcmVwb3B1bGF0ZSBQTyBOdW1iZXJcbiAgICAgICAgdm0uaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJQcmVwb3B1bGF0ZSBpbml0IGZ1bmN0aW9uIGNhbGxlZCAhIVwiKTtcbiAgICAgICAgICAgIC8vIGdldCBQTyBudW1iZXIgZnJvbSBtb25nb1xuICAgICAgICAgICAgYXBpQ2FsbFxuICAgICAgICAgICAgICAgIC5tYWtlQ2FsbChcImxjUmVxdWVzdC9nZXRQb051bWJlcnNcIiwgXCJnZXRcIilcbiAgICAgICAgICAgICAgICAudGhlbihcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLnN0YXR1cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5sY1JlcXVlc3REZXRhaWxzID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwaUNhbGwubWFrZUNhbGwoXCJsY1JlcXVlc3QvZmV0Y2hBZHZCYW5rXCIsIFwiZ2V0XCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hZHZCYW5rcyA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIC50aGVuKCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgaWYoICRzdGF0ZVBhcmFtcy5hY3Rpb25JdGVtICE9IFwiXCIgJiYgJHN0YXRlUGFyYW1zLmFjdGlvbkl0ZW0gIT0gbnVsbCApe1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImFjdGlvbiBpdGVtIG5vdCBudWxsXCIpO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygkc3RhdGVQYXJhbXMuYWN0aW9uSXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCRzY29wZS5sY1JlcXVlc3REZXRhaWxzWzFdLnBvTnVtYmVyKTtcblxuICAgICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkUG9OdW1iZXIgPSAkc2NvcGUubGNSZXF1ZXN0RGV0YWlscy5maWx0ZXIoZnVuY3Rpb24oIGRhdGFPYmogKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoZGF0YU9iai5wb051bWJlciA9PSAkc3RhdGVQYXJhbXMuYWN0aW9uSXRlbSApIDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzc3VlTGNGb3JtID0gc2VsZWN0ZWRQb051bWJlclswXTtcbiAgICAgICAgICAgICAgICAgIC8vIHRvIHBvcHVsYXRlIGxjIGZlZSBhbmQgYW1vdW50XG4gICAgICAgICAgICAgICAgICB2bS5wcmVwb3B1bGF0ZUxDRGV0YWlscygkc2NvcGUuaXNzdWVMY0Zvcm0pO1xuICAgICAgICAgICAgICAgICAgJHN0YXRlUGFyYW1zLmFjdGlvbkl0ZW0gPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gc2VsZWN0IGFjdGl2ZSBib290c3RyYXAgdGFiXG4gICAgICAgIHZtLnNldFRhYiA9IGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICAgICAgICBpZiAoaW5kZXggPT0gJHJvb3RTY29wZS50YWJJZGVudGlmaWVyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiYWN0aXZlXCI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGNhbGxpbmcgb24gbG9hZCBvZiBwYWdlXG4gICAgICAgIHZtLmluaXQoKTtcblxuICAgICAgICAvLyBGdW5jdGlvbiB0byBjaGVjayBpZiBMQy9Eb2N1bWVudGFyeSBDcmVkaXQgTnVtYmVyIGlzIHVuaXF1ZSBmb3IgYSBpc3N1ZUJhbmtcbiAgICAgICAgdm0udmFsaWRhdGVMY051bWJlciA9IGZ1bmN0aW9uKGxjTnVtYmVyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInZhbGlkYXRpbmcgbGNOdW1iZXIgb24gYmx1clwiKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwibGNOdW1iZXIgaXMgOiBcIiArIGxjTnVtYmVyKTtcbiAgICAgICAgICAgIC8vIGVuY29kaW5nIHdoaWxlIHNlbmRpbmcgYXMgZ2V0IHF1ZXJ5IHBhcmFtZXRlclxuICAgICAgICAgICAgbGNOdW1iZXIgPSBlbmNvZGVVUklDb21wb25lbnQobGNOdW1iZXIpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJFbmNvZGluZyBsY051bWJlciBpcyA6IFwiICsgbGNOdW1iZXIpO1xuICAgICAgICAgICAgdmFyIGlzc3VpbmdCYW5rSWQgPSBhdXRoZW50aWNhdGlvbi5jdXJyZW50VXNlcigpLnVzZXJJZDtcbiAgICAgICAgICAgIGlmIChsY051bWJlciAhPSB1bmRlZmluZWQgJiYgbGNOdW1iZXIgIT0gXCJcIiAmJiBsY051bWJlciAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvbGNSZXF1ZXN0L3ZhbGlkYXRlTGNOdW1iZXIvJyArIGxjTnVtYmVyICsgJy8nICsgaXNzdWluZ0JhbmtJZCwge1xuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAnQmVhcmVyICcgKyBhdXRoZW50aWNhdGlvbi5nZXRUb2tlbigpXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgcG9OdW1iZXIgaXMgdW5pcXVlXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gJHNjb3BlLmNyZWF0ZUxjUmVxdWVzdEZvcm0ucG9OdW1iZXIuJHNldFZhbGlkaXR5KFwicG9VbmlxdWVcIix0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiBwb051bWJlciBhbHJlYWR5IGV4aXN0cyBpbiBEQlxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyLmRhdGEubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5hY2NlcHRMY0Zvcm0ubGNOdW1iZXIuJHNldFZhbGlkaXR5KFwibGNVbmlxdWVcIiwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gJHNjb3BlLmNyZWF0ZUxjUmVxdWVzdEZvcm0ucG9OdW1iZXIuJHNldFZhbGlkaXR5KFwicG9VbmlxdWVcIixmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdm0ucmVtb3ZlVW5pcXVlTXNnID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2bS5hY2NlcHRMY0Zvcm0ubGNOdW1iZXIuJHNldFZhbGlkaXR5KFwibGNVbmlxdWVcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAvLyAkc2NvcGUuY3JlYXRlTGNSZXF1ZXN0Rm9ybS5wb051bWJlci4kc2V0VmFsaWRpdHkoXCJwb1VuaXF1ZVwiLHRydWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgdm0ucG9wdWxhdGVBZHZpc2luZyA9IGZ1bmN0aW9uKGFkdkJhbmspIHtcbiAgICAgICAgICAgICRzY29wZS5pc3N1ZUxjRm9ybS5hZHZpc2luZ0JhbmtJZC5icmFuY2g9YWR2QmFuay5icmFuY2g7XG4gICAgICAgICAgICAkc2NvcGUuaXNzdWVMY0Zvcm0uYWR2aXNpbmdCYW5rSWQuYWRkcmVzcz1hZHZCYW5rLmFkZHJlc3M7XG4gICAgICAgICAgICB2bS5sY0RldGFpbHMuYWR2aXNpbmdCYW5rSWQ9YWR2QmFuay5faWQ7XG4gICAgICAgIH07XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdteUFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ2xvZ2luQ3RybCcsIGxvZ2luQ3RybCk7XHJcblxyXG4gICAgbG9naW5DdHJsLiRpbmplY3QgPSBbJyRzdGF0ZScsICdhdXRoZW50aWNhdGlvbiddO1xyXG5cclxuICAgIGZ1bmN0aW9uIGxvZ2luQ3RybCgkc3RhdGUsIGF1dGhlbnRpY2F0aW9uKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuXHJcbiAgICAgICAgaWYgKGF1dGhlbnRpY2F0aW9uLmlzTG9nZ2VkSW4oKSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhhdXRoZW50aWNhdGlvbi5nZXRUb2tlbigpKTtcclxuICAgICAgICAgICAgJHN0YXRlLmdvKCdob21lJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5jcmVkZW50aWFscyA9IHtcclxuICAgICAgICAgICAgZW1haWw6IFwiXCIsXHJcbiAgICAgICAgICAgIHBhc3N3b3JkOiBcIlwiXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uZXJyb3JNc2cgPSB7XHJcbiAgICAgICAgICAgIG1lc3NhZ2U6IFwiXCJcclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgdm0ubG9naW4gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgYXV0aGVudGljYXRpb25cclxuICAgICAgICAgICAgICAgIC5sb2dpbih2bS5jcmVkZW50aWFscylcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmVycm9yTXNnLm1lc3NhZ2UgPSByZXNwb25zZS5kYXRhLm1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnbG9naW4nKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ2hvbWUnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBpbiBjYXNlIEFuZ3VsYXIgc2VydmljZSBmYWlsZWRcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uKCkge1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdteUFwcCcpXG4gICAgICAgIC5jb250cm9sbGVyKCduYXZpZ2F0aW9uQ3RybCcsIG5hdmlnYXRpb25DdHJsKTtcblxuICAgIC8vVE9ETyAtIHJlbW92ZSBIVFRQIGFmdGVyIHRlc3QgLCB3ZSBzaG91bGQgbm90IG1ha2UgU2VydmljZSBjYWxscyBmcm9tIGhlcmVcbiAgICBuYXZpZ2F0aW9uQ3RybC4kaW5qZWN0ID0gWyckbG9jYXRpb24nLCAnYXV0aGVudGljYXRpb24nLCAnJHN0YXRlJywgJyRodHRwJyxcbiAgICAnJHJvb3RTY29wZSddO1xuXG4gICAgZnVuY3Rpb24gbmF2aWdhdGlvbkN0cmwoJGxvY2F0aW9uLCBhdXRoZW50aWNhdGlvbiwgJHN0YXRlLCAkaHR0cCxcbiAgICAgICRyb290U2NvcGUpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2bS5pc0xvZ2dlZEluID0gYXV0aGVudGljYXRpb24uaXNMb2dnZWRJbigpO1xuXG4gICAgICAgIHZtLmN1cnJlbnRVc2VyID0gYXV0aGVudGljYXRpb24uY3VycmVudFVzZXIoKTtcblxuICAgICAgICB2bS5yb2xlID0gYXV0aGVudGljYXRpb24ucm9sZSgpO1xuICAgICAgICBjb25zb2xlLmxvZyhcIkN1cnJlbnQgVXNlciBSb2xlczogPT4gXCIpO1xuICAgICAgICBjb25zb2xlLmxvZyh2bS5yb2xlKTtcblxuICAgICAgICB2bS5pZlJvbGVFeGlzdHMgPSBmdW5jdGlvbihyb2xlKXtcbiAgICAgICAgICB2YXIgcmVzdWx0ID0gdm0ucm9sZS5pbmRleE9mKHJvbGUpO1xuICAgICAgICAgIGlmKCByZXN1bHQgPT0gLTEgKXtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuXG4gICAgICAgIHZtLmxvZ291dCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgYXV0aGVudGljYXRpb25cbiAgICAgICAgICAgICAgICAubG9nb3V0KCk7XG4gICAgICAgICAgICAvLyAkc3RhdGUuZ28oJ2xvZ291dCcpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmluU3RhdGUgPSBmdW5jdGlvbihzdGF0ZSkge1xuICAgICAgICAgICAgcmV0dXJuICRzdGF0ZS5pcyhzdGF0ZSk7XG4gICAgICAgIH1cblxuICAgICAgICB2bS5kZXBsb3lDb250cmFjdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJGh0dHAuZ2V0KCcvZXRoL3NvY2tldCcsIHtcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICdCZWFyZXIgJyArIGF1dGhlbnRpY2F0aW9uLmdldFRva2VuKClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS50aGVuKFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcblxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICAgICAgdm0uc2V0VGFiSWRlbnRpZmllciA9IGZ1bmN0aW9uKGlkKXtcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcInJlYWNoZWQgdGFiIGlkZW50aWZpZXIgISFcIik7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2coaWQpO1xuICAgICAgICAgICRyb290U2NvcGUudGFiSWRlbnRpZmllciA9IGlkO1xuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCRyb290U2NvcGUudGFiSWRlbnRpZmllcik7XG4gICAgICAgIH1cbiAgICB9XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnbXlBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdpc3N1ZUZvcm1DdHJsJywgaXNzdWVGb3JtQ3RybCk7XHJcblxyXG4gICAgaXNzdWVGb3JtQ3RybC4kaW5qZWN0ID0gWyckc2NvcGUnLCckaHR0cCcsJ2F1dGhlbnRpY2F0aW9uJ107XHJcblxyXG4gICAgZnVuY3Rpb24gaXNzdWVGb3JtQ3RybCgkc2NvcGUsJGh0dHAsYXV0aGVudGljYXRpb24pIHtcclxuICAgICAgY29uc29sZS5sb2coXCJpbnNpZGUgSXNzdWVGb3JtIGNvbnRyb2xsZXJAQEBAQEBAQEBcIik7XHJcbiAgICAgIHZhciB2bT10aGlzO1xyXG4gICAgICAkaHR0cC5nZXQoJy9pc3N1aW5nRm9ybS9pc3N1ZScsIHtcclxuICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICdCZWFyZXIgJyArIGF1dGhlbnRpY2F0aW9uLmdldFRva2VuKClcclxuICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICRzY29wZS5wb0xpc3QgPSByZXNwb25zZS5kYXRhO1xyXG5cclxuICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhKTtcclxuXHJcblxyXG4gICAgICAgICAgICAgfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2Uuc3RhdHVzKTtcclxuICAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgICAgICB2bS5mZXRjaERldGFpbCA9IGZ1bmN0aW9uKGlkKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcG8gPSBpZC5wbztcclxuICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvaXNzdWluZ0Zvcm0vZmV0Y2hkZXRhaWwvJytwbywge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogJ0JlYXJlciAnICsgYXV0aGVudGljYXRpb24uZ2V0VG9rZW4oKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucG9EZXRhaWw9IHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLnN0YXR1cyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICB2bS5zdWJtaXQgPSBmdW5jdGlvbihpZCkge1xyXG4gICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRoZSBzdWJtaXQgY2FsbCB0byBzZXJ2aWNlXCIpO1xyXG4gICAgICAgICAgICAgICB2YXIgcG8gPSB7J3BvJzogaWQucG99O1xyXG4gICAgICAgICAgICAgICAgICRodHRwLnBvc3QoJy9pc3N1aW5nRm9ybS9zdWJtaXQvJyxwbywge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICdCZWFyZXIgJyArIGF1dGhlbnRpY2F0aW9uLmdldFRva2VuKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICRzY29wZS5tZXNzc2FnZT0gXCJXb3JrZmxvdyBjaGFuZ2VzIGRvbmVcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgIH1cclxuICAgIH0pKCk7XHJcbiIsIihmdW5jdGlvbigpIHtcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdteUFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ25vdGlmaWNhdGlvbkN0cmwnLCBub3RpZmljYXRpb25DdHJsKTtcclxuXHJcbiAgICBub3RpZmljYXRpb25DdHJsLiRpbmplY3QgPSBbJyRzY29wZScsICckaHR0cCcsICdhdXRoZW50aWNhdGlvbicsICckdGltZW91dCcsICckc3RhdGUnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBub3RpZmljYXRpb25DdHJsKCRzY29wZSwgJGh0dHAsIGF1dGhlbnRpY2F0aW9uLCAkdGltZW91dCwgJHN0YXRlKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS5zaG93QWNjb3JkaW9uID0gZmFsc2U7XHJcbiAgICAgICAgdm0ubGNEZXRhaWxzRW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgLy8gRU5VTVxyXG4gICAgICAgICRzY29wZS5ub3RpZmljYXRvaW5UZXh0ID0gW3tcclxuICAgICAgICAgICAgICAgIDk5OiBcIlN0YWdlICdJbml0aWF0ZSBMQyBSZXF1ZXN0J1tQTyMgezB9XTogUmVxdWVzdCBpbml0aWF0ZWQgYnkgezF9LiBGaWxlIC0gezN9IHVwbG9hZGVkIHN1Y2Nlc3NmdWxseS4gQmxvY2sgY2hhaW4gcHJvY2Vzc2luZyBjb21tZW5jZWQuXCJcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgMTAwOiBcIlN0YWdlICdJbml0aWF0ZSBMQyBSZXF1ZXN0J1tQTyMgezB9XTogQmxvY2sgY2hhaW4gcHJvY2Vzc2luZyBjb21wbGV0ZWQuIERvY3VtZW50cyBmb3J3YXJkZWQgdG8gaXNzdWluZyBiYW5rLiBSZXF1ZXN0IEluaXRpYXRpb24gY29tcGxldGUuIFwiXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIDE5OTogXCJTdGFnZSAnSXNzdWluZyBiYW5rIHZlcmlmaWNhdGlvbidbTEMjIHsyfV06IERvY3VtZW50cyByZXZpZXdlZCBhbmQgdmVyaWZpZWQuIEJsb2NrIGNoYWluIHByb2Nlc3NpbmcgY29tbWVuY2VkLiBcIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAyMDA6IFwiU3RhZ2UgJ0lzc3VpbmcgYmFuayB2ZXJpZmljYXRpb24nW0xDIyB7Mn1dOiBCbG9jayBjaGFpbiBwcm9jZXNzaW5nIGNvbXBsZXRlZC4gRG9jdW1lbnRzIGZvcndhcmRlZCB0byBBZHZpc2luZyBiYW5rLiBJc3N1aW5nIGJhbmsgdmVyaWZpY2F0aW9uIHN0YWdlIGNvbXBsZXRlLlwiXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIDI5OTogXCJTdGFnZSAnQWR2aXNpbmcgYmFuayB2ZXJpZmljYXRpb24nW0xDIyB7Mn1dOiBEb2N1bWVudHMgcmV2aWV3ZWQgYW5kIHZlcmlmaWVkLiBCbG9jayBjaGFpbiBwcm9jZXNzaW5nIGNvbW1lbmNlZC4gXCJcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgMzAwOiBcIlN0YWdlICdBZHZpc2luZyBiYW5rIHZlcmlmaWNhdGlvbidbTEMjIHsyfV06IEJsb2NrIGNoYWluIHByb2Nlc3NpbmcgY29tcGxldGVkLiBEb2N1bWVudHMgZm9yd2FyZGVkIHRvIGJlbmVmaWNpYXJ5LiBBZHZpc2luZyBiYW5rIHZlcmlmaWNhdGlvbiBzdGFnZSBjb21wbGV0ZS5cIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAzOTk6IFwiU3RhZ2UgJ0JlbmVmaWNpYXJ5IHByb29mIHN1Ym1pc3Npb24nW0xDIyB7Mn1dOiBMQyBkb2N1bWVudHMgcmV2aWV3ZWQgYnkgYmVuZWZpY2lhcnkuIEJpbGwgYW5kIFByb29mIGRvY3VtZW50cyB1cGxvYWRlZCBzdWNjZXNzZnVsbHkuICBCbG9jayBjaGFpbiBwcm9jZXNzaW5nIGNvbW1lbmNlZC5cIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICA0MDA6IFwiU3RhZ2UgJ0JlbmVmaWNpYXJ5IHByb29mIHN1Ym1pc3Npb24nIFtMQyMgezJ9XTogQmxvY2sgY2hhaW4gcHJvY2Vzc2luZyBjb21wbGV0ZWQuIEJpbGwgYW5kIFByb29mIGRvY3VtZW50cyBmb3J3YXJkZWQgdG8gUHJlc2VudGluZyBiYW5rLiBCZW5lZmljaWFyeSBwcm9vZiBzdWJtaXNzaW9uIHN0YWdlIGNvbXBsZXRlLlwiXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIDQ5OTogXCJTdGFnZSAnUHJlc2VudGluZyBiYW5rIHZlcmlmaWNhdGlvbidbTEMjIHsyfV06IEJpbGwgYW5kIFByb29mIGRvY3VtZW50cyByZXZpZXdlZCBhbmQgdmVyaWZpZWQuIEJsb2NrIGNoYWluIHByb2Nlc3NpbmcgY29tbWVuY2VkLlwiXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIDUwMDogXCJTdGFnZSAnUHJlc2VudGluZyBiYW5rIHZlcmlmaWNhdGlvbidbTEMjIHsyfV06IEJsb2NrIGNoYWluIHByb2Nlc3NpbmcgY29tcGxldGVkLiBCaWxsIGFuZCBQcm9vZiBkb2N1bWVudHMgZm9yd2FyZGVkIHRvIElzc3VpbmcgYmFuay4gUHJlc2VudGluZyBiYW5rIHZlcmlmaWNhdGlvbiBzdGFnZSBjb21wbGV0ZS5cIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICA1OTk6IFwiU3RhZ2UgJ0lzc3VpbmcgYmFuayBMb2RnZW1lbnQnW0xDIyB7Mn1dOiBCaWxsIGFuZCBQcm9vZiBkb2N1bWVudHMgcmV2aWV3ZWQgYW5kIHZlcmlmaWVkLiBMQyBhbW91bnQgcmVsZWFzZWQgdG8gUHJlc2VudGluZyBiYW5rLiBCbG9jayBjaGFpbiBwcm9jZXNzaW5nIGNvbW1lbmNlZC4gXCJcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgNjAwOiBcIlN0YWdlICdJc3N1aW5nIGJhbmsgTG9kZ2VtZW50J1tMQyMgezJ9XTogQmxvY2sgY2hhaW4gcHJvY2Vzc2luZyBjb21wbGV0ZWQuIEJpbGwgYW5kIFByb29mIGRvY3VtZW50cyBsb2RnZWQuIExDIGFtb3VudCB0cmFuc2ZlcnJlZC4gSXNzdWluZyBiYW5rIExvZGdlbWVudCBzdGFnZSBjb21wbGV0ZS5cIlxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgXTtcclxuXHJcblxyXG5cclxuICAgICAgICAkc2NvcGUucmVsb2FkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRodHRwLmdldCgnL25vdGlmaWNhdGlvbi9MQ0RldGFpbHMnLCB7XHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogJ0JlYXJlciAnICsgYXV0aGVudGljYXRpb24uZ2V0VG9rZW4oKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIm5vdGlmaWNhdGlvbiBjb250cm9sbGVyXCIpO1xyXG4gICAgICAgICAgICAgICAgdm0ubm90aWZpY2F0aW9ucyA9IHJlc3BvbnNlLmRhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgdm0ud29ya0Zsb3dzU2VnID0gW107XHJcbiAgICAgICAgICAgICAgICB2YXIgcG9OdW1iZXJzID0gW107XHJcbiAgICAgICAgICAgICAgICB2YXIgd29ya0Zsb3dzID0gW107XHJcbiAgICAgICAgICAgICAgICB2YXIgd29ya0Zsb3dzU2VnID0gW107XHJcbiAgICAgICAgICAgICAgICB2YXIgbXlNYXAgPSBuZXcgTWFwKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgZmlyc3QgPSAxO1xyXG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gLTE7XHJcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChyZXNwb25zZS5kYXRhLCBmdW5jdGlvbihpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGl0ZW0ud29ya2Zsb3dzLCBmdW5jdGlvbih3b3JrZmxvdykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2cod29ya2Zsb3cpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGVUb1NldCA9IG5ldyBEYXRlKHdvcmtmbG93LmNyZWF0ZWREYXRlVVRDKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRpbWVUb1NldCA9IGRhdGVUb1NldC5nZXRUaW1lKCk7IC8vICsgZGF0ZVRvU2V0LmdldFRpbWV6b25lT2Zmc2V0KCkqNjAqMTAwMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBteU1hcC5nZXQodGltZVRvU2V0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGltZVNlZ3JlZ2F0aW9uID0gbXlNYXAuZ2V0KHRpbWVUb1NldCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGltZVNlZ3JlZ2F0aW9uMSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZVNlZ3JlZ2F0aW9uMS50cmFuc2FjdGlvbkRUID0gd29ya2Zsb3cuY3JlYXRlZERhdGVVVEM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lU2VncmVnYXRpb24xLmZpbGVOYW1lID0gaXRlbS5pbml0aWF0ZXJGaWxlTmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVTZWdyZWdhdGlvbjEuc3RhZ2UgPSB3b3JrZmxvdy5zdGFnZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVTZWdyZWdhdGlvbjEucG9OdW1iZXJzID0gaXRlbS5wb051bWJlcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVTZWdyZWdhdGlvbjEubGNOdW1iZXIgPSBpdGVtLmxjTnVtYmVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZVNlZ3JlZ2F0aW9uMS5idXllck5hbWUgPSBpdGVtLmJ1eWVySWQubmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVTZWdyZWdhdGlvbjEudGltZVN0YW1wID0gd29ya2Zsb3cuY3JlYXRlZERhdGVVVEM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lU2VncmVnYXRpb24xLm9mZlNldCA9IHRpbWVUb1NldDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVTZWdyZWdhdGlvbjEudHJhbnNhY3Rpb25IYXNoID0gd29ya2Zsb3cudHJhbnNhY3Rpb25IYXNoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZVNlZ3JlZ2F0aW9uLnB1c2godGltZVNlZ3JlZ2F0aW9uMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBteU1hcC5zZXQodGltZVRvU2V0LCB0aW1lU2VncmVnYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRpbWVTZWdyZWdhdGlvbiA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZVNlZ3JlZ2F0aW9uLnRyYW5zYWN0aW9uRFQgPSB3b3JrZmxvdy5jcmVhdGVkRGF0ZVVUQztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVTZWdyZWdhdGlvbi5maWxlTmFtZSA9IGl0ZW0uaW5pdGlhdGVyRmlsZU5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lU2VncmVnYXRpb24uc3RhZ2UgPSB3b3JrZmxvdy5zdGFnZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVTZWdyZWdhdGlvbi5wb051bWJlcnMgPSBpdGVtLnBvTnVtYmVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZVNlZ3JlZ2F0aW9uLmxjTnVtYmVyID0gaXRlbS5sY051bWJlcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVTZWdyZWdhdGlvbi5idXllck5hbWUgPSBpdGVtLmJ1eWVySWQubmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVTZWdyZWdhdGlvbi50aW1lU3RhbXAgPSB3b3JrZmxvdy5jcmVhdGVkRGF0ZVVUQztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVTZWdyZWdhdGlvbi5vZmZTZXQgPSB0aW1lVG9TZXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lU2VncmVnYXRpb24udHJhbnNhY3Rpb25IYXNoID0gd29ya2Zsb3cudHJhbnNhY3Rpb25IYXNoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbXlNYXAuc2V0KHRpbWVUb1NldCwgdGltZVNlZ3JlZ2F0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2VsZiBjb2RlIGZvciBDcmVhdGluZyBBcnJheVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLyogIHZhciBkYXRlVG9TZXQxID0gbmV3IERhdGUod29ya2Zsb3cuY3JlYXRlZERhdGVVVEMpO1xyXG4gICAgICAgICAgICAgICAgICB2YXIgdGltZVRvU2V0MSA9IGRhdGVUb1NldDEuZ2V0VGltZSgpIDsgLy8rIGRhdGVUb1NldDEuZ2V0VGltZXpvbmVPZmZzZXQoKSo2MCoxMDAwO1xyXG4gICAgICAgICAgICAgICAgICB2YXIgdHltU3RhbXAgPSB0aW1lVG9TZXQxO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IC0xO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaXJzdCA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0ID0gMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJmaXJzdCB0aW1lIFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNhbWVUaW1lID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRlVG9TZXQyID0gbmV3IERhdGUod29ya2Zsb3cuY3JlYXRlZERhdGVVVEMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGltZVRvU2V0MiA9IGRhdGVUb1NldDIuZ2V0VGltZSgpIDsvLysgZGF0ZVRvU2V0Mi5nZXRUaW1lem9uZU9mZnNldCgpKjYwKjEwMDA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzYW1lVGltZS5wb051bWJlciA9IGl0ZW0ucG9OdW1iZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNhbWVUaW1lLnN0YWdlID0gd29ya2Zsb3cuc3RhZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNhbWVUaW1lLnRpbWVTdGFtcCA9IHdvcmtmbG93LmNyZWF0ZWREYXRlVVRDO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzYW1lVGltZS5vZmZTZXQgPSB0aW1lVG9TZXQyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzYW1lVGltZS5maWxlTmFtZT0gaXRlbS5pbml0aWF0ZXJGaWxlTmFtZTtcclxuXHRcdFx0XHRcdFx0c2FtZVRpbWUubGNOdW1iZXI9IGl0ZW0ubGNOdW1iZXI7XHJcblx0XHRcdFx0XHRcdHNhbWVUaW1lLmJ1eWVyTmFtZT0gaXRlbS5idXllcklkLm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvTnVtYmVycy5wdXNoKHNhbWVUaW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcG9OdW1iZXJzLnRpbWVTdGFtcCA9IHRpbWVUb1NldDI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAvLyAgcG9OdW1iZXJzLnRpbWVTdGFtcCA9IHdvcmtmbG93LmNyZWF0ZWREYXRlVVRDO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3b3JrRmxvd3NTZWcucG9OdW1iZXJzID0gcG9OdW1iZXJzO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVGhlIHNlY29uZCB0aW1lIGFuZCBvbiBcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh3b3JrRmxvd3NTZWcucG9OdW1iZXJzLCBmdW5jdGlvbihwb051bWJlcikge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0ZVRvU2V0NCA9IG5ldyBEYXRlKHBvTnVtYmVyLnRpbWVTdGFtcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlZFR5bSA9IGRhdGVUb1NldDQuZ2V0VGltZSgpIDsvLysgZGF0ZVRvU2V0NC5nZXRUaW1lem9uZU9mZnNldCgpKjYwKjEwMDA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIC8vICB2YXIgc3RvcmVkVHltID0gcG9OdW1iZXIudGltZVN0YW1wO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0b3JlZFR5bSA9PSB0eW1TdGFtcCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2FtZVRpbWUgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYW1lVGltZS5wb051bWJlciA9IGl0ZW0ucG9OdW1iZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FtZVRpbWUuc3RhZ2UgPSB3b3JrZmxvdy5zdGFnZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYW1lVGltZS50aW1lU3RhbXAgPSB3b3JrZmxvdy5jcmVhdGVkRGF0ZVVUQztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYW1lVGltZS5maWxlTmFtZT0gaXRlbS5pbml0aWF0ZXJGaWxlTmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYW1lVGltZS5vZmZTZXQgPSBzdG9yZWRUeW07XHJcblx0XHRcdFx0XHRcdFx0XHRzYW1lVGltZS5sY051bWJlcj0gaXRlbS5sY051bWJlcjtcclxuXHRcdFx0XHRcdFx0XHRcdHNhbWVUaW1lLmJ1eWVyTmFtZT0gaXRlbS5idXllcklkLm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9OdW1iZXIucHVzaChzYW1lVGltZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzYW1lVGltZSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGVUb1NldCA9IG5ldyBEYXRlKHdvcmtmbG93LmNyZWF0ZWREYXRlVVRDKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0aW1lVG9TZXQgPSBkYXRlVG9TZXQuZ2V0VGltZSgpIDsvLysgZGF0ZVRvU2V0LmdldFRpbWV6b25lT2Zmc2V0KCkqNjAqMTAwMDtcclxuXHRcdFx0XHRcdFx0XHRzYW1lVGltZS5wb051bWJlciA9IGl0ZW0ucG9OdW1iZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYW1lVGltZS5zdGFnZSA9IHdvcmtmbG93LnN0YWdlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FtZVRpbWUudGltZVN0YW1wID0gd29ya2Zsb3cuY3JlYXRlZERhdGVVVEM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYW1lVGltZS5maWxlTmFtZT0gaXRlbS5pbml0aWF0ZXJGaWxlTmFtZTtcclxuXHRcdFx0XHRcdFx0XHRzYW1lVGltZS5sY051bWJlcj0gaXRlbS5sY051bWJlcjtcclxuXHRcdFx0XHRcdFx0XHRzYW1lVGltZS5idXllck5hbWU9IGl0ZW0uYnV5ZXJJZC5uYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FtZVRpbWUub2ZmU2V0ID0gdGltZVRvU2V0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9OdW1iZXJzLnB1c2goc2FtZVRpbWUpO1xyXG5cdFx0XHRcdFx0XHRcdHBvTnVtYmVycy50aW1lU3RhbXAgPSB0aW1lVG9TZXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3BvTnVtYmVycy50aW1lU3RhbXAgPSB3b3JrZmxvdy5jcmVhdGVkRGF0ZVVUQztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmtGbG93c1NlZy5wb051bWJlcnMgPSBwb051bWJlcnM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblx0XHRcdFx0XHQqL1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAvKlxyXG4gICAgICAgICAgICAkc2NvcGUubm90aWZpY2F0aW9uRW50cmllcyA9IHdvcmtGbG93c1NlZy5wb051bWJlcnMuc29ydChmdW5jdGlvbsKgKGEswqBiKcKge1xyXG5cdFx0XHRcdMKgwqByZXR1cm7CoGIub2ZmU2V0wqAtwqBhLm9mZlNldDtcclxuXHRcdFx0fSk7XHJcblx0XHRcdCovXHJcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhteU1hcCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWFwRGVzYyA9IG5ldyBNYXAoWy4uLm15TWFwLmVudHJpZXMoKV0uc29ydCgpLnJldmVyc2UoKSk7XHJcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIlNvcnJ0ZWQgLS0tLS0tXCIpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm5vdGlmaWNhdGlvbkVudHJpZXMgPSBBcnJheS5mcm9tKG1hcERlc2MpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJHNjb3BlLm5vdGlmaWNhdGlvbkVudHJpZXMpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2Uuc3RhdHVzKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIC8vIGVuZCBodHRwIGdldFxyXG4gICAgICAgICAgICB0aW1lb3V0SWQgPSAkdGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5yZWxvYWQoKTtcclxuICAgICAgICAgICAgfSwgNTAwMClcclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS5yZWxvYWQoKTtcclxuXHJcbiAgICAgICAgJHNjb3BlLiRvbihcIiRkZXN0cm95XCIsIGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICR0aW1lb3V0LmNhbmNlbCh0aW1lb3V0SWQpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB2bS50b1RpbWVzdGFtcCA9IGZ1bmN0aW9uKHRpbWVPYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKHRpbWVPYmopLmdldFRpbWUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnNob3dMQ0RldGFpbCA9IGZ1bmN0aW9uKGxjRGV0YWlscykge1xyXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcImxjTnVtYmVyIGlzXCIgKyBsY0RldGFpbHMubGNOdW1iZXIpO1xyXG4gICAgICAgICAgICB2bS5zaG93QWNjb3JkaW9uID0gdHJ1ZTtcclxuICAgICAgICAgICAgdm0ubGNEZXRhaWxzRW5hYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJHNjb3BlLnJhbmdlID0gZnVuY3Rpb24obWluLCBtYXgsIHN0ZXApIHtcclxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJtYXg9XCIgKyBtYXgpO1xyXG4gICAgICAgICAgICBzdGVwID0gc3RlcCB8fCAxO1xyXG4gICAgICAgICAgICB2YXIgaW5wdXQgPSBbXTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IG1pbjsgaSA8PSBtYXg7IGkgKz0gc3RlcCkge1xyXG4gICAgICAgICAgICAgICAgaW5wdXQucHVzaChpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gaW5wdXQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcblxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdteUFwcCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdwcmVzZW50aW5nQ3RybCcsIHByZXNlbnRpbmdDdHJsKTtcblxuICAgIHByZXNlbnRpbmdDdHJsLiRpbmplY3QgPSBbJyRzY29wZScsJyRodHRwJywnYXV0aGVudGljYXRpb24nLCckcm9vdFNjb3BlJywnJHdpbmRvdycsJyRzdGF0ZScsJyRzdGF0ZVBhcmFtcyddO1xuXG4gICAgZnVuY3Rpb24gcHJlc2VudGluZ0N0cmwoJHNjb3BlLCRodHRwLGF1dGhlbnRpY2F0aW9uLCAkcm9vdFNjb3BlLCR3aW5kb3csJHN0YXRlLCRzdGF0ZVBhcmFtcykge1xuXHRcdGNvbnNvbGUubG9nKFwiaW5zaWRlIHByZXNlbnRpbmdDdHJsLTExMTFcIilcblx0ICB2YXIgdm0gPSB0aGlzO1xuICAgICAgIHZtLmluaXQgPSBmdW5jdGlvbigpe1xuXHQgICAgICRodHRwLmdldCgnL3ByZXNlbnRpbmcvbGNEZXRhaWxzLycsIHtcblx0XHRcdCBoZWFkZXJzOiB7XG5cdFx0XHRcdCBBdXRob3JpemF0aW9uOiAnQmVhcmVyICcgKyBhdXRoZW50aWNhdGlvbi5nZXRUb2tlbigpXG5cdFx0XHQgfVxuXHRcdCB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cdFx0XHQkc2NvcGUuYWNwdExkZ21lbnRMQ0xpc3QgPSByZXNwb25zZS5kYXRhO1xuXHRcdFx0Y29uc29sZS5sb2coJHNjb3BlLmFjcHRMZGdtZW50TENMaXN0KTtcblx0XHQgfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdCAgIHZhciB1c2VyID0gYXV0aGVudGljYXRpb24uY3VycmVudFVzZXIoKTtcblx0XHRcdCAgIGlmKHVzZXIucm9sZSE9NTAwKSB7XG5cdFx0XHRcdCAgICRzY29wZS5lcnJvck1zZyA9IFwiTm90IHRoZSBjb3JyZWN0IHJvbGUgcmVxdWlyZWRcIjtcblx0XHRcdFx0ICAgJHN0YXRlLmdvKCdob21lJyk7XG5cdFx0XHQgICB9XG5cdFx0XHQgfSlcbiAgICAgICAudGhlbiggZnVuY3Rpb24oKXtcbiAgICAgICAgIGlmKCAkc3RhdGVQYXJhbXMuYWN0aW9uSXRlbSAhPSBcIlwiICYmICRzdGF0ZVBhcmFtcy5hY3Rpb25JdGVtICE9IG51bGwgKXtcbiAgICAgICAgICAgY29uc29sZS5sb2coXCJhY3Rpb24gaXRlbSBub3QgbnVsbFwiKTtcbiAgICAgICAgICAgY29uc29sZS5sb2coJHN0YXRlUGFyYW1zLmFjdGlvbkl0ZW0pO1xuXG4gICAgICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5hY3B0TGRnbWVudExDTGlzdCk7XG4gICAgICAgICB2YXIgc2VsZWN0ZWRMY051bWJlciA9ICRzY29wZS5hY3B0TGRnbWVudExDTGlzdC5maWx0ZXIoZnVuY3Rpb24oIGRhdGFPYmogKSB7XG4gICAgICAgICAgICAgICAgIHJldHVybiAoZGF0YU9iai5sY051bWJlciA9PSAkc3RhdGVQYXJhbXMuYWN0aW9uSXRlbSApIDtcbiAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgJHNjb3BlLmFjcHRMZGdtZW50Rm9ybURldGFpbHMgPSBzZWxlY3RlZExjTnVtYmVyWzBdO1xuICAgICAgICAgdm0uc2hvd0FjY29yZGlvbiA9IHRydWU7XG4gICAgICAgICAkc3RhdGVQYXJhbXMuYWN0aW9uSXRlbSA9IFwiXCI7XG4gICAgICAgICB9XG4gICAgICAgfSk7XG5cdCAgIH1cblxuXHQgIC8qIGZ1bmN0aW9uIHRvIGVuYWJsZSBBY2NvcmRpYW4gb24gc2VsZWN0aW9uIG9mIExDIE51bWJlciBvbiB0aGUgSFRNTCBwYWdlICovXG5cdCAgdm0uZmV0Y2hEZXRhaWwgPSBmdW5jdGlvbihsY0RldGFpbHMpe1xuICAgICAgaWYoIGxjRGV0YWlscyAhPSBudWxsICYmIGxjRGV0YWlscyAhPSBcIlwiKXtcbiAgICAgICAgdm0uc2hvd0FjY29yZGlvbiA9IHRydWU7XG4gICAgICB9XG5cdCAgfVxuXG5cblx0ICAvKiBGdW5jdGlvbiB0byBjbGVhciB0aGUgZmllbGRzIG9uIHJlc2V0IGJ1dHRvbiAqL1xuXHQgIHZtLmNsZWFyID0gZnVuY3Rpb24oKXtcblx0XHRcdGNvbnNvbGUubG9nKFwiY2xlYXIgYWxsIGZpZWxkcyBpbnNpZGUgYWNjZXB0TG9kZ2VtZW50U2VydmljZS0yXCIpO1xuXHRcdCAgIGlmKCAkc2NvcGUuYWNwdExkZ21lbnRGb3JtRGV0YWlscyAhPSBcIlwiICYmICRzY29wZS5hY3B0TGRnbWVudEZvcm1EZXRhaWxzICE9IHVuZGVmaW5lZFxuICAgICAgICAgICYmICRzY29wZS5hY3B0TGRnbWVudEZvcm1EZXRhaWxzICE9IG51bGwgKXtcblx0XHRcdCAgY29uc29sZS5sb2coXCJjbGVhcmluZyBhbGwgZmllbGRzXCIpO1xuXHRcdFx0ICAkc2NvcGUuYWNwdExkZ21lbnRGb3JtRGV0YWlscyA9IFwiXCI7XG5cdFx0XHQgIHZtLnNob3dBY2NvcmRpb249ZmFsc2U7XG4gICAgICAgICRzY29wZS5kaXNwbGF5TWVzc2FnZT1cIlwiO1xuXHRcdCAgfVxuXG5cdCAgfVxuXG5cdCAgLyogRnVuY3Rpb24gdG8gU2F2ZSB0aGUgQWR2aXNpbmcgYmFuayBzY3JlZW4gZGV0YWlscyAqL1xuXHQgIHZtLnN1Ym1pdCA9IGZ1bmN0aW9uKGxjRGV0YWlscyl7XG5cdFx0ICBjb25zb2xlLmxvZyhcImluc2lkZSBhY2NlcHRMb2RnZW1lbnRDb250cm9sbGVyLT5zdWJtaXQoKVwiKTtcblx0XHQgIGNvbnNvbGUubG9nKFwiY29udHJhY3RJRD1cIitsY0RldGFpbHMuX2lkKTtcblx0XHQgIHZhciBjb250cmFjdElEID0geydjb250cmFjdElEJzogbGNEZXRhaWxzLl9pZH07XG5cdFx0ICAgJGh0dHAucG9zdCgnL3ByZXNlbnRpbmcvYWNjZXB0TEMnLGNvbnRyYWN0SUQsIHtcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICdCZWFyZXIgJyArIGF1dGhlbnRpY2F0aW9uLmdldFRva2VuKClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS50aGVuKFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICBcdFx0XHQgICAgICB2bS5pbml0KCk7XG4gIFx0XHRcdCAgICAgICAgICAkc2NvcGUuZGlzcGxheU1lc3NhZ2U9XCJEb2N1bWVudHMgVmVyaWZpZWQgYW5kIFN1Ym1pdHRlZCBGb3IgQmxvY2tjaGFpbiBQcm9jZXNzaW5nXCI7XG4gICAgICAgICAgICBcdFx0XHR2bS5zaG93QWNjb3JkaW9uID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH0pO1xuXHRcdH1cblxuXHQgIHZtLnNldFRhYiA9IGZ1bmN0aW9uKGluZGV4KXtcbiAgICAgICAgaWYoIGluZGV4ID09ICRyb290U2NvcGUudGFiSWRlbnRpZmllciApe1xuICAgICAgICAgIHJldHVybiBcImFjdGl2ZVwiO1xuICAgICAgICB9XG4gICAgICAgIGVsc2V7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG5cdCAgdm0uaW5pdCgpO1xuICAgIH1cbn0pKCk7XG4iLCJhbmd1bGFyLm1vZHVsZShcIm15QXBwXCIpLmRpcmVjdGl2ZShcImZvb3RlclwiLCBmdW5jdGlvbigpIHtcclxuICByZXR1cm4ge1xyXG4gICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgIHRlbXBsYXRlVXJsOiAncGFydGlhbHMvZm9vdGVyLmh0bWwnLFxyXG4gICAgc2NvcGU6IHRydWUsXHJcbiAgICB0cmFuc2NsdWRlIDogZmFsc2UsXHJcbiAgICBjb250cm9sbGVyOiAnRm9vdGVyQ29udHJvbGxlcidcclxuICB9O1xyXG59KTsiLCIoZnVuY3Rpb24oKSB7XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnbXlBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdzaWduVXBDdHJsJywgc2lnblVwQ3RybCk7XHJcblxyXG4gICAgc2lnblVwQ3RybC4kaW5qZWN0ID0gWyckc3RhdGUnLCAnYXV0aGVudGljYXRpb24nXTtcclxuXHJcbiAgICBmdW5jdGlvbiBzaWduVXBDdHJsKCRzdGF0ZSwgYXV0aGVudGljYXRpb24pIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLmNyZWRlbnRpYWxzID0ge1xyXG4gICAgICAgICAgICBuYW1lOiBcIlwiLFxyXG4gICAgICAgICAgICBlbWFpbDogXCJcIixcclxuICAgICAgICAgICAgcGFzc3dvcmQ6IFwiXCIsXHJcbiAgICAgICAgICAgIGFkZHJlc3M6IFwiXCIsXHJcbiAgICAgICAgICAgIHJvbGU6IFwiXCJcclxuICAgICAgICB9O1xyXG4gICAgICAgIHZtLmVycm9yTXNnID0ge1xyXG4gICAgICAgICAgICBtZXNzYWdlOiBcIlwiXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2bS5zdWJtaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgYXV0aGVudGljYXRpb25cclxuICAgICAgICAgICAgICAgIC5yZWdpc3Rlcih2bS5jcmVkZW50aWFscylcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmVycm9yTXNnLm1lc3NhZ2UgPSByZXNwb25zZS5kYXRhLm1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnc2lnbnVwJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdob21lJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkluIEVycm9yIG9mIHRoZSBBbmd1bGFyIFNlcnZpY2UgQ2FsbFwiKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmNsZWFyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZtLmNyZWRlbnRpYWxzID0ge1xyXG4gICAgICAgICAgICAgICAgbmFtZTogXCJcIixcclxuICAgICAgICAgICAgICAgIGVtYWlsOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICByb2xlOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgYWRkcmVzczogXCJcIlxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uKCkge1xuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnbXlBcHAnKVxuICAgICAgICAuY29udHJvbGxlcignYWR2aXNpbmdCYW5rQ3RybCcsIGFkdmlzaW5nQmFua0N0cmwpO1xuXG4gICAgYWR2aXNpbmdCYW5rQ3RybC4kaW5qZWN0ID0gWyckc2NvcGUnLCckaHR0cCcsJ2F1dGhlbnRpY2F0aW9uJywnJHJvb3RTY29wZScsJyR3aW5kb3cnLCckc3RhdGUnLCckc3RhdGVQYXJhbXMnXTtcblxuICAgIGZ1bmN0aW9uIGFkdmlzaW5nQmFua0N0cmwoJHNjb3BlLCRodHRwLGF1dGhlbnRpY2F0aW9uLCAkcm9vdFNjb3BlLCR3aW5kb3csJHN0YXRlLCRzdGF0ZVBhcmFtcykge1xuXHQgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgdm0uaW5pdCA9IGZ1bmN0aW9uKCl7XG5cdCAgICAgJGh0dHAuZ2V0KCcvYWR2QmFuay9sY0RldGFpbHMnLCB7XG5cdFx0XHQgaGVhZGVyczoge1xuXHRcdFx0XHQgQXV0aG9yaXphdGlvbjogJ0JlYXJlciAnICsgYXV0aGVudGljYXRpb24uZ2V0VG9rZW4oKVxuXHRcdFx0IH1cblx0XHQgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuXHQgICAgICAgICRzY29wZS5hZHZCYW5rTENMaXN0ID0gcmVzcG9uc2UuZGF0YTtcblx0XHQgfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdCAgIHZhciB1c2VyID0gYXV0aGVudGljYXRpb24uY3VycmVudFVzZXIoKTtcblx0XHRcdCAgIGlmKHVzZXIucm9sZSE9MzAwKSB7XG5cdFx0XHRcdCAgICRzY29wZS5lcnJvck1zZyA9IFwiTm90IHRoZSBjb3JyZWN0IHJvbGVcIjtcblx0XHRcdFx0ICAgJHN0YXRlLmdvKCdob21lJyk7XG5cdFx0XHQgICB9XG5cdFx0XHQgfSlcbiAgICAgICAudGhlbiggZnVuY3Rpb24oKXtcbiAgICAgICAgIGlmKCAkc3RhdGVQYXJhbXMuYWN0aW9uSXRlbSAhPSBcIlwiICYmICRzdGF0ZVBhcmFtcy5hY3Rpb25JdGVtICE9IG51bGwgKXtcbiAgICAgICAgICAgY29uc29sZS5sb2coXCJhY3Rpb24gaXRlbSBub3QgbnVsbFwiKTtcbiAgICAgICAgICAgY29uc29sZS5sb2coJHN0YXRlUGFyYW1zLmFjdGlvbkl0ZW0pO1xuXG4gICAgICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5hZHZCYW5rTENMaXN0KTtcbiAgICAgICAgIHZhciBzZWxlY3RlZExjTnVtYmVyID0gJHNjb3BlLmFkdkJhbmtMQ0xpc3QuZmlsdGVyKGZ1bmN0aW9uKCBkYXRhT2JqICkge1xuICAgICAgICAgICAgICAgICByZXR1cm4gKGRhdGFPYmoubGNOdW1iZXIgPT0gJHN0YXRlUGFyYW1zLmFjdGlvbkl0ZW0gKSA7XG4gICAgICAgICAgICAgICB9KTtcbiAgICAgICAgIGNvbnNvbGUubG9nKHNlbGVjdGVkTGNOdW1iZXJbMF0pO1xuICAgICAgICAgJHNjb3BlLmFkdkJhbmtGb3JtRGV0YWlscyA9IHNlbGVjdGVkTGNOdW1iZXJbMF07XG4gICAgICAgICB2bS5zaG93QWNjb3JkaW9uID0gdHJ1ZTtcbiAgICAgICAgICRzdGF0ZVBhcmFtcy5hY3Rpb25JdGVtID0gXCJcIjtcbiAgICAgICAgIH1cbiAgICAgICB9KTtcblx0ICAgfVxuXG5cdCAgdm0uZmV0Y2hEZXRhaWwgPSBmdW5jdGlvbihsY0RldGFpbHMpe1xuICAgICAgaWYoIGxjRGV0YWlscyAhPSBudWxsICYmIGxjRGV0YWlscyAhPSBcIlwiKXtcbiAgICAgICAgdm0uc2hvd0FjY29yZGlvbiA9IHRydWU7XG4gICAgICB9XG5cdCAgfVxuXG5cdCAgLyogRnVuY3Rpb24gdG8gZGlzcGxheSB0aGUgUERGIGZpbGUgZnJvbSBJUEZTICovXG5cdCAgLypcblx0ICB2bS5kaXNwbGF5UERGID0gZnVuY3Rpb24obGNEZXRhaWxzKXtcblx0XHR2YXIgZmlsZU5hbWUgPSBsY0RldGFpbHMuaW5pdGlhdGVyRmlsZU5hbWU7XG5cdFx0d2luZG93Lm9wZW4oXCIvc3RhdGljL3VwbG9hZGVkRmlsZXMvXCIrZmlsZU5hbWUsXCJfYmxhbmtcIik7XG5cdCAgfVxuXHQgICovXG5cblx0ICAvKiBGdW5jdGlvbiB0byBjbGVhciB0aGUgZmllbGRzIG9uIHJlc2V0IGJ1dHRvbiAqL1xuXHQgIHZtLmNsZWFyID0gZnVuY3Rpb24oKXtcblx0XHQgICBpZiggJHNjb3BlLmFkdkJhbmtGb3JtRGV0YWlscyAhPSBcIlwiICYmICRzY29wZS5hZHZCYW5rRm9ybURldGFpbHMgIT0gdW5kZWZpbmVkXG4gICAgICAgICAgJiYgJHNjb3BlLmFkdkJhbmtGb3JtRGV0YWlscyAhPSBudWxsICl7XG5cdFx0XHQgICRzY29wZS5hZHZCYW5rRm9ybURldGFpbHMgPSBcIlwiO1xuXHRcdCAgfVxuICAgICAgdm0uc2hvd0FjY29yZGlvbiA9IGZhbHNlO1xuICAgICAgJHNjb3BlLmRpc3BsYXlNZXNzYWdlID0gXCJcIjtcblx0ICB9XG5cblx0ICAvKiBGdW5jdGlvbiB0byBTYXZlIHRoZSBBZHZpc2luZyBiYW5rIHNjcmVlbiBkZXRhaWxzICovXG5cdCAgdm0uc3VibWl0ID0gZnVuY3Rpb24obGNEZXRhaWxzKXtcblx0XHQgIHZhciBjb250cmFjdElEID0geydjb250cmFjdElEJzogbGNEZXRhaWxzLl9pZH07XG5cdFx0ICAgJGh0dHAucG9zdCgnL2FkdkJhbmsvbGNBY2NlcHQnLGNvbnRyYWN0SUQsIHtcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICdCZWFyZXIgJyArIGF1dGhlbnRpY2F0aW9uLmdldFRva2VuKClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS50aGVuKFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICBcdFx0XHQgICAgICAgdm0uaW5pdCgpO1xuICAgICAgICAgICAgICAgICAgIHZtLnNob3dBY2NvcmRpb24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGlzcGxheU1lc3NhZ2U9XCJMQyBBY2NlcHRlZCA6IEJsb2NrIGNoYWluIHByb2Nlc3NpbmcgaW5pdGlhdGVkXCI7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH0pO1xuXHRcdH1cbiAgICAgIHZtLnNldFRhYiA9IGZ1bmN0aW9uKGluZGV4KXtcbiAgICAgICAgaWYoIGluZGV4ID09ICRyb290U2NvcGUudGFiSWRlbnRpZmllciApe1xuICAgICAgICAgIHJldHVybiBcImFjdGl2ZVwiO1xuICAgICAgICB9XG4gICAgICAgIGVsc2V7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG5cdCAgdm0uaW5pdCgpO1xuICAgIH1cbn0pKCk7XG4iXX0=
